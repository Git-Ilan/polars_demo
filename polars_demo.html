<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Intro 2 Polars</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="polars_demo_files/libs/clipboard/clipboard.min.js"></script>
<script src="polars_demo_files/libs/quarto-html/quarto.js"></script>
<script src="polars_demo_files/libs/quarto-html/popper.min.js"></script>
<script src="polars_demo_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="polars_demo_files/libs/quarto-html/anchor.min.js"></script>
<link href="polars_demo_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="polars_demo_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="polars_demo_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="polars_demo_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="polars_demo_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro 2 Polars</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-background" class="level1">
<h1>Background</h1>
<section id="ritchie-vink-rust-apache-arrow-and-covid" class="level2">
<h2 class="anchored" data-anchor-id="ritchie-vink-rust-apache-arrow-and-covid">Ritchie Vink, Rust, Apache Arrow and Covid</h2>
<p><a href="https://www.ritchievink.com/blog/2021/02/28/i-wrote-one-of-the-fastest-dataframe-libraries/">Here</a> is the story, by the creator of Polars.</p>
</section>
<section id="who-can-benefit-from-polars" class="level2">
<h2 class="anchored" data-anchor-id="who-can-benefit-from-polars">Who Can Benefit from Polars?</h2>
<ul>
<li>Researcher (DS, Analyst, Statistician, etc):
<ul>
<li>Working on their local machine.</li>
<li>Working on a cloud machine (SageMaker, EC2).</li>
</ul></li>
<li>Production system:
<ul>
<li>Running on a dedicated server.</li>
<li>Running on “serverless” (e.g.&nbsp;AWS Lambda, Google Cloud Functions).</li>
</ul></li>
</ul>
</section>
<section id="the-dataframe-landscape" class="level2">
<h2 class="anchored" data-anchor-id="the-dataframe-landscape">The DataFrame Landscape</h2>
<p>Initially there were R’s <code>data.frame</code>. R has evolved, and it now offers <code>tibble</code>s and <code>data.table</code>s. Python had only <code>Pandas</code> for years. Then the Python ecosystem exploded, and now we have:</p>
<ul>
<li><a href="https://Pandas.pydata.org/">Pandas</a>: The original Python dataframe module. Build by Wes McKinney, on top of numpy.</li>
<li><a href="https://www.pola.rs/">Polars</a>: A new dataframe module, build by Ritchie Vink, on top of Rust and Apache Arrow.</li>
<li><a href="https://datatable.readthedocs.io/en/latest/">datatable</a>: An attempt to recreate R’s <a href="https://github.com/Rdatatable/data.table">data.table</a> API and (crazy) speed in Python.</li>
<li><a href="https://www.dask.org/">Dask</a>: A distributed computing engine for Python, with support for distributing data over multiple processes running Pandas (or numpy, Polars, etc).</li>
<li><a href="https://vaex.io/">Vaex</a>: A high performance Python library for lazy Out-of-Core DataFrames (similar to dask, but with a different API).</li>
<li><a href="https://github.com/modin-project/modin">Modin</a>: A drop-in distributed replacement for Pandas, built on top of <a href="https://www.ray.io/">Ray</a>.</li>
<li><a href="https://duckdb.org/">DuckDB</a>: An embeddable SQL OLAP database management system. These are dataframe that are stored on disk, compute on a single process, and queried with SQL or pythonic API.</li>
<li><a href="https://www.getdaft.io/">Daft</a>: A distributed dataframe library built for “Complex Data” (data that doesn’t usually fit in a SQL table such as images, videos, documents etc).</li>
<li><a href="https://fugue-tutorials.readthedocs.io/">Fugue</a>: A dataframe library that allows you to write SQL-like code, and execute it on different backends (e.g.&nbsp;Spark, Dask, Pandas, Polars, etc).</li>
<li><a href="https://spark.apache.org/docs/latest/api/python/index.html">pySpark</a>: The Python API for Spark. Spark is a distributed computing engine, with support for distributing data over multiple processes running Pandas (or numpy, Polars, etc).</li>
<li><a href="https://github.com/rapidsai/cudf">CUDF</a>: A GPU accelerated dataframe library, build on top of Apache Arrow.</li>
</ul>
<p>See <a href="https://pola-rs.github.io/Polars-book/user-guide/misc/alternatives/">here</a> and <a href="https://www.getdaft.io/projects/docs/en/latest/dataframe_comparison.html">here</a> for more details.</p>
</section>
</section>
<section id="sec-motivation" class="level1">
<h1>Motivation</h1>
<p>Each of the following, alone(!), is amazing.</p>
<ol type="1">
<li>Small memory footprint.</li>
<li>Native dtypes: missing, strings.</li>
<li>Lazy evaluation allows query Planning.</li>
<li>Streaming engine: No need to load entire dataset into memory.</li>
<li>Out of the box parallelism: Fast and informative messages for debugging.</li>
<li>Strict typing: This means the dtype of output is defined by the operation and not bu the input. This is both safer, and allows static analysis.</li>
</ol>
<section id="setting-up-the-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-environment">Setting Up the Environment</h2>
<p>At this point you may want to create and activate a <a href="https://realpython.com/python-virtual-environments-a-primer/">venv</a> for this project.</p>
<div id="0aab649b" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install --upgrade pip</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install --upgrade Polars</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install --upgrade pyarrow</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install --upgrade Pandas</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install --upgrade plotly</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip freeze &gt; requirements.txt</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install -r requirements.txt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="polars-version" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip show Polars <span class="co"># check you Polars version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: polars
Version: 0.20.13
Summary: Blazingly fast DataFrame library
Home-page: 
Author: 
Author-email: Ritchie Vink &lt;ritchie46@gmail.com&gt;
License: 
Location: /Users/johnros/workspace/polars_demo/.venv/lib/python3.9/site-packages
Requires: 
Required-by: 
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="pandas-version" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip show Pandas <span class="co"># check you Polars version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name: pandas
Version: 2.2.0
Summary: Powerful data structures for data analysis, time series, and statistics
Home-page: https://pandas.pydata.org
Author: 
Author-email: The Pandas Development Team &lt;pandas-dev@python.org&gt;
License: BSD 3-Clause License
        
        Copyright (c) 2008-2011, AQR Capital Management, LLC, Lambda Foundry, Inc. and PyData Development Team
        All rights reserved.
        
        Copyright (c) 2011-2023, Open source contributors.
        
        Redistribution and use in source and binary forms, with or without
        modification, are permitted provided that the following conditions are met:
        
        * Redistributions of source code must retain the above copyright notice, this
          list of conditions and the following disclaimer.
        
        * Redistributions in binary form must reproduce the above copyright notice,
          this list of conditions and the following disclaimer in the documentation
          and/or other materials provided with the distribution.
        
        * Neither the name of the copyright holder nor the names of its
          contributors may be used to endorse or promote products derived from
          this software without specific prior written permission.
        
        THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
        AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
        IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
        DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
        FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
        DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
        SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
        CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
        OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
        OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
Location: /Users/johnros/workspace/polars_demo/.venv/lib/python3.9/site-packages
Requires: numpy, python-dateutil, pytz, tzdata
Required-by: category-encoders, seaborn, statsmodels
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div id="preliminaries" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pl.Config(fmt_str_lengths<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Following two lines only required to view plotly when rendering from VScode. </span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># pio.renderers.default = "plotly_mimetype+notebook_connected+notebook"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>pio.renderers.default <span class="op">=</span> <span class="st">"plotly_mimetype+notebook"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="memory-footprint" class="level2">
<h2 class="anchored" data-anchor-id="memory-footprint">Memory Footprint</h2>
<section id="memory-footprint-of-storage" class="level3">
<h3 class="anchored" data-anchor-id="memory-footprint-of-storage">Memory Footprint of Storage</h3>
<p>Comparing Polars to Pandas- the memory footprint of a series of strings.</p>
<p>Polars.</p>
<div id="c2d32602" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>letters <span class="op">=</span> pl.Series(<span class="bu">list</span>(string.ascii_letters))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="bu">int</span>(<span class="fl">10e6</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>letter1 <span class="op">=</span> letters.sample(n,with_replacement<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>letter1.estimated_size(unit<span class="op">=</span><span class="st">'gb'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0.14901161193847656</code></pre>
</div>
</div>
<p>Pandas before Pandas 2.0.</p>
<div id="cc0deecf" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pandas with Ver 1.x backend</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>letter1_Pandas <span class="op">=</span> letter1.to_pandas(use_pyarrow_extension_array<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>letter1_Pandas.memory_usage(deep<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">False</span>) <span class="op">/</span> <span class="fl">1e9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0.58</code></pre>
</div>
</div>
<p>Pandas after Pandas 2.0, with the Pyarrow backend (Apr 2023).</p>
<div id="411659e8" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>letter1_Pandas <span class="op">=</span> letter1.to_pandas(use_pyarrow_extension_array<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>letter1_Pandas.memory_usage(deep<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">False</span>) <span class="op">/</span> <span class="fl">1e9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0.09</code></pre>
</div>
</div>
</section>
<section id="operating-from-disk-to-disk" class="level3">
<h3 class="anchored" data-anchor-id="operating-from-disk-to-disk">Operating From Disk to Disk</h3>
<p>What if my data does not fit into RAM? Turns out you manifest a lazy frame into disk, instead of RAM, thus avoiding the need to load the entire dataset into memory. Alas, the function that does so, <a href="https://pola-rs.github.io/Polars/py-Polars/html/reference/lazyframe/api/Polars.LazyFrame.sink_parquet.html">sink_parquet()</a>, has currently limited functionality. It is certainly worth keeping an eye on this function, as it matures.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Although the potential of <code>sink_parquet()</code> is amazing, I find that it currently does not support complicated queries.</p>
</div>
</div>
</section>
</section>
<section id="sec-query-planning" class="level2">
<h2 class="anchored" data-anchor-id="sec-query-planning">Lazy Frames and Query Planning</h2>
<p>Consider a sort operation that follows a filter operation. Ideally, filter precedes the sort, but we did not ensure this… We now demonstrate that Polars’ query planner will do it for you. En passant, we see Polars is more efficient also without the query planner.</p>
<p>Polars’ Eager evaluation in the <strong>wrong</strong> order. Sort then filter.</p>
<div id="241649ed" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">2</span> <span class="op">-</span>r <span class="dv">2</span> letter1.sort().<span class="bu">filter</span>(letter1.is_in([<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>467 ms ± 16.1 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<p>Polars’ Eager evaluation in the <strong>right</strong> order. Filter then sort.</p>
<div id="022f2f9b" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">2</span> <span class="op">-</span>r <span class="dv">2</span> letter1.<span class="bu">filter</span>(letter1.is_in([<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>])).sort()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>79.6 ms ± 982 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<div id="23106980" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>latter1_lazy <span class="op">=</span> letter1.alias(<span class="st">'letters'</span>).to_frame().lazy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Polars’ Lazy evaluation in the <strong>wrong</strong> order; <strong>without</strong> query planning</p>
<div id="8b0e2eed" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">2</span> <span class="op">-</span>r <span class="dv">2</span> latter1_lazy.sort(by<span class="op">=</span><span class="st">'letters'</span>).<span class="bu">filter</span>(pl.col(<span class="st">'letters'</span>).is_in([<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>])).collect(no_optimization<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>465 ms ± 11.1 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<p>Polars’ Lazy evaluation in the <strong>wrong</strong> order; <strong>with</strong> query planning</p>
<div id="07dff877" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">2</span> <span class="op">-</span>r <span class="dv">2</span> latter1_lazy.sort(by<span class="op">=</span><span class="st">'letters'</span>).<span class="bu">filter</span>(pl.col(<span class="st">'letters'</span>).is_in([<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>])).collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>76.6 ms ± 952 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<p>Things to note:</p>
<ol type="1">
<li>A lazy evaluation was triggered when <code>df.lazy()</code> converted the Polars DataFrame to a Polars LazyFrame.</li>
<li>The query planner worked: The Lazy evaluation in the wrong order timed as much as an eager evaluation in the right order; even when accounting for the overhead of converting the frame from eager to lazy.</li>
</ol>
<p>Now compare to Pandas…</p>
<p>Pandas’ eager evaluation in the <strong>wrong</strong> order.</p>
<div id="6870208e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n1 <span class="op">-</span>r1 letter1_Pandas.sort_values().loc[<span class="kw">lambda</span> x: x.isin([<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.18 s ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
</div>
<p>Pandas eager evaluation in the <strong>right</strong> order: Filter then sort.</p>
<div id="dadf317b" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n1 <span class="op">-</span>r1 letter1_Pandas.loc[<span class="kw">lambda</span> x: x.isin([<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>])].sort_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>134 ms ± 0 ns per loop (mean ± std. dev. of 1 run, 1 loop each)</code></pre>
</div>
</div>
<p>Pandas without lambda functions syntax; looks slightly better.</p>
<div id="8ff1e120" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">2</span> <span class="op">-</span>r <span class="dv">2</span> letter1_Pandas.loc[letter1_Pandas.isin([<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>])].sort_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>131 ms ± 740 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<p>Things to note:</p>
<ol type="1">
<li>Query planning works!</li>
<li>Pandas has dramatically improved since &lt;2.0.0.</li>
<li>Lambda functions are always slow (both Pandas and Polars).</li>
</ol>
</section>
<section id="optimized-for-within-column-operations" class="level2">
<h2 class="anchored" data-anchor-id="optimized-for-within-column-operations">Optimized for Within-Column Operations</h2>
<p>Polars seamlessly parallelizes over columns (also within, when possible). As the number of columns in the data grows, we would expect fixed runtime until all cores are used, and then linear scaling. The following code demonstrates this idea, using a simple sum-within-column.</p>
<div id="e550b59b" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mac users with Apple silicon (M1 or M2) may also want to benchmark Apples' mlx:</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install mlx</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mlx.core <span class="im">as</span> mx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ef4c3c24" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maker an array of floats.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>A_numpy <span class="op">=</span> np.random.randn(<span class="bu">int</span>(<span class="fl">1e6</span>), <span class="dv">10</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>A_numpy <span class="op">=</span> A_numpy.copy()</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>A_Polars <span class="op">=</span> pl.DataFrame(A_numpy)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>A_Pandas_numpy <span class="op">=</span> pd.DataFrame(A_numpy)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>A_Pandas_arrow <span class="op">=</span> pd.DataFrame(A_numpy, dtype<span class="op">=</span><span class="st">"float32[pyarrow]"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># A_arrow = pa.Table.from_Pandas(A_Pandas_numpy) # no sum method</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>A_mlx <span class="op">=</span> mx.array(A_numpy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Candidates currently omited:</p>
<ol type="1">
<li>JAX</li>
<li>PyTorch</li>
<li>TensorFlow</li>
<li>…?</li>
</ol>
<section id="summing-over-columns" class="level3">
<h3 class="anchored" data-anchor-id="summing-over-columns">Summing Over Columns</h3>
<div id="a64f5b4b" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_numpy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>7.97 ms ± 184 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="d94928b2" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>A_numpy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(10,)</code></pre>
</div>
</div>
<div id="39e33143" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Polars.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.15 ms ± 494 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="7f2b3bce" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>A_Polars.<span class="bu">sum</span>().shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>(1, 10)</code></pre>
</div>
</div>
<div id="5b5fbb86" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_mlx.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The slowest run took 147.26 times longer than the fastest. This could mean that an intermediate result is being cached.
167 µs ± 165 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="09bccd81" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>A_mlx.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>(10,)</code></pre>
</div>
</div>
</section>
<section id="shades-of-pandas" class="level3">
<h3 class="anchored" data-anchor-id="shades-of-pandas">50 Shades of Pandas</h3>
<p>Pandas with numpy backend</p>
<div id="6e9d51ce" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_numpy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>27.3 ms ± 949 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="45f007c7" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>A_Pandas_numpy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>(10,)</code></pre>
</div>
</div>
<p>Pandas with arrow backend</p>
<div id="178f00d2" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_arrow.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.73 ms ± 794 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="49398d89" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>A_Pandas_arrow.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>(10,)</code></pre>
</div>
</div>
<p>Pandas with numpy backend, converted to numpy</p>
<div id="acdac6aa" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_numpy.values.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>7.81 ms ± 121 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="6180ed76" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>A_Pandas_numpy.values.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>(10,)</code></pre>
</div>
</div>
<p>Pandas with arrow backend, converted to numpy</p>
<div id="df683603" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_arrow.values.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>396 ms ± 12.8 ms per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="3a09e664" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(A_Pandas_arrow.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>numpy.ndarray</code></pre>
</div>
</div>
<div id="228689c7" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>A_Pandas_arrow.values.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>(10,)</code></pre>
</div>
</div>
<p>Pandas to mlx</p>
<div id="27969b29" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> mx.array(A_Pandas_numpy.values).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.49 ms ± 2.08 ms per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="f142d793" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mx.array(A_Pandas_numpy.values).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>(10,)</code></pre>
</div>
</div>
</section>
<section id="summing-over-rows" class="level3">
<h3 class="anchored" data-anchor-id="summing-over-rows">Summing Over Rows</h3>
<div id="11299fb5" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_numpy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8.32 ms ± 102 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="c1c7ba30" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>A_numpy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>(1000000,)</code></pre>
</div>
</div>
<div id="5f2f443c" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Polars.sum_horizontal()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>7.14 ms ± 1.94 ms per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="d4d7fcab" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>A_Polars.sum_horizontal().shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>(1000000,)</code></pre>
</div>
</div>
<div id="907c08ce" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_mlx.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.72 µs ± 1.67 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<div id="ddf189b2" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>A_mlx.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>(1000000,)</code></pre>
</div>
</div>
</section>
<section id="shades-of-pandas-1" class="level3">
<h3 class="anchored" data-anchor-id="shades-of-pandas-1">50 Shades of Pandas</h3>
<p>Pandas with numpy backend</p>
<div id="cd0ff1e4" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_numpy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>71 ms ± 495 µs per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<p>Pandas with arrow backend</p>
<div id="70959b1e" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_arrow.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>198 ms ± 10.7 ms per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<p>Pandas with numpy backend, converted to numpy</p>
<div id="4f590082" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_numpy.values.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10.4 ms ± 1.69 ms per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<p>Pandas with arrow backend, converted to numpy</p>
<div id="83f0de3d" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> A_Pandas_arrow.values.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>426 ms ± 12 ms per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
<p>Pandas to mlx</p>
<div id="80e3b177" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n <span class="dv">4</span> <span class="op">-</span>r <span class="dv">2</span> mx.array(A_Pandas_numpy.values).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5.71 ms ± 3.15 ms per loop (mean ± std. dev. of 2 runs, 4 loops each)</code></pre>
</div>
</div>
</section>
</section>
<section id="speed-of-import" class="level2">
<h2 class="anchored" data-anchor-id="speed-of-import">Speed Of Import</h2>
<p>Polar’s <code>read_X</code> functions are quite faster than Pandas. This is due to better type “guessing” heuristics, and easier mapping between the disk representation and memory representation of the data.</p>
<p>We benchmark by making synthetic data, save it on disk, and reimporting it.</p>
<section id="csv-format" class="level3">
<h3 class="anchored" data-anchor-id="csv-format">CSV Format</h3>
<div id="6a1c6d66" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>n_rows <span class="op">=</span> <span class="bu">int</span>(<span class="fl">1e5</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>n_cols <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>data_Polars <span class="op">=</span> pl.DataFrame(np.random.randn(n_rows,n_cols))</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>data_Polars.write_csv(<span class="st">'data/data.csv'</span>, include_header <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>getsize(<span class="st">'data/data.csv'</span>)<span class="op">/</span><span class="fl">1e7</span><span class="sc">:.2f}</span><span class="ss"> MB on disk"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>'1.96 MB on disk'</code></pre>
</div>
</div>
<p>Import with Pandas.</p>
<div id="10c08979" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 data_Pandas <span class="op">=</span> pd.read_csv(<span class="st">'data/data.csv'</span>, header <span class="op">=</span> <span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>93.1 ms ± 466 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<p>Import with Polars.</p>
<div id="20700b6c" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 data_Polars <span class="op">=</span> pl.read_csv(<span class="st">'data/data.csv'</span>, has_header <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>13.1 ms ± 5.07 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<p>What is the ratio of times on your machine? How many cores do you have?</p>
</section>
<section id="parquet-format" class="level3">
<h3 class="anchored" data-anchor-id="parquet-format">Parquet Format</h3>
<div id="c3c63541" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>data_Polars.write_parquet(<span class="st">'data/data.parquet'</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>getsize(<span class="st">'data/data.parquet'</span>)<span class="op">/</span><span class="fl">1e7</span><span class="sc">:.2f}</span><span class="ss"> MB on disk"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>'0.78 MB on disk'</code></pre>
</div>
</div>
<div id="96707eed" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 data_Pandas <span class="op">=</span> pd.read_parquet(<span class="st">'data/data.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The slowest run took 6.98 times longer than the fastest. This could mean that an intermediate result is being cached.
21.2 ms ± 15.9 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<div id="52de94f7" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 data_Polars <span class="op">=</span> pl.read_parquet(<span class="st">'data/data.parquet'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6.82 ms ± 582 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
</section>
<section id="feather-apache-ipc-format" class="level3">
<h3 class="anchored" data-anchor-id="feather-apache-ipc-format">Feather (Apache IPC) Format</h3>
<div id="5928ac90" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>data_Polars.write_ipc(<span class="st">'data/data.feather'</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>getsize(<span class="st">'data/data.feather'</span>)<span class="op">/</span><span class="fl">1e7</span><span class="sc">:.2f}</span><span class="ss"> MB on disk"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>'0.80 MB on disk'</code></pre>
</div>
</div>
<div id="478508a3" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 data_Polars <span class="op">=</span> pl.read_ipc(<span class="st">'data/data.feather'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The slowest run took 21.85 times longer than the fastest. This could mean that an intermediate result is being cached.
586 µs ± 535 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<div id="8fe2db70" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 data_Pandas <span class="op">=</span> pd.read_feather(<span class="st">'data/data.feather'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.68 ms ± 1.35 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
</section>
<section id="pickle-format" class="level3">
<h3 class="anchored" data-anchor-id="pickle-format">Pickle Format</h3>
<div id="561a99a8" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>pickle.dump(data_Polars, <span class="bu">open</span>(<span class="st">'data/data.pickle'</span>, <span class="st">'wb'</span>))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="ss">f"</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>getsize(<span class="st">'data/data.pickle'</span>)<span class="op">/</span><span class="fl">1e7</span><span class="sc">:.2f}</span><span class="ss"> MB on disk"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>'0.80 MB on disk'</code></pre>
</div>
</div>
<div id="59c4d4ea" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 data_Polars <span class="op">=</span> pickle.load(<span class="bu">open</span>(<span class="st">'data/data.pickle'</span>, <span class="st">'rb'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3.21 ms ± 231 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
</section>
<section id="summarizing-import" class="level3">
<h3 class="anchored" data-anchor-id="summarizing-import">Summarizing Import</h3>
<p>Things to note:</p>
<ol type="1">
<li>The difference in speed is quite large between Pandas vs.&nbsp;Polars.</li>
<li>When dealing with CSV’s, the function <code>pl.read_csv</code> reads in parallel, and has better type guessing heuristics.</li>
<li>The difference in speed is quite large between csv vs.&nbsp;parquet and feather, with feather&lt;parquet&lt;csv.</li>
<li>Feather is the fastest, but larger on disk. Thus good for short-term storage, and parquet for long-term.</li>
<li>The fact that pickle isn’t the fastest surprised me; but then again, it is not optimized for data.</li>
</ol>
</section>
</section>
<section id="speed-of-join" class="level2">
<h2 class="anchored" data-anchor-id="speed-of-join">Speed Of Join</h2>
<p>Because Pandas is built on numpy, people see it as both an in-memory database, and a matrix/array library. With Polars, it is quite clear it is an in-memory database, and not an array processing library (despite having a <code>pl.dot()</code> function for inner products). As such, you cannot multiply two Polars dataframes, but you can certainly join then efficiently.</p>
<p>Make some data:</p>
<div id="57ae20a6" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_data(n_rows, n_cols):</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> np.concatenate(</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    np.arange(n_rows)[:,np.newaxis], <span class="co"># index</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    np.random.randn(n_rows,n_cols), <span class="co"># values</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>n_rows <span class="op">=</span> <span class="bu">int</span>(<span class="fl">1e6</span>)</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>n_cols <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>data_left <span class="op">=</span> make_data(n_rows, n_cols)</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>data_right <span class="op">=</span> make_data(n_rows, n_cols)</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>data_left.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>(1000000, 11)</code></pre>
</div>
</div>
<section id="polars-join" class="level3">
<h3 class="anchored" data-anchor-id="polars-join">Polars Join</h3>
<div id="5397cc82" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>data_left_Polars <span class="op">=</span> pl.DataFrame(data_left)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>data_right_Polars <span class="op">=</span> pl.DataFrame(data_right)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 Polars_joined <span class="op">=</span> data_left_Polars.join(data_right_Polars, on <span class="op">=</span> <span class="st">'column_0'</span>, how <span class="op">=</span> <span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>51.1 ms ± 2.62 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
</section>
<section id="pandas-join" class="level3">
<h3 class="anchored" data-anchor-id="pandas-join">Pandas Join</h3>
<div id="0c055479" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>data_left_Pandas <span class="op">=</span> pd.DataFrame(data_left)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>data_right_Pandas <span class="op">=</span> pd.DataFrame(data_right)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 Pandas_joined <span class="op">=</span> data_left_Pandas.merge(data_right_Pandas, on <span class="op">=</span> <span class="dv">0</span>, how <span class="op">=</span> <span class="st">'inner'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>120 ms ± 10.5 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-nyc_taxi" class="level2">
<h2 class="anchored" data-anchor-id="sec-nyc_taxi">The NYC Taxi Dataset</h2>
<p>Empirical demonstration: Load the celebrated NYC taxi dataset, filter some rides and get the mean <code>tip_amount</code> by <code>passenger_count</code>.</p>
<div id="ba9ce469" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">'data/NYC'</span> <span class="co"># Data from https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>file_names <span class="op">=</span> os.listdir(path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="pandas" class="level3">
<h3 class="anchored" data-anchor-id="pandas">Pandas</h3>
<p><code>df.query()</code> syntax.</p>
<div id="830349ab" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>taxi_Pandas <span class="op">=</span> pd.read_parquet(path)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="st">    passenger_count &gt; 0 and </span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="st">    passenger_count &lt; 5 and  </span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="st">    trip_distance &gt;= 0 and </span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="st">    trip_distance &lt;= 10 and </span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="st">    fare_amount &gt;= 0 and </span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="st">    fare_amount &lt;= 100 and </span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="st">    tip_amount &gt;= 0 and </span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="st">    tip_amount &lt;= 20 and </span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="st">    total_amount &gt;= 0 and </span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="st">    total_amount &lt;= 100</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="st">    '''</span>.replace(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="st">''</span>)</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>taxi_Pandas.query(query).group_by(<span class="st">'passenger_count'</span>).agg({<span class="st">'tip_amount'</span>:<span class="st">'mean'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'DataFrame' object has no attribute 'group_by'</code></pre>
</div>
</div>
<p>Well, the <code>df.loc[]</code> syntax is usually faster than the <code>query</code> syntax:</p>
<div id="4f9b5bc9" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>taxi_Pandas <span class="op">=</span> pd.read_parquet(path)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>ind <span class="op">=</span> (</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    taxi_Pandas[<span class="st">'passenger_count'</span>].between(<span class="dv">1</span>,<span class="dv">4</span>) </span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> taxi_Pandas[<span class="st">'trip_distance'</span>].between(<span class="dv">0</span>,<span class="dv">10</span>) </span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> taxi_Pandas[<span class="st">'fare_amount'</span>].between(<span class="dv">0</span>,<span class="dv">100</span>) </span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> taxi_Pandas[<span class="st">'tip_amount'</span>].between(<span class="dv">0</span>,<span class="dv">20</span>) </span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> taxi_Pandas[<span class="st">'total_amount'</span>].between(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>    taxi_Pandas[ind]</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'passenger_count'</span>)</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>    .agg({<span class="st">'tip_amount'</span>:<span class="st">'mean'</span>})</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 2.01 s, sys: 1.82 s, total: 3.82 s
Wall time: 2.48 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tip_amount</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">passenger_count</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1.0</td>
<td>2.843313</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2.0</td>
<td>2.844228</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3.0</td>
<td>2.777564</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4.0</td>
<td>2.648380</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="polars-lazy-in-memory" class="level3">
<h3 class="anchored" data-anchor-id="polars-lazy-in-memory">Polars Lazy In Memory</h3>
<div id="59206f33" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.dataset <span class="im">as</span> ds</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>dset <span class="op">=</span> ds.dataset(<span class="st">"data/NYC"</span>, <span class="bu">format</span><span class="op">=</span><span class="st">"parquet"</span>)  <span class="co"># define folder as Pyarrow dataset</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> (</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    pl.scan_pyarrow_dataset(dset)</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pl.read_parquet("data/NYC/*.parquet") # will now work because parquet was created with Int32, and not Int64. </span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">filter</span>(</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'passenger_count'</span>).is_between(<span class="dv">1</span>,<span class="dv">4</span>),</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'trip_distance'</span>).is_between(<span class="dv">0</span>,<span class="dv">10</span>),</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'fare_amount'</span>).is_between(<span class="dv">0</span>,<span class="dv">100</span>),</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'tip_amount'</span>).is_between(<span class="dv">0</span>,<span class="dv">20</span>),</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'total_amount'</span>).is_between(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>    .group_by(<span class="st">'passenger_count'</span>)</span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">'tip_amount'</span>).mean().name.suffix(<span class="st">'_mean'</span>)</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>      ) </span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>q.collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 586 ms, sys: 317 ms, total: 903 ms
Wall time: 378 ms</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">passenger_count</th>
<th data-quarto-table-cell-role="th">tip_amount_mean</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4.0</td>
<td>2.64838</td>
</tr>
<tr class="even">
<td>3.0</td>
<td>2.777564</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>2.844228</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>2.843313</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="432afe2a" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>q.show_graph(optimized<span class="op">=</span><span class="va">True</span>) <span class="co"># Graphviz has to be installed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="polars_demo_files/figure-html/cell-65-output-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Things to note:</p>
<ol type="1">
<li>I did not use the native <code>pl.scan_parquet()</code> as it is recommended. For your purposes, you will almost always use the native readers. It is convenient to remember, however, that you can also use the PyArrow importers in the native importers fail.</li>
<li>I only have 2 parquet files. When I run the same with more files, despite my 16GB of RAM, <strong>Pandas will crash my python kernel</strong>.</li>
<li>From the query graph I see import is done in parallel, and filtering done at scanning time!</li>
<li></li>
</ol>
</section>
<section id="polars-lazy-from-disk" class="level3">
<h3 class="anchored" data-anchor-id="polars-lazy-from-disk">Polars Lazy From Disk</h3>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following shows how to use the Polars streaming engine. This is arguably the biggest difference with Pandas, and other in memory dataframe libraries.</p>
</div>
</div>
<div id="cell-Polars-lazy-from-disk" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>q.collect(streaming<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="polars-lazy-from-disk" class="cell-output cell-output-display" data-execution_count="65">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">passenger_count</th>
<th data-quarto-table-cell-role="th">tip_amount_mean</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4.0</td>
<td>2.64838</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>2.843313</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>2.844228</td>
</tr>
<tr class="even">
<td>3.0</td>
<td>2.777564</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<section id="object-classes" class="level2">
<h2 class="anchored" data-anchor-id="object-classes">Object Classes</h2>
<ul>
<li><p><strong>Polars Series</strong>: Like a Pandas series. An in-memory array of data, with a name, and a dtype.</p></li>
<li><p><strong>Polars Expr</strong>: A Polars series that is not yet computed, and that will be computed when needed. A Polars Expression can be thought of as:</p>
<ol type="1">
<li>A Lazy Series: A series that is not yet computed, and that will be computed when needed.</li>
<li>A function: That maps a Polars series to another Polars series (possibly of length 1).</li>
</ol></li>
<li><p><strong>Polars LazyFrame</strong>: A collection of Polars Expressions. This is the Polars equivalent of a Spark DataFrame. It is lazy, thus allows query planning.</p></li>
<li><p><strong>Polars DataFrame</strong>: A collection of Polars Series. This is the Polars equivalent of a Pandas DataFrame. It is eager, and does not allow query planning.</p></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Not all methods are implemented for all classes. In particular, not all <code>pl.Dataframe</code> methods are implemented for <code>pl.LazyFrame</code> and vice versa. The same goes for <code>pl.Series</code> and <code>pl.Expr</code>.</p>
<p>This is not because the developers are lazy, but because the API is still being developed, and there are fundamental differences between the classes.</p>
<p>Think about it:</p>
<ol type="1">
<li>Why do we not see a <code>df.height</code> attribute for a <code>pl.LazeFrame</code>?</li>
<li>Why do we not see a <code>df.sample()</code> method for a <code>pl.LazyFrame</code>?</li>
</ol>
</div>
</div>
</section>
<section id="evaluation-engines" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-engines">Evaluation Engines</h2>
<p>Polars seemingly <strong>2 evaluation engines</strong>:</p>
<ol type="1">
<li><strong>Eager</strong>: This is the default. It is the same as Pandas. When you call a method, the method is immediately executed.</li>
<li><strong>Lazy</strong>: This is the same as Spark. When you call a method, the method is not immediately executed. Instead, a query plan is created. The query plan is then executed when you call <code>.collect()</code>.</li>
</ol>
<p>Why “seemingly” 2? Because each engine has it’s own subtleties. For instance, the behavior of the lazy engine may depend on streaming VS non-streaming evaluation, and on the means of loading the data.</p>
<ol type="1">
<li><strong>Streaming</strong>: This is a special case of lazy evaluation. It is used when you have a large dataset, and you want to process it in chunks. You can then call <code>.collect(streaming=True)</code> to process the dataset in chunks. This is useful when you have a dataset that is too large to fit into memory, and you want to process it in chunks. It is also useful when you want to process a dataset in real-time, as it is being generated.</li>
<li><strong>Loading</strong>: Reading multiple parquet files using Polars native readers, may behave slightly different than reading the same files as a Pyarrow dataset (always prefer the native readers, when possible).</li>
</ol>
</section>
<section id="polars-dtypes" class="level2">
<h2 class="anchored" data-anchor-id="polars-dtypes">Polars dtypes</h2>
<p>Polars has its own dtypes, call with <code>pl.&lt;dtype&gt;</code>; e.g.&nbsp;<code>pl.Int32</code>. A comprehensive list may be found <a href="https://docs.pola.rs/py-Polars/html/reference/datatypes.html">here</a>.</p>
<p>Here are the most common. Note, that unlike Pandas, all are native Polars dtypes, and do not recur to Python objects.</p>
<ul>
<li>Floats:
<ul>
<li><code>pl.Float64</code>: Arguably, the most frequently used dtype.</li>
</ul></li>
<li>Integers:
<ul>
<li><code>pl.Int64</code>: The most frequently used integer dtype.</li>
</ul></li>
<li>Booleans:
<ul>
<li><code>pl.Boolean</code>: As the name suggests.</li>
</ul></li>
<li>Strings:
<ul>
<li><code>pl.Utf8</code>: The only string encoding supported by Polars.</li>
<li><code>pl.String</code>: Recently introduced as an alias to <code>pl.Utf8</code>.</li>
</ul></li>
<li>Temporal:
<ul>
<li><code>pl.Date</code>: Date, without time.</li>
<li><code>pl.Datetime</code>: Date, with time.</li>
<li><code>pl.Time</code>: Time, without date.</li>
<li><code>pl.Duration</code>: Time difference.</li>
</ul></li>
<li>Nulls:
<ul>
<li><code>pl.Null</code>: Polars equivalent of <code>None</code>.</li>
<li><code>np.nan</code>: The numpy dtype. Essentially a float, and not as a null.</li>
</ul></li>
<li>Nested:
<ul>
<li><code>pl.List</code>: A list of items.</li>
<li><code>pl.Array</code>: Fixed length list.</li>
<li><code>pl.Struct</code>: Think of it as a dict within a frame.</li>
</ul></li>
</ul>
<p>Things to note:</p>
<ul>
<li>Polars has no <code>Int</code> dtype, nor <code>Float</code>. You must specify the number of bits.</li>
<li>Polars recently introduced <code>pl.String</code> as an alias for <code>pl.Utf8</code>. No other encodings are supported.</li>
<li>Polars also supports <code>np.nan</code>(!), which is different than its <code>pl.Null</code> dtype. <code>np.nan</code> is a <strong>float</strong>, and <code>Null</code> is a None.</li>
</ul>
</section>
<section id="the-polars-api" class="level2">
<h2 class="anchored" data-anchor-id="the-polars-api">The Polars API</h2>
<ul>
<li>You will fall in love with it!</li>
<li>Much more similar to PySpark than to Pandas. The Pandas API is simply not amenable to lazy evaluation.</li>
</ul>
<section id="sec-api-principles" class="level3">
<h3 class="anchored" data-anchor-id="sec-api-principles">Some Design Principles</h3>
<p>Here are some principles that will help you understand the API:</p>
<ol type="1">
<li><p>All columns are created equal. There are <strong>no indexing</strong> columns.</p></li>
<li><p>Always <strong>remember the class</strong> you are operating on: Is it a series, a dataframe, an expression, or a lazyframe?</p></li>
<li><p>Operations on the columns of a dataframe will always be part of a <strong>context</strong>. Context may include:</p>
<ol type="1">
<li><code>pl.DataFrame.select()</code>: This is the most common context. It is used to select columns, and to apply operations on columns.</li>
<li><code>pl.DataFrame.with_columns()</code>: This is used to add columns to a dataframe.</li>
<li><code>pl.DataFrame.group_by().agg()</code>: The <code>.agg()</code> context works like a <code>.select()</code> context, but it is used to apply operations on sub-groups of rows.</li>
<li><code>pl.DataFrame.filter()</code>: This is used to filter rows using expressions that evaluate to Booleans.</li>
</ol></li>
<li><p>Two-word methods are always lower-case, and separated by underscores. E.g: <code>.is_in()</code> instead of <code>.isin()</code>; <code>.is_null()</code> instead of <code>.isnull()</code>; <code>.group_by()</code> instead of <code>.group_by()</code> (starting version 19.0.0).</p></li>
<li><p>Polars was designed for operation within <strong>columns</strong>, not within rows. Operations within rows are the exception, and the will have a <code>_horizontal()</code> suffix. Examples: <code>pl.sum_horizontal()</code>, <code>pl.mean_horizontal()</code>, <code>pl.rolling_sum_horizontal()</code>.</p></li>
<li><p>Look for <code>pl.Expr()</code> methods so you can chain operations. E.g. <code>pl.col('a').add(pl.col('b'))</code> is better than <code>pl.col('a') + pl.col('b')</code>; the former can be further chained.</p></li>
</ol>
</section>
<section id="some-examples-of-the-api" class="level3">
<h3 class="anchored" data-anchor-id="some-examples-of-the-api">Some Examples of the API</h3>
<p>Here is an example to give you a little taste of what the API feels like.</p>
<div id="cell-Polars-api" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make some data</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>polars_frame <span class="op">=</span> pl.DataFrame(make_data(<span class="dv">100</span>,<span class="dv">4</span>))</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>polars_frame.limit(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="polars-api" class="cell-output cell-output-display" data-execution_count="66">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">column_0</th>
<th data-quarto-table-cell-role="th">column_1</th>
<th data-quarto-table-cell-role="th">column_2</th>
<th data-quarto-table-cell-role="th">column_3</th>
<th data-quarto-table-cell-role="th">column_4</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>-0.560947</td>
<td>-0.305116</td>
<td>-0.182084</td>
<td>-0.591619</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>0.154806</td>
<td>-0.283753</td>
<td>0.243206</td>
<td>0.192571</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>0.738282</td>
<td>-1.176444</td>
<td>0.954421</td>
<td>0.591584</td>
</tr>
<tr class="even">
<td>3.0</td>
<td>-2.281636</td>
<td>-1.384173</td>
<td>-0.778085</td>
<td>-0.310868</td>
</tr>
<tr class="odd">
<td>4.0</td>
<td>3.008982</td>
<td>-0.733</td>
<td>0.885699</td>
<td>0.701018</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>What is the difference between <code>.head()</code> and <code>limit()</code>? For eager frames? For lazy frames?</p>
</div>
</div>
<p>Can you parse the following in your head?</p>
<div id="800e397a" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  polars_frame</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  .rename({<span class="st">'column_0'</span>:<span class="st">'group'</span>})</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  .with_columns(</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'group'</span>).cast(pl.Int32),</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'column_1'</span>).ge(<span class="dv">0</span>).alias(<span class="st">'non-negative'</span>),</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>  .group_by(<span class="st">'non-negative'</span>)</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  .agg(</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'group'</span>).is_between(<span class="dv">1</span>,<span class="dv">4</span>).<span class="bu">sum</span>().alias(<span class="st">'one-to-four'</span>),</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'^column_[0-9]$'</span>).mean().name.suffix(<span class="st">'_mean'</span>),</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">non-negative</th>
<th data-quarto-table-cell-role="th">one-to-four</th>
<th data-quarto-table-cell-role="th">column_1_mean</th>
<th data-quarto-table-cell-role="th">column_2_mean</th>
<th data-quarto-table-cell-role="th">column_3_mean</th>
<th data-quarto-table-cell-role="th">column_4_mean</th>
</tr>
<tr class="odd">
<th>bool</th>
<th>u32</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
<td>1</td>
<td>-0.753084</td>
<td>-0.156752</td>
<td>-0.112693</td>
<td>-0.012832</td>
</tr>
<tr class="even">
<td>true</td>
<td>3</td>
<td>0.700452</td>
<td>-0.028564</td>
<td>0.054257</td>
<td>-0.000762</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Ask yourself:</p>
<ul>
<li>What is <code>polars_frame</code>? Is it an eager or a lazy Polars dataframe?</li>
<li>Why is <code>column_1_mean</code> when <code>non-negative=false</code> indeed non negative?</li>
<li>What is a Polars expression?</li>
<li>What is a Polars series?</li>
<li>How did I create the columns <code>column_1_mean</code>…<code>column_4_mean</code>?</li>
<li>How would you have written this in Pandas?</li>
</ul>
<div id="cell-Polars-api-second-example" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  polars_frame</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  .rename({<span class="st">'column_0'</span>:<span class="st">'group'</span>})</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  .select(</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'group'</span>).mod(<span class="dv">2</span>),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>    pl.mean_horizontal(</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">'^column_[0-9]$'</span>)</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>    .name.suffix(<span class="st">'_mean'</span>)</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>  .<span class="bu">filter</span>(</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'group'</span>).eq(<span class="dv">1</span>),</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'column_1_mean'</span>).gt(<span class="dv">0</span>)</span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="polars-api-second-example" class="cell-output cell-output-display" data-execution_count="68">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (28, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">group</th>
<th data-quarto-table-cell-role="th">column_1_mean</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>0.076707</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>0.078814</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>0.190277</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>0.131193</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>0.077334</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>0.111585</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>0.45668</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>0.247178</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>0.104374</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>0.755228</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Try parsing the following in your head:</p>
<div id="5d185a97" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>polars_frame_2 <span class="op">=</span> (</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  pl.DataFrame(make_data(<span class="dv">100</span>,<span class="dv">1</span>))</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  .select(</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'*'</span>).name.suffix(<span class="st">'_second'</span>)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>  polars_frame</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>  .join(</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>    polars_frame_2,</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>    left_on <span class="op">=</span> <span class="st">'column_0'</span>,</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>    right_on <span class="op">=</span> <span class="st">'column_0_second'</span>,</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>    how <span class="op">=</span> <span class="st">'left'</span>,</span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>    validate<span class="op">=</span><span class="st">'1:1'</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (100, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">column_0</th>
<th data-quarto-table-cell-role="th">column_1</th>
<th data-quarto-table-cell-role="th">column_2</th>
<th data-quarto-table-cell-role="th">column_3</th>
<th data-quarto-table-cell-role="th">column_4</th>
<th data-quarto-table-cell-role="th">column_1_second</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>-0.560947</td>
<td>-0.305116</td>
<td>-0.182084</td>
<td>-0.591619</td>
<td>-0.473837</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>0.154806</td>
<td>-0.283753</td>
<td>0.243206</td>
<td>0.192571</td>
<td>-1.671931</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>0.738282</td>
<td>-1.176444</td>
<td>0.954421</td>
<td>0.591584</td>
<td>-2.320756</td>
</tr>
<tr class="even">
<td>3.0</td>
<td>-2.281636</td>
<td>-1.384173</td>
<td>-0.778085</td>
<td>-0.310868</td>
<td>-1.239204</td>
</tr>
<tr class="odd">
<td>4.0</td>
<td>3.008982</td>
<td>-0.733</td>
<td>0.885699</td>
<td>0.701018</td>
<td>0.413538</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>95.0</td>
<td>0.690042</td>
<td>0.259349</td>
<td>-0.450307</td>
<td>-3.9876</td>
<td>-0.151255</td>
</tr>
<tr class="even">
<td>96.0</td>
<td>0.976445</td>
<td>0.191157</td>
<td>0.273973</td>
<td>0.55265</td>
<td>0.843423</td>
</tr>
<tr class="odd">
<td>97.0</td>
<td>-0.336935</td>
<td>-0.938142</td>
<td>0.651212</td>
<td>1.041362</td>
<td>-1.109245</td>
</tr>
<tr class="even">
<td>98.0</td>
<td>-0.300744</td>
<td>0.131479</td>
<td>-1.732529</td>
<td>1.266636</td>
<td>0.721021</td>
</tr>
<tr class="odd">
<td>99.0</td>
<td>0.137244</td>
<td>0.787957</td>
<td>1.563609</td>
<td>0.532102</td>
<td>-0.060568</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Can you parse the following in your head?</p>
<div id="58892187" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>polars_frame_3 <span class="op">=</span> pl.DataFrame(make_data(<span class="dv">10</span>,<span class="dv">1</span>))</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  polars_frame.lazy()</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  .select(</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'*'</span>).name.suffix(<span class="st">'_first'</span>)</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>  .with_context(</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    polars_frame_3.lazy()</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">'*'</span>).name.suffix(<span class="st">'_third'</span>)</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  .select(</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'column_0_first'</span>,</span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>    pl.when(</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">'column_0_first'</span>).mod(<span class="dv">2</span>).eq(<span class="dv">0</span>)</span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>    .then(</span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>      pl.lit(<span class="dv">1</span>)</span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>    .otherwise(</span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>      polars_frame_3</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>      .select(</span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>        pl.last().<span class="bu">min</span>()</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>  .collect(streaming<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (100, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">column_0_first</th>
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>-1.303257</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>3.0</td>
<td>-1.303257</td>
</tr>
<tr class="odd">
<td>4.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>95.0</td>
<td>-1.303257</td>
</tr>
<tr class="even">
<td>96.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>97.0</td>
<td>-1.303257</td>
</tr>
<tr class="even">
<td>98.0</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>99.0</td>
<td>-1.303257</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="getting-help" class="level2">
<h2 class="anchored" data-anchor-id="getting-help">Getting Help</h2>
<p>Before we dive in, you should be aware of the following references for further help:</p>
<ol type="1">
<li>A <a href="https://github.com/pola-rs/Polars">github page</a>. It is particular important to subscribe to <a href="https://github.com/pola-rs/Polars/releases">release updates</a>.</li>
<li>A <a href="https://pola-rs.github.io/Polars-book/user-guide/index.html">user guide</a>.</li>
<li>A very active community on <a href="https://discord.gg/4UfP5cfBE7">Discord</a>.</li>
<li>The <a href="https://pola-rs.github.io/Polars/py-Polars/html/reference/index.html">API reference</a>.</li>
<li>A Stack-Overflow <a href="https://stackoverflow.com/questions/tagged/python-Polars">tag</a>.</li>
<li>Cheat-sheet for <a href="https://www.rhosignal.com/posts/Polars-Pandas-cheatsheet/">Pandas users</a>.</li>
</ol>
<p><strong>Warning</strong>: Be careful of AI assistants such as Github-Copilot, TabNine, etc. Polars is still very new, and they may give you Pandas completions instead of Polars.</p>
</section>
</section>
<section id="sec-series" class="level1">
<h1>Polars Series</h1>
<p>A Polars series looks a feels a lot like a Pandas series. You usually will try to avoid them because: (a) Your objects will usually be in frames, not in series. (b) If in frames, you will be calling <code>pl.Expr()</code> methods, and not <code>pl.Series()</code> methods. Getting used to Polars series, will thus give you bad intuitions when you move to Polars expressions. Nevertheless, it is the simples object to learn, so we start there.</p>
<p>Construct a series</p>
<div id="cell-make-a-series" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-a-series" class="cell-output cell-output-display" data-execution_count="71">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Make Pandas series for later comparisons.</p>
<div id="cell-make-a-Pandas-series" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>s_Pandas <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], name <span class="op">=</span> <span class="st">"a"</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>s_Pandas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-a-pandas-series" class="cell-output cell-output-display" data-execution_count="72">
<pre><code>0    1
1    2
2    3
Name: a, dtype: int64</code></pre>
</div>
</div>
<p>Notice even the printing to Jupiter is different.</p>
<div id="cell-check-series-type" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="check-series-type" class="cell-output cell-output-display" data-execution_count="73">
<pre><code>polars.series.series.Series</code></pre>
</div>
</div>
<div id="cell-check-Pandas-series-type" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(s_Pandas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="check-pandas-series-type" class="cell-output cell-output-display" data-execution_count="74">
<pre><code>pandas.core.series.Series</code></pre>
</div>
</div>
<div id="cell-check-series-dtype" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>s.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="check-series-dtype" class="cell-output cell-output-display" data-execution_count="75">
<pre><code>Int64</code></pre>
</div>
</div>
<div id="cell-check-Pandas-series-dtype" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>s_Pandas.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="check-pandas-series-dtype" class="cell-output cell-output-display" data-execution_count="76">
<pre><code>dtype('int64')</code></pre>
</div>
</div>
<p>Renaming a series; will be very useful when operating on dataframe columns.</p>
<div id="cell-rename-series" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>s.alias(<span class="st">"b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="rename-series" class="cell-output cell-output-display" data-execution_count="77">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">b</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Constructing a series of floats, for later use.</p>
<div id="cell-make-a-float-series" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="fl">1.</span>, <span class="fl">2.</span>, <span class="fl">3.</span>])</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-a-float-series" class="cell-output cell-output-display" data-execution_count="78">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-check-float-series-dtype" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>f.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="check-float-series-dtype" class="cell-output cell-output-display" data-execution_count="79">
<pre><code>Float64</code></pre>
</div>
</div>
<section id="export-to-other-python-objects" class="level2">
<h2 class="anchored" data-anchor-id="export-to-other-python-objects">Export To Other Python Objects</h2>
<p>The current section deals with exports to other python objects, <strong>in memory</strong>. See <a href="#sec-disk-export" class="quarto-xref">Section&nbsp;6.2</a> for exporting to disk.</p>
<p>Export to Polars DataFrame.</p>
<div id="cell-series-to-Polars-dataframe" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>s.to_frame() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-to-polars-dataframe" class="cell-output cell-output-display" data-execution_count="80">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Export to Python list.</p>
<div id="cell-series-to-list" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>s.to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-to-list" class="cell-output cell-output-display" data-execution_count="81">
<pre><code>[1, 2, 3]</code></pre>
</div>
</div>
<p>Export to Numpy array.</p>
<div id="cell-series-to-numpy" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>s.to_numpy() <span class="co"># useful for preparing data for learning with scikit-learn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-to-numpy" class="cell-output cell-output-display" data-execution_count="82">
<pre><code>array([1, 2, 3])</code></pre>
</div>
</div>
<p>Export to Pandas Series.</p>
<div id="cell-series-to-Pandas-series" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>s.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-to-pandas-series" class="cell-output cell-output-display" data-execution_count="83">
<pre><code>0    1
1    2
2    3
Name: a, dtype: int64</code></pre>
</div>
</div>
<p>Export to Arrow Array. Useful for preparing data for learning with XGBoost which supports Arrow. Maybe Scikit-learn will also support Arrow in the future? Although Scikit-learn <a href="https://github.com/scikit-learn/scikit-learn/issues/25896">may support Polars</a> before it supports Arrow.</p>
<div id="cell-series-to-arrow" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>s.to_arrow() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-to-arrow" class="cell-output cell-output-display" data-execution_count="84">
<pre><code>&lt;pyarrow.lib.Int64Array object at 0x29b672e80&gt;
[
  1,
  2,
  3
]</code></pre>
</div>
</div>
</section>
<section id="memory-representation-of-series" class="level2">
<h2 class="anchored" data-anchor-id="memory-representation-of-series">Memory Representation of Series</h2>
<p>Object size in memory. Super useful for profiling. Will only be available for eager objects; by definitions.</p>
<div id="cell-series-memory-size" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>s.estimated_size(unit<span class="op">=</span><span class="st">"b"</span>) <span class="co"># 8(bytes) * 3(length)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-memory-size" class="cell-output cell-output-display" data-execution_count="85">
<pre><code>24</code></pre>
</div>
</div>
</section>
<section id="sec-filtering-subsetting-series" class="level2">
<h2 class="anchored" data-anchor-id="sec-filtering-subsetting-series">Filtering and Subsetting</h2>
<div id="91d4bdbc" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>s[<span class="dv">0</span>] <span class="co"># same as s.__getitem__(0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>1</code></pre>
</div>
</div>
<p>To filter, you need to use the <code>.filter()</code> method.</p>
<div id="cell-series-filter-with-series" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">filter</span>(pl.Series(<span class="st">"a"</span>, [<span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>])) <span class="co"># works</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-filter-with-series" class="cell-output cell-output-display" data-execution_count="87">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Filtering with the <code>[</code> operator will not work:</p>
<div id="series-subset-with-boolean" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>s[[<span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-series-filter-with-list" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">filter</span>([<span class="va">True</span>, <span class="va">False</span>, <span class="va">True</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-filter-with-list" class="cell-output cell-output-display" data-execution_count="88">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-limit" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>s.limit(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-limit" class="cell-output cell-output-display" data-execution_count="89">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-head" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>s.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-head" class="cell-output cell-output-display" data-execution_count="90">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-tail" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>s.tail(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-tail" class="cell-output cell-output-display" data-execution_count="91">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-sample" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>s.sample(<span class="dv">2</span>, with_replacement<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-sample" class="cell-output cell-output-display" data-execution_count="92">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-gather-aka-iloc" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>s.gather([<span class="dv">0</span>, <span class="dv">2</span>]) <span class="co"># same as s[0,2] and Pandas .iloc[[0,2]]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-gather-aka-iloc" class="cell-output cell-output-display" data-execution_count="93">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-slice" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">slice</span>(<span class="dv">1</span>, <span class="dv">2</span>) <span class="co"># same as Pandas .iloc[1:2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-slice" class="cell-output cell-output-display" data-execution_count="94">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-gather-every" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>s.gather_every(<span class="dv">2</span>) <span class="co"># same as Pandas .iloc[::2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-gather-every" class="cell-output cell-output-display" data-execution_count="95">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="aggregations" class="level2">
<h2 class="anchored" data-anchor-id="aggregations">Aggregations</h2>
<div id="cell-series-sum" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-sum" class="cell-output cell-output-display" data-execution_count="96">
<pre><code>6</code></pre>
</div>
</div>
<div id="cell-series-min" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-min" class="cell-output cell-output-display" data-execution_count="97">
<pre><code>1</code></pre>
</div>
</div>
<div id="cell-series-arg-min" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>s.arg_min()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-arg-min" class="cell-output cell-output-display" data-execution_count="98">
<pre><code>0</code></pre>
</div>
</div>
<div id="cell-series-max" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-max" class="cell-output cell-output-display" data-execution_count="99">
<pre><code>3</code></pre>
</div>
</div>
<div id="cell-series-arg-max" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>s.arg_max()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-arg-max" class="cell-output cell-output-display" data-execution_count="100">
<pre><code>2</code></pre>
</div>
</div>
<div id="cell-series-mean" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>s.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-mean" class="cell-output cell-output-display" data-execution_count="101">
<pre><code>2.0</code></pre>
</div>
</div>
<div id="cell-series-median" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>s.median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-median" class="cell-output cell-output-display" data-execution_count="102">
<pre><code>2.0</code></pre>
</div>
</div>
<div id="cell-series-quantile" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>s.quantile(<span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-quantile" class="cell-output cell-output-display" data-execution_count="103">
<pre><code>1.0</code></pre>
</div>
</div>
<div id="cell-series-entropy" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>s.entropy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-entropy" class="cell-output cell-output-display" data-execution_count="104">
<pre><code>-4.68213122712422</code></pre>
</div>
</div>
<div id="cell-Polars-series-describe" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>s.describe() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="polars-series-describe" class="cell-output cell-output-display" data-execution_count="105">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
<tr class="odd">
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"count"</td>
<td>3.0</td>
</tr>
<tr class="even">
<td>"null_count"</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>"mean"</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>"std"</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>"min"</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Polars <code>pl.series.describe()</code> is almost the same as Pandas <code>pd.series.describe()</code>.</p>
<div id="cell-Pandas-series-describe" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>s_Pandas.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="pandas-series-describe" class="cell-output cell-output-display" data-execution_count="106">
<pre><code>count    3.0
mean     2.0
std      1.0
min      1.0
25%      1.5
50%      2.0
75%      2.5
max      3.0
Name: a, dtype: float64</code></pre>
</div>
</div>
<div id="cell-series-value-counts" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>s.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-value-counts" class="cell-output cell-output-display" data-execution_count="107">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="missing" class="level2">
<h2 class="anchored" data-anchor-id="missing">Missing</h2>
<p>Thanks to Arrow, Polars has built in missing value support for all(!) dtypes. This has been a long awaited feature in the Python data science ecosystem with implications on speed, memory, style and more. The <a href="https://pola-rs.github.io/Polars-book/user-guide/howcani/missing_data.html">Polars User Guide</a> has a great overview of the topic from which we collect some take-homes:</p>
<ul>
<li><code>np.nan</code> is also supported along <code>pl.Null</code>, but is not considered as a missing value by Polars. This has implications on null counts, statistical aggregations, etc.</li>
<li><code>pl.Null</code>, and <code>np.nan</code>s have their own separate functions for imputing, counting, etc.</li>
</ul>
<div id="db8e9d26" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="dv">1</span>, <span class="dv">2</span>, <span class="va">None</span>, np.nan])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cd1c9215" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>m.is_null() <span class="co"># checking for None's. Like Pandas .isna()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="88474b53" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>m.is_nan() <span class="co"># checking for np.nan's</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>For comparison with Pandas:</p>
<div id="e9419cfd" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>m_Pandas <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="va">None</span>, np.nan])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bfb5b8db" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>m_Pandas.isna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>0    False
1    False
2     True
3     True
dtype: bool</code></pre>
</div>
</div>
<div id="781720d2" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>m_Pandas.isnull() <span class="co"># alias for pd.isna()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>0    False
1    False
2     True
3     True
dtype: bool</code></pre>
</div>
</div>
<section id="operating-on-missing" class="level3">
<h3 class="anchored" data-anchor-id="operating-on-missing">Operating on Missing</h3>
<p>We now compare the behavior of Polars to Pandas when operating on missing values. When interpreting the following remember:</p>
<ol type="1">
<li>For Polars, nan is not missing. It is some unknown number.</li>
<li>For Pandas, nan and Nulls are the same.</li>
</ol>
<div id="a6555dcf" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Polars</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="dv">1</span>, <span class="va">None</span>, <span class="dv">2</span>, ]) <span class="co"># python native None</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="dv">1</span>, np.nan, <span class="dv">2</span>, ]) <span class="co"># numpy's nan</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>m3 <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="dv">1</span>, <span class="bu">float</span>(<span class="st">'nan'</span>), <span class="dv">2</span>, ]) <span class="co"># python's nan</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pandas</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>m4 <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="va">None</span>, <span class="dv">2</span> ])</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>m5 <span class="op">=</span> pd.Series([<span class="dv">1</span>, np.nan, <span class="dv">2</span>, ])</span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>m6 <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="bu">float</span>(<span class="st">'nan'</span>), <span class="dv">2</span>, ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4b4b5292" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>  m1.<span class="bu">sum</span>(), </span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  m2.<span class="bu">sum</span>(), </span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  m3.<span class="bu">sum</span>(), </span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>  m4.<span class="bu">sum</span>(), </span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>  m5.<span class="bu">sum</span>(), </span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>  m6.<span class="bu">sum</span>(),</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>  ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>[3, nan, nan, 3.0, 3.0, 3.0]</code></pre>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>None</code> will be ignored by both, which is <strong>unsafe</strong>.</li>
<li><code>np.nan</code> will be ignored by Pandas (unsafe), but not by Polars (safe).</li>
</ul>
<p>Filling missing values; <code>None</code> and <code>np.nan</code> are treated differently:</p>
<div id="cell-series-fill-null-for-null" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>m1.fill_null(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-fill-null-for-null" class="cell-output cell-output-display" data-execution_count="116">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-fill-null-for-nan" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>m2.fill_null(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-fill-null-for-nan" class="cell-output cell-output-display" data-execution_count="117">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>NaN</td>
</tr>
<tr class="odd">
<td>2.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-fill-nan-for-nan" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>m2.fill_nan(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-fill-nan-for-nan" class="cell-output cell-output-display" data-execution_count="118">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>0.0</td>
</tr>
<tr class="odd">
<td>2.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-drop-null-for-null" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>m1.drop_nulls()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-drop-null-for-null" class="cell-output cell-output-display" data-execution_count="119">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-drop-nan-for-null" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>m1.drop_nans()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-drop-nan-for-null" class="cell-output cell-output-display" data-execution_count="120">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-drop-null-for-nan" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>m2.drop_nulls()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-drop-null-for-nan" class="cell-output cell-output-display" data-execution_count="121">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>NaN</td>
</tr>
<tr class="odd">
<td>2.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-interpolate-null-for-null" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>m1.interpolate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-interpolate-null-for-null" class="cell-output cell-output-display" data-execution_count="122">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>1.5</td>
</tr>
<tr class="odd">
<td>2.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-interpolate-null-for-nan" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>m2.interpolate() <span class="co"># np.nan is not considered missing, so why interpolate?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-interpolate-null-for-nan" class="cell-output cell-output-display" data-execution_count="123">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>NaN</td>
</tr>
<tr class="odd">
<td>2.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="shape-transformations" class="level2">
<h2 class="anchored" data-anchor-id="shape-transformations">Shape Transformations</h2>
<div id="cell-series-to-dummies" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>s.to_dummies()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-to-dummies" class="cell-output cell-output-display" data-execution_count="124">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a_1</th>
<th data-quarto-table-cell-role="th">a_2</th>
<th data-quarto-table-cell-role="th">a_3</th>
</tr>
<tr class="odd">
<th>u8</th>
<th>u8</th>
<th>u8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-shift" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>s.shift(<span class="dv">1</span>, fill_value<span class="op">=</span><span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-shift" class="cell-output cell-output-display" data-execution_count="125">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>999</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-shift-back" class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>s.shift(<span class="op">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-shift-back" class="cell-output cell-output-display" data-execution_count="126">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-reshape" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>pl.Series(<span class="st">"a"</span>,[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]).reshape((<span class="dv">2</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-reshape" class="cell-output cell-output-display" data-execution_count="127">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[1, 2]</td>
</tr>
<tr class="even">
<td>[3, 4]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="arithmetic-operations" class="level2">
<h2 class="anchored" data-anchor-id="arithmetic-operations">Arithmetic Operations</h2>
<p>The following will fail for <code>pl.Series</code> for will work(!) for <code>pl.Expr</code>.</p>
<div id="series-add" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>s.add(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="series-sub" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>s.sub(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="series-mul" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>s.mul(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="series-truediv" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>s.truediv(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="series-floordiv" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>s.floordiv(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mathematical-transformations" class="level2">
<h2 class="anchored" data-anchor-id="mathematical-transformations">Mathematical Transformations</h2>
<div id="cell-series-abs" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">abs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-abs" class="cell-output cell-output-display" data-execution_count="128">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-sin" class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>s.sin()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-sin" class="cell-output cell-output-display" data-execution_count="129">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.841471</td>
</tr>
<tr class="even">
<td>0.909297</td>
</tr>
<tr class="odd">
<td>0.14112</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-exp" class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>s.exp()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-exp" class="cell-output cell-output-display" data-execution_count="130">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2.718282</td>
</tr>
<tr class="even">
<td>7.389056</td>
</tr>
<tr class="odd">
<td>20.085537</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-hash" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>s.<span class="bu">hash</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-hash" class="cell-output cell-output-display" data-execution_count="131">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>u64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>13306526652308846960</td>
</tr>
<tr class="even">
<td>10493018799795767247</td>
</tr>
<tr class="odd">
<td>7189915626077311336</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-log" class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>s.log()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-log" class="cell-output cell-output-display" data-execution_count="132">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
</tr>
<tr class="even">
<td>0.693147</td>
</tr>
<tr class="odd">
<td>1.098612</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-sqrt" class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>s.sqrt()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-sqrt" class="cell-output cell-output-display" data-execution_count="133">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>1.414214</td>
</tr>
<tr class="odd">
<td>1.732051</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="comparisons" class="level2">
<h2 class="anchored" data-anchor-id="comparisons">Comparisons</h2>
<div id="6fe2d6ec" class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>s.equals(pl.Series(<span class="st">"a"</span>, [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>True</code></pre>
</div>
</div>
<div id="cell-series-eq" class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>s.eq(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-eq" class="cell-output cell-output-display" data-execution_count="135">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-ge" class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>s.ge(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-ge" class="cell-output cell-output-display" data-execution_count="136">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Clip, aka Winsorize.</p>
<div id="cell-series-clip" class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>f.clip(lower_bound<span class="op">=</span><span class="fl">1.5</span>,upper_bound<span class="op">=</span><span class="fl">2.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-clip" class="cell-output cell-output-display" data-execution_count="137">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.5</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>2.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-round" class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>f.<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-round" class="cell-output cell-output-display" data-execution_count="138">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-ceil" class="cell" data-execution_count="145">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>f.ceil()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-ceil" class="cell-output cell-output-display" data-execution_count="139">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-floor" class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>f.floor()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-floor" class="cell-output cell-output-display" data-execution_count="140">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-which-max" class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>s.peak_max()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-which-max" class="cell-output cell-output-display" data-execution_count="141">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="search" class="level2">
<h2 class="anchored" data-anchor-id="search">Search</h2>
<div id="cell-series-search-in-list" class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>s.is_in([<span class="dv">1</span>, <span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-search-in-list" class="cell-output cell-output-display" data-execution_count="142">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-search-in-range" class="cell" data-execution_count="149">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>s.is_between(<span class="dv">2</span>, <span class="dv">3</span>, closed<span class="op">=</span><span class="st">'both'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-search-in-range" class="cell-output cell-output-display" data-execution_count="143">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="apply-map_elements" class="level2">
<h2 class="anchored" data-anchor-id="apply-map_elements">Apply (map_elements)</h2>
<p>Applying your own function. Also note the informative error message (introduced in Polars Ver 0.18.0) that will try to recommend a more efficient way to do things.</p>
<div id="5ec8fe21" class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>s.map_elements(<span class="kw">lambda</span> x: x <span class="op">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/2438314803.py:1: PolarsInefficientMapWarning:


Series.map_elements is significantly slower than the native series API.
Only use if you absolutely CANNOT implement your logic otherwise.
Replace this expression...
  - s.map_elements(lambda x: ...)
with this one instead:
  + s + 1

</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="144">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Are lambda functions really so much slower?</p>
<div id="a2b2d7af" class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> pl.Series(np.random.randn(<span class="bu">int</span>(<span class="fl">1e6</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adding 1 with apply:</p>
<div id="39f9683a" class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 s1.map_elements(<span class="kw">lambda</span> x: x <span class="op">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>142 ms ± 3.66 ms per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<p>Adding 1 without apply:</p>
<div id="f50e3fea" class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 s1<span class="op">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>861 µs ± 77.7 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
</section>
<section id="cumulative-operations" class="level2">
<h2 class="anchored" data-anchor-id="cumulative-operations">Cumulative Operations</h2>
<div id="cell-series-cum-max" class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>s.cum_max()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-cum-max" class="cell-output cell-output-display" data-execution_count="148">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-cumsum" class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>s.cum_sum()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-cumsum" class="cell-output cell-output-display" data-execution_count="149">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-cumprod" class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>s.cum_prod()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-cumprod" class="cell-output cell-output-display" data-execution_count="150">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-ewm" class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>s.ewm_mean(com<span class="op">=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/799281854.py:1: DeprecationWarning:

The default value for `ignore_nulls` for `ewm` methods will change from True to False in the next breaking release. Explicitly set `ignore_nulls=True` to keep the existing behavior and silence this warning.
</code></pre>
</div>
<div id="series-ewm" class="cell-output cell-output-display" data-execution_count="151">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>1.75</td>
</tr>
<tr class="odd">
<td>2.615385</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="differentiation-operations" class="level2">
<h2 class="anchored" data-anchor-id="differentiation-operations">Differentiation Operations</h2>
<div id="cell-series-diff" class="cell" data-execution_count="158">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>s.diff()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-diff" class="cell-output cell-output-display" data-execution_count="152">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-pct-change" class="cell" data-execution_count="159">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>s.pct_change()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-pct-change" class="cell-output cell-output-display" data-execution_count="153">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>1.0</td>
</tr>
<tr class="odd">
<td>0.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="windowed-operations" class="level2">
<h2 class="anchored" data-anchor-id="windowed-operations">Windowed Operations</h2>
<div id="cell-series-rolling-mean" class="cell" data-execution_count="160">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>s.rolling_mean(window_size<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-rolling-mean" class="cell-output cell-output-display" data-execution_count="154">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>1.5</td>
</tr>
<tr class="odd">
<td>2.5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-rolling-sum" class="cell" data-execution_count="161">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>s.rolling_sum(window_size<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-rolling-sum" class="cell-output cell-output-display" data-execution_count="155">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-rolling-map" class="cell" data-execution_count="162">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>s.rolling_map(</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">sum</span>, </span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>  window_size<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-rolling-map" class="cell-output cell-output-display" data-execution_count="156">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Note:</p>
<ul>
<li><code>sum</code> is the <code>pl.sum()</code> function. You cannot use arbitrary functions within a <code>rolling_map()</code> context.</li>
<li>Many rolling functions have been prepared. See the <a href="https://docs.pola.rs/py-Polars/html/reference/series/computation.html">computations section</a> of the Series class in the official API.</li>
</ul>
</section>
<section id="logical-aggregations" class="level2">
<h2 class="anchored" data-anchor-id="logical-aggregations">Logical Aggregations</h2>
<div id="cell-make-boolean-series" class="cell" data-execution_count="163">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>])</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a>b.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="make-boolean-series" class="cell-output cell-output-display" data-execution_count="157">
<pre><code>Boolean</code></pre>
</div>
</div>
<div id="cell-series-all" class="cell" data-execution_count="164">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>b.<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-all" class="cell-output cell-output-display" data-execution_count="158">
<pre><code>False</code></pre>
</div>
</div>
<div id="cell-series-any" class="cell" data-execution_count="165">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>b.<span class="bu">any</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-any" class="cell-output cell-output-display" data-execution_count="159">
<pre><code>True</code></pre>
</div>
</div>
<div id="cell-series-not" class="cell" data-execution_count="166">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>b.not_()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-not" class="cell-output cell-output-display" data-execution_count="160">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="uniques-and-duplicates" class="level2">
<h2 class="anchored" data-anchor-id="uniques-and-duplicates">Uniques and Duplicates</h2>
<div id="cell-series-is-duplicated" class="cell" data-execution_count="167">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>s.is_duplicated()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-is-duplicated" class="cell-output cell-output-display" data-execution_count="161">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-is-unique" class="cell" data-execution_count="168">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>s.is_unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-is-unique" class="cell-output cell-output-display" data-execution_count="162">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-n-unique" class="cell" data-execution_count="169">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>s.unique() <span class="co"># Same as Pandas drop_duplicates()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-n-unique" class="cell-output cell-output-display" data-execution_count="163">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="ed7a8c2f" class="cell" data-execution_count="170">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>s.n_unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="164">
<pre><code>3</code></pre>
</div>
</div>
<div id="bd1949ed" class="cell" data-execution_count="171">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>pl.Series([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>]).unique_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="165">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="odd">
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-is-first-distinct" class="cell" data-execution_count="172">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>s.is_first_distinct() <span class="co"># not sure there is a pl.Expr method </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-is-first-distinct" class="cell-output cell-output-display" data-execution_count="166">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Notes:</p>
<ul>
<li><p><code>is_first_distinct()</code> has had many name changes in the past. It was <code>is_first()</code> in Polars 0.18.0, and <code>is_first_distinct()</code> in Polars 0.19.0.</p></li>
<li><p>Do not confuse <code>.is_first_distinct()</code> with <code>.first()</code>. The former is a logical aggregation, and the latter is a series method.</p></li>
</ul>
<div id="cell-first-counter-examples" class="cell" data-execution_count="173">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>  pl.DataFrame(pl.Series(<span class="st">"a"</span>,[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>]))</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>  .select(</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'a'</span>).first()</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="first-counter-examples" class="cell-output cell-output-display" data-execution_count="167">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="casting" class="level2">
<h2 class="anchored" data-anchor-id="casting">Casting</h2>
<div id="7f3c41f4" class="cell" data-execution_count="174">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a>s.cast(pl.Int32)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="168">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>cast()</code> is Polars’ equivalent of Pandas’ <code>astype()</code>.</li>
<li>The dtypes to cast to are <strong>Polars</strong> dtypes. Don’t try <code>s.cast("int32")</code>, <code>s.cast(np.int32)</code>, or <code>s.cast(pd.int)</code></li>
<li>For a list of dtypes see the official <a href="see%20https://pola-rs.github.io/Polars/py-Polars/html/reference/datatypes.html">documentation</a>.</li>
</ul>
<p>Find the most efficient dtype for a series; Like Pandas <code>pd.to_numeric(..., downcast="..."</code>).</p>
<div id="1588b988" class="cell" data-execution_count="175">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>s.shrink_dtype().dtype <span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="169">
<pre><code>Int8</code></pre>
</div>
</div>
<p>Also see <a href="http://braaannigan.github.io/software/2022/10/31/Polars-dtype-diet.html">here</a>.</p>
<p>Shrink the memory allocation to the size of the actual data (in place).</p>
<div id="dfbce4c0" class="cell" data-execution_count="176">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>s.shrink_to_fit() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="170">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="ordering-and-sorting" class="level2">
<h2 class="anchored" data-anchor-id="ordering-and-sorting">Ordering and Sorting</h2>
<div id="cell-series-sort" class="cell" data-execution_count="177">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>s.sort()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-sort" class="cell-output cell-output-display" data-execution_count="171">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-reverse" class="cell" data-execution_count="178">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>s.reverse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-reverse" class="cell-output cell-output-display" data-execution_count="172">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-rank" class="cell" data-execution_count="179">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>s.rank()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-rank" class="cell-output cell-output-display" data-execution_count="173">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
</tr>
<tr class="even">
<td>2.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-series-arg-sort" class="cell" data-execution_count="180">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>s.arg_sort() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-arg-sort" class="cell-output cell-output-display" data-execution_count="174">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p><code>arg_sort()</code> returns the indices that would sort the series. Same as R’s <code>order()</code>.</p>
<div id="b813726c" class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>sorted_s <span class="op">=</span> s[s.arg_sort()]</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>(s.sort() <span class="op">==</span> sorted_s).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="175">
<pre><code>True</code></pre>
</div>
</div>
<div id="cell-series-shuffle" class="cell" data-execution_count="182">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>s.shuffle(seed<span class="op">=</span><span class="dv">1</span>) <span class="co"># random permutation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="series-shuffle" class="cell-output cell-output-display" data-execution_count="176">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="date-and-time" class="level2">
<h2 class="anchored" data-anchor-id="date-and-time">Date and Time</h2>
<p>There are 4 datetime dtypes in Polars:</p>
<ol type="1">
<li><strong>Date</strong>: A date, without hours. Generated with <code>pl.Date()</code>.</li>
<li><strong>Datetime</strong>: Date and hours. Generated with <code>pl.Datetime()</code>.</li>
<li><strong>Time</strong>: Hour of day. Generated with <code>pl.Time()</code>.</li>
<li><strong>Duration</strong>: As the name suggests. Similar to <code>timedelta</code> in Pandas. Generated with <code>pl.Duration()</code>.</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Python has a sea of modules that support datetimes. A partial list includes: <a href="https://docs.python.org/3/library/datetime.html">datetime module</a>, extensions in <a href="https://dateutil.readthedocs.io/en/stable/">dateutil</a>, <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html">numpy</a>, <a href="https://Pandas.pydata.org/Pandas-docs/version/1.1/user_guide/timeseries.html">Pandas</a>, <a href="https://arrow.readthedocs.io/en/latest/">arrow</a>, the deprecated <a href="https://pytseries.sourceforge.net/">scikits.timeseries</a> and certainly others. Be aware of the dtype you are using, and the accompanying methods.</p>
</div>
</div>
<section id="time-range" class="level3">
<h3 class="anchored" data-anchor-id="time-range">Time Range</h3>
<div id="f767ee58" class="cell" data-execution_count="183">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>date <span class="op">=</span> (</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>  pl.datetime_range(</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> datetime(</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>      year<span class="op">=</span> <span class="dv">2001</span>, month<span class="op">=</span><span class="dv">2</span>, day<span class="op">=</span><span class="dv">2</span>, hour <span class="op">=</span><span class="dv">2</span>, minute<span class="op">=</span><span class="dv">24</span>, second<span class="op">=</span><span class="dv">12</span>), </span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>    end <span class="op">=</span> datetime(</span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a>      year<span class="op">=</span><span class="dv">2002</span>, month<span class="op">=</span><span class="dv">2</span>, day<span class="op">=</span><span class="dv">5</span>, hour <span class="op">=</span><span class="dv">5</span>, minute<span class="op">=</span><span class="dv">34</span>, second<span class="op">=</span><span class="dv">45</span>),</span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a>    interval<span class="op">=</span><span class="st">'1s'</span>, </span>
<span id="cb276-10"><a href="#cb276-10" aria-hidden="true" tabindex="-1"></a>    eager<span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb276-11"><a href="#cb276-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb276-12"><a href="#cb276-12" aria-hidden="true" tabindex="-1"></a>  .sample(<span class="dv">10</span>)</span>
<span id="cb276-13"><a href="#cb276-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb276-14"><a href="#cb276-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-15"><a href="#cb276-15" aria-hidden="true" tabindex="-1"></a>date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="177">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2001-09-07 07:08:04</td>
</tr>
<tr class="even">
<td>2002-02-02 05:18:54</td>
</tr>
<tr class="odd">
<td>2001-08-20 22:16:27</td>
</tr>
<tr class="even">
<td>2001-09-20 07:02:30</td>
</tr>
<tr class="odd">
<td>2001-08-14 05:40:31</td>
</tr>
<tr class="even">
<td>2001-10-04 18:34:23</td>
</tr>
<tr class="odd">
<td>2001-11-12 01:40:21</td>
</tr>
<tr class="even">
<td>2001-10-11 19:02:14</td>
</tr>
<tr class="odd">
<td>2001-09-28 09:49:35</td>
</tr>
<tr class="even">
<td>2001-04-03 14:00:05</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>How else could I have constructed this series? What other types are accepted as <code>start</code> and <code>end</code>?</li>
<li><code>pl.date_range</code> may return a series of dtype <code>Date</code> or <code>Datetime</code>. This depens of the granularity of the inputs.</li>
</ul>
<div id="e83bb5ea" class="cell" data-execution_count="184">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>date.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="178">
<pre><code>Datetime(time_unit='us', time_zone=None)</code></pre>
</div>
</div>
<p>Cast to different time unit. May be useful when joining datasets, and the time unit is different.</p>
<div id="a63365ad" class="cell" data-execution_count="185">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>date.dt.cast_time_unit(time_unit<span class="op">=</span><span class="st">"ms"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="179">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>datetime[ms]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2001-09-07 07:08:04</td>
</tr>
<tr class="even">
<td>2002-02-02 05:18:54</td>
</tr>
<tr class="odd">
<td>2001-08-20 22:16:27</td>
</tr>
<tr class="even">
<td>2001-09-20 07:02:30</td>
</tr>
<tr class="odd">
<td>2001-08-14 05:40:31</td>
</tr>
<tr class="even">
<td>2001-10-04 18:34:23</td>
</tr>
<tr class="odd">
<td>2001-11-12 01:40:21</td>
</tr>
<tr class="even">
<td>2001-10-11 19:02:14</td>
</tr>
<tr class="odd">
<td>2001-09-28 09:49:35</td>
</tr>
<tr class="even">
<td>2001-04-03 14:00:05</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Datetime methods are accessed with the <code>.dt</code> namespace.</p>
</section>
<section id="extract-time-sub-units" class="level3">
<h3 class="anchored" data-anchor-id="extract-time-sub-units">Extract Time Sub-Units</h3>
<div id="f7b0ba0f" class="cell" data-execution_count="186">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>date.dt.second()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="180">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4</td>
</tr>
<tr class="even">
<td>54</td>
</tr>
<tr class="odd">
<td>27</td>
</tr>
<tr class="even">
<td>30</td>
</tr>
<tr class="odd">
<td>31</td>
</tr>
<tr class="even">
<td>23</td>
</tr>
<tr class="odd">
<td>21</td>
</tr>
<tr class="even">
<td>14</td>
</tr>
<tr class="odd">
<td>35</td>
</tr>
<tr class="even">
<td>5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="ab63cb78" class="cell" data-execution_count="187">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>date.dt.minute()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="181">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>8</td>
</tr>
<tr class="even">
<td>18</td>
</tr>
<tr class="odd">
<td>16</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>40</td>
</tr>
<tr class="even">
<td>34</td>
</tr>
<tr class="odd">
<td>40</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>49</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="273a5fd1" class="cell" data-execution_count="188">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>date.dt.hour()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="182">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
</tr>
<tr class="even">
<td>5</td>
</tr>
<tr class="odd">
<td>22</td>
</tr>
<tr class="even">
<td>7</td>
</tr>
<tr class="odd">
<td>5</td>
</tr>
<tr class="even">
<td>18</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>19</td>
</tr>
<tr class="odd">
<td>9</td>
</tr>
<tr class="even">
<td>14</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="ecba0e10" class="cell" data-execution_count="189">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>date.dt.day()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="183">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>20</td>
</tr>
<tr class="even">
<td>20</td>
</tr>
<tr class="odd">
<td>14</td>
</tr>
<tr class="even">
<td>4</td>
</tr>
<tr class="odd">
<td>12</td>
</tr>
<tr class="even">
<td>11</td>
</tr>
<tr class="odd">
<td>28</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cd616af9" class="cell" data-execution_count="190">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>date.dt.week()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="184">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>36</td>
</tr>
<tr class="even">
<td>5</td>
</tr>
<tr class="odd">
<td>34</td>
</tr>
<tr class="even">
<td>38</td>
</tr>
<tr class="odd">
<td>33</td>
</tr>
<tr class="even">
<td>40</td>
</tr>
<tr class="odd">
<td>46</td>
</tr>
<tr class="even">
<td>41</td>
</tr>
<tr class="odd">
<td>39</td>
</tr>
<tr class="even">
<td>14</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="d5071edf" class="cell" data-execution_count="191">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>date.dt.weekday()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="185">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
</tr>
<tr class="even">
<td>6</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>4</td>
</tr>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
</tr>
<tr class="odd">
<td>5</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="16d60484" class="cell" data-execution_count="192">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>date.dt.month()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="186">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>9</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>8</td>
</tr>
<tr class="even">
<td>9</td>
</tr>
<tr class="odd">
<td>8</td>
</tr>
<tr class="even">
<td>10</td>
</tr>
<tr class="odd">
<td>11</td>
</tr>
<tr class="even">
<td>10</td>
</tr>
<tr class="odd">
<td>9</td>
</tr>
<tr class="even">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="197871f9" class="cell" data-execution_count="193">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>date.dt.year()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="187">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2001</td>
</tr>
<tr class="even">
<td>2002</td>
</tr>
<tr class="odd">
<td>2001</td>
</tr>
<tr class="even">
<td>2001</td>
</tr>
<tr class="odd">
<td>2001</td>
</tr>
<tr class="even">
<td>2001</td>
</tr>
<tr class="odd">
<td>2001</td>
</tr>
<tr class="even">
<td>2001</td>
</tr>
<tr class="odd">
<td>2001</td>
</tr>
<tr class="even">
<td>2001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="9db973af" class="cell" data-execution_count="194">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>date.dt.ordinal_day() <span class="co"># day in year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="188">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i16</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>250</td>
</tr>
<tr class="even">
<td>33</td>
</tr>
<tr class="odd">
<td>232</td>
</tr>
<tr class="even">
<td>263</td>
</tr>
<tr class="odd">
<td>226</td>
</tr>
<tr class="even">
<td>277</td>
</tr>
<tr class="odd">
<td>316</td>
</tr>
<tr class="even">
<td>284</td>
</tr>
<tr class="odd">
<td>271</td>
</tr>
<tr class="even">
<td>93</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="8ac1c8e5" class="cell" data-execution_count="195">
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>date.dt.quarter()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="189">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>4</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
<tr class="even">
<td>4</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="durations" class="level3">
<h3 class="anchored" data-anchor-id="durations">Durations</h3>
<p>Equivalent to Pandas <code>period</code> dtype.</p>
<div id="4ea31fc4" class="cell" data-execution_count="196">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>diffs <span class="op">=</span> date.diff()</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>diffs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="190">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>duration[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>147d 22h 10m 50s</td>
</tr>
<tr class="odd">
<td>-165d -7h -2m -27s</td>
</tr>
<tr class="even">
<td>30d 8h 46m 3s</td>
</tr>
<tr class="odd">
<td>-37d -1h -21m -59s</td>
</tr>
<tr class="even">
<td>51d 12h 53m 52s</td>
</tr>
<tr class="odd">
<td>38d 7h 5m 58s</td>
</tr>
<tr class="even">
<td>-31d -6h -38m -7s</td>
</tr>
<tr class="odd">
<td>-13d -9h -12m -39s</td>
</tr>
<tr class="even">
<td>-177d -19h -49m -30s</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="69096017" class="cell" data-execution_count="197">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>diffs.dtype</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="191">
<pre><code>Duration(time_unit='us')</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The extrator of sub-units from a <code>pl.Duration</code> has recently changed from <code>.dt.X()</code> to <code>.dt.total_X()</code>.</p>
</div>
</div>
<div id="7d8a9b16" class="cell" data-execution_count="198">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>diffs.dt.total_seconds()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="192">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>12780650</td>
</tr>
<tr class="odd">
<td>-14281347</td>
</tr>
<tr class="even">
<td>2623563</td>
</tr>
<tr class="odd">
<td>-3201719</td>
</tr>
<tr class="even">
<td>4452832</td>
</tr>
<tr class="odd">
<td>3308758</td>
</tr>
<tr class="even">
<td>-2702287</td>
</tr>
<tr class="odd">
<td>-1156359</td>
</tr>
<tr class="even">
<td>-15364170</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="8eba1ea1" class="cell" data-execution_count="199">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>diffs.dt.total_minutes()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="193">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>213010</td>
</tr>
<tr class="odd">
<td>-238022</td>
</tr>
<tr class="even">
<td>43726</td>
</tr>
<tr class="odd">
<td>-53361</td>
</tr>
<tr class="even">
<td>74213</td>
</tr>
<tr class="odd">
<td>55145</td>
</tr>
<tr class="even">
<td>-45038</td>
</tr>
<tr class="odd">
<td>-19272</td>
</tr>
<tr class="even">
<td>-256069</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="80ebae99" class="cell" data-execution_count="200">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>diffs.dt.days()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/1692501085.py:1: DeprecationWarning:

`days` is deprecated. It has been renamed to `total_days`.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="194">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>147</td>
</tr>
<tr class="odd">
<td>-165</td>
</tr>
<tr class="even">
<td>30</td>
</tr>
<tr class="odd">
<td>-37</td>
</tr>
<tr class="even">
<td>51</td>
</tr>
<tr class="odd">
<td>38</td>
</tr>
<tr class="even">
<td>-31</td>
</tr>
<tr class="odd">
<td>-13</td>
</tr>
<tr class="even">
<td>-177</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="3542f3de" class="cell" data-execution_count="201">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>diffs.dt.total_hours()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="195">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>3550</td>
</tr>
<tr class="odd">
<td>-3967</td>
</tr>
<tr class="even">
<td>728</td>
</tr>
<tr class="odd">
<td>-889</td>
</tr>
<tr class="even">
<td>1236</td>
</tr>
<tr class="odd">
<td>919</td>
</tr>
<tr class="even">
<td>-750</td>
</tr>
<tr class="odd">
<td>-321</td>
</tr>
<tr class="even">
<td>-4267</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="date-aggregations" class="level3">
<h3 class="anchored" data-anchor-id="date-aggregations">Date Aggregations</h3>
<p>Note that aggregating dates, returns a <code>datetime</code> type object.</p>
<div id="9e726d6e" class="cell" data-execution_count="202">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>date.dt.<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="196">
<pre><code>datetime.datetime(2002, 2, 2, 5, 18, 54)</code></pre>
</div>
</div>
<div id="4664e672" class="cell" data-execution_count="203">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>date.dt.<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="197">
<pre><code>datetime.datetime(2001, 4, 3, 14, 0, 5)</code></pre>
</div>
</div>
<p>I never quite undersootd that is the “average day.”</p>
<div id="dc244dd0" class="cell" data-execution_count="204">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>date.dt.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="198">
<pre><code>datetime.datetime(2001, 9, 18, 11, 3, 18, 400000)</code></pre>
</div>
</div>
<div id="b7ce55a6" class="cell" data-execution_count="205">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>date.dt.median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="199">
<pre><code>datetime.datetime(2001, 9, 24, 8, 26, 2, 500000)</code></pre>
</div>
</div>
</section>
<section id="date-transformations" class="level3">
<h3 class="anchored" data-anchor-id="date-transformations">Date Transformations</h3>
<div id="6c74aa2e" class="cell" data-execution_count="206">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>date.dt.offset_by(by<span class="op">=</span><span class="st">"-100y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="200">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1901-09-07 07:08:04</td>
</tr>
<tr class="even">
<td>1902-02-02 05:18:54</td>
</tr>
<tr class="odd">
<td>1901-08-20 22:16:27</td>
</tr>
<tr class="even">
<td>1901-09-20 07:02:30</td>
</tr>
<tr class="odd">
<td>1901-08-14 05:40:31</td>
</tr>
<tr class="even">
<td>1901-10-04 18:34:23</td>
</tr>
<tr class="odd">
<td>1901-11-12 01:40:21</td>
</tr>
<tr class="even">
<td>1901-10-11 19:02:14</td>
</tr>
<tr class="odd">
<td>1901-09-28 09:49:35</td>
</tr>
<tr class="even">
<td>1901-04-03 14:00:05</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Notice the syntax of <code>offset_by</code>. It is similar to R’s <code>lubridate</code> package.</p>
<div id="4c2fae7f" class="cell" data-execution_count="207">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>date.dt.offset_by(by<span class="op">=</span><span class="st">"1y2m20d"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="201">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2002-09-27 07:10:04</td>
</tr>
<tr class="even">
<td>2003-02-22 05:20:54</td>
</tr>
<tr class="odd">
<td>2002-09-09 22:18:27</td>
</tr>
<tr class="even">
<td>2002-10-10 07:04:30</td>
</tr>
<tr class="odd">
<td>2002-09-03 05:42:31</td>
</tr>
<tr class="even">
<td>2002-10-24 18:36:23</td>
</tr>
<tr class="odd">
<td>2002-12-02 01:42:21</td>
</tr>
<tr class="even">
<td>2002-10-31 19:04:14</td>
</tr>
<tr class="odd">
<td>2002-10-18 09:51:35</td>
</tr>
<tr class="even">
<td>2002-04-23 14:02:05</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="2d347e8e" class="cell" data-execution_count="208">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>date.dt.truncate(<span class="st">"1m"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="202">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2001-09-07 07:08:00</td>
</tr>
<tr class="even">
<td>2002-02-02 05:18:00</td>
</tr>
<tr class="odd">
<td>2001-08-20 22:16:00</td>
</tr>
<tr class="even">
<td>2001-09-20 07:02:00</td>
</tr>
<tr class="odd">
<td>2001-08-14 05:40:00</td>
</tr>
<tr class="even">
<td>2001-10-04 18:34:00</td>
</tr>
<tr class="odd">
<td>2001-11-12 01:40:00</td>
</tr>
<tr class="even">
<td>2001-10-11 19:02:00</td>
</tr>
<tr class="odd">
<td>2001-09-28 09:49:00</td>
</tr>
<tr class="even">
<td>2001-04-03 14:00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="f4e97137" class="cell" data-execution_count="209">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>date.dt.<span class="bu">round</span>(every<span class="op">=</span><span class="st">"1m"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="203">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2001-09-07 07:08:00</td>
</tr>
<tr class="even">
<td>2002-02-02 05:19:00</td>
</tr>
<tr class="odd">
<td>2001-08-20 22:16:00</td>
</tr>
<tr class="even">
<td>2001-09-20 07:03:00</td>
</tr>
<tr class="odd">
<td>2001-08-14 05:41:00</td>
</tr>
<tr class="even">
<td>2001-10-04 18:34:00</td>
</tr>
<tr class="odd">
<td>2001-11-12 01:40:00</td>
</tr>
<tr class="even">
<td>2001-10-11 19:02:00</td>
</tr>
<tr class="odd">
<td>2001-09-28 09:50:00</td>
</tr>
<tr class="even">
<td>2001-04-03 14:00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="from-date-to-string" class="level3">
<h3 class="anchored" data-anchor-id="from-date-to-string">From Date to String</h3>
<div id="679becae" class="cell" data-execution_count="210">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>date.dt.to_string(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="204">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"2001-09-07"</td>
</tr>
<tr class="even">
<td>"2002-02-02"</td>
</tr>
<tr class="odd">
<td>"2001-08-20"</td>
</tr>
<tr class="even">
<td>"2001-09-20"</td>
</tr>
<tr class="odd">
<td>"2001-08-14"</td>
</tr>
<tr class="even">
<td>"2001-10-04"</td>
</tr>
<tr class="odd">
<td>"2001-11-12"</td>
</tr>
<tr class="even">
<td>"2001-10-11"</td>
</tr>
<tr class="odd">
<td>"2001-09-28"</td>
</tr>
<tr class="even">
<td>"2001-04-03"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Or equivalently:</p>
<div id="42f53e6f" class="cell" data-execution_count="211">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>date.dt.strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="205">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">literal</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"2001-09-07"</td>
</tr>
<tr class="even">
<td>"2002-02-02"</td>
</tr>
<tr class="odd">
<td>"2001-08-20"</td>
</tr>
<tr class="even">
<td>"2001-09-20"</td>
</tr>
<tr class="odd">
<td>"2001-08-14"</td>
</tr>
<tr class="even">
<td>"2001-10-04"</td>
</tr>
<tr class="odd">
<td>"2001-11-12"</td>
</tr>
<tr class="even">
<td>"2001-10-11"</td>
</tr>
<tr class="odd">
<td>"2001-09-28"</td>
</tr>
<tr class="even">
<td>"2001-04-03"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="from-string-to-datetime" class="level3">
<h3 class="anchored" data-anchor-id="from-string-to-datetime">From String to Datetime</h3>
<div id="b91f3c9a" class="cell" data-execution_count="212">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>sd <span class="op">=</span> pl.Series(</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"date"</span>,</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2021-04-22"</span>,</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2022-01-04 00:00:00"</span>,</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"01/31/22"</span>,</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Sun Jul  8 00:34:60 2001"</span>,</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a>sd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="206">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"2021-04-22"</td>
</tr>
<tr class="even">
<td>"2022-01-04 00:00:00"</td>
</tr>
<tr class="odd">
<td>"01/31/22"</td>
</tr>
<tr class="even">
<td>"Sun Jul 8 00:34:60 2001"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Parse into <code>Date</code> type.</p>
<div id="c8796575" class="cell" data-execution_count="213">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.to_date(<span class="bu">format</span><span class="op">=</span><span class="st">"</span><span class="sc">%F</span><span class="st">"</span>, strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="207">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2021-04-22</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Or equivalently:</p>
<div id="63b6b727" class="cell" data-execution_count="214">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.strptime(dtype<span class="op">=</span> pl.Date, <span class="bu">format</span><span class="op">=</span><span class="st">"</span><span class="sc">%F</span><span class="st">"</span>, strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="208">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2021-04-22</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="4d507ce5" class="cell" data-execution_count="215">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.strptime(pl.Date, <span class="st">"%D"</span>, strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="209">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>2022-01-31</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Parse into <code>Datetime</code> type.</p>
<div id="34e5e31d" class="cell" data-execution_count="216">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.to_datetime(<span class="bu">format</span><span class="op">=</span><span class="st">"</span><span class="sc">%F</span><span class="st"> %T"</span>, strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="210">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>2022-01-04 00:00:00</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Or equivalently:</p>
<div id="c700a512" class="cell" data-execution_count="217">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.strptime(pl.Datetime, <span class="st">"</span><span class="sc">%F</span><span class="st"> %T"</span>, strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="211">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>2022-01-04 00:00:00</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="c3e7395e" class="cell" data-execution_count="218">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.strptime(pl.Datetime, <span class="st">"%a %h </span><span class="sc">%d</span><span class="st"> %T %Y"</span>,strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="212">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>2001-07-08 00:35:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Parse into <code>Time</code> dtype.</p>
<div id="ff7762b3" class="cell" data-execution_count="219">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.to_time(<span class="st">"%a %h </span><span class="sc">%d</span><span class="st"> %T %Y"</span>,strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="213">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>00:35:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="5b45c90b" class="cell" data-execution_count="220">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>sd.<span class="bu">str</span>.strptime(pl.Time, <span class="st">"%a %h </span><span class="sc">%d</span><span class="st"> %T %Y"</span>, strict<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="214">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
</tr>
<tr class="odd">
<td>null</td>
</tr>
<tr class="even">
<td>00:35:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="strings" class="level2">
<h2 class="anchored" data-anchor-id="strings">Strings</h2>
<p>String methods are accessed with the <code>.str</code> namespace.</p>
<div id="make-string-series" class="cell" data-execution_count="221">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>st <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [<span class="st">"foo"</span>, <span class="st">"bar"</span>, <span class="st">"baz"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-string-length" class="cell" data-execution_count="222">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.len_chars() <span class="co"># gets number of chars. In ASCII this is the same as lengths()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-length" class="cell-output cell-output-display" data-execution_count="216">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-concat" class="cell" data-execution_count="223">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.concat(<span class="st">"-"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-concat" class="cell-output cell-output-display" data-execution_count="217">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"foo-bar-baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-count-matches" class="cell" data-execution_count="224">
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.count_matches(pattern<span class="op">=</span> <span class="st">'o'</span>) <span class="co"># count literal matches</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-count-matches" class="cell-output cell-output-display" data-execution_count="218">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>0</td>
</tr>
<tr class="odd">
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-contains" class="cell" data-execution_count="225">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.contains(<span class="st">"foo|tra|bar"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-contains" class="cell-output cell-output-display" data-execution_count="219">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-contains-regrex" class="cell" data-execution_count="226">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.contains(<span class="st">"ba[a-zA-Z]"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-contains-regrex" class="cell-output cell-output-display" data-execution_count="220">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-contains-regex-2" class="cell" data-execution_count="227">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.contains(<span class="st">"[a-zA-Z]{4,5}"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-contains-regex-2" class="cell-output cell-output-display" data-execution_count="221">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-count-matches-2" class="cell" data-execution_count="228">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.count_matches(pattern<span class="op">=</span><span class="st">'[a-zA-Z]'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-count-matches-2" class="cell-output cell-output-display" data-execution_count="222">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-ends-with" class="cell" data-execution_count="229">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.ends_with(<span class="st">"oo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-ends-with" class="cell-output cell-output-display" data-execution_count="223">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-starts-with" class="cell" data-execution_count="230">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.starts_with(<span class="st">"fo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-starts-with" class="cell-output cell-output-display" data-execution_count="224">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>To extract the <strong>first</strong> appearance of a pattern, use <code>extract</code>:</p>
<div id="sample-strings" class="cell" data-execution_count="231">
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> pl.Series(<span class="st">"a"</span>, [</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"http://vote.com/ballon_dor?candidate=messi&amp;ref=Polars"</span>,</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"http://vote.com/ballon_dor?candidate=jorginho&amp;ref=Polars"</span>,</span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"http://vote.com/ballon_dor?candidate=ronaldo&amp;ref=Polars"</span></span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>            ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-string-extract" class="cell" data-execution_count="232">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>url.<span class="bu">str</span>.extract(<span class="st">"=([a-zA-Z]+)"</span>, <span class="dv">1</span>) </span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="co"># "=([a-zA-Z]+)" is read: "match an equality, followed by any number of alphanumerics".</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-extract" class="cell-output cell-output-display" data-execution_count="226">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"messi"</td>
</tr>
<tr class="even">
<td>"jorginho"</td>
</tr>
<tr class="odd">
<td>"ronaldo"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>To extract <strong>all</strong> appearances of a pattern, use <code>extract_all</code>:</p>
<div id="cell-string-extract-all" class="cell" data-execution_count="233">
<div class="sourceCode cell-code" id="cb333"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>url.<span class="bu">str</span>.extract_all(<span class="st">"=(\w+)"</span>) <span class="co"># \w is a shorthand for [a-zA-Z0-9_], i.e., alphanumerics and underscore.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-extract-all" class="cell-output cell-output-display" data-execution_count="227">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["=messi", "=Polars"]</td>
</tr>
<tr class="even">
<td>["=jorginho", "=Polars"]</td>
</tr>
<tr class="odd">
<td>["=ronaldo", "=Polars"]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-pad-end" class="cell" data-execution_count="234">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.pad_end(<span class="dv">8</span>, <span class="st">"*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-pad-end" class="cell-output cell-output-display" data-execution_count="228">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"foo*****"</td>
</tr>
<tr class="even">
<td>"bar*****"</td>
</tr>
<tr class="odd">
<td>"baz*****"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-pad-start" class="cell" data-execution_count="235">
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.pad_start(<span class="dv">8</span>, <span class="st">"*"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-pad-start" class="cell-output cell-output-display" data-execution_count="229">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"*****foo"</td>
</tr>
<tr class="even">
<td>"*****bar"</td>
</tr>
<tr class="odd">
<td>"*****baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-strip-char-start" class="cell" data-execution_count="236">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.strip_chars_start(<span class="st">'f'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-strip-char-start" class="cell-output cell-output-display" data-execution_count="230">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"oo"</td>
</tr>
<tr class="even">
<td>"bar"</td>
</tr>
<tr class="odd">
<td>"baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-strip-char-end" class="cell" data-execution_count="237">
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.strip_chars_end(<span class="st">'r'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-strip-char-end" class="cell-output cell-output-display" data-execution_count="231">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"foo"</td>
</tr>
<tr class="even">
<td>"ba"</td>
</tr>
<tr class="odd">
<td>"baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Replacing first appearance of a pattern:</p>
<div id="cell-string-replace" class="cell" data-execution_count="238">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.replace(<span class="st">"o+"</span>, <span class="st">"ZZ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-replace" class="cell-output cell-output-display" data-execution_count="232">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"fZZ"</td>
</tr>
<tr class="even">
<td>"bar"</td>
</tr>
<tr class="odd">
<td>"baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Replace all appearances of a pattern:</p>
<div id="cell-string-replace-all" class="cell" data-execution_count="239">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.replace_all(<span class="st">"o"</span>, <span class="st">"ZZ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-replace-all" class="cell-output cell-output-display" data-execution_count="233">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"fZZZZ"</td>
</tr>
<tr class="even">
<td>"bar"</td>
</tr>
<tr class="odd">
<td>"baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>String to list of strings. Number of splits inferred.</p>
<div id="cell-string-split" class="cell" data-execution_count="240">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.split(by<span class="op">=</span><span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-split" class="cell-output cell-output-display" data-execution_count="234">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["f", "", ""]</td>
</tr>
<tr class="even">
<td>["bar"]</td>
</tr>
<tr class="odd">
<td>["baz"]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-split-inclusive" class="cell" data-execution_count="241">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.split(by<span class="op">=</span><span class="st">"a"</span>, inclusive<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-split-inclusive" class="cell-output cell-output-display" data-execution_count="235">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["foo"]</td>
</tr>
<tr class="even">
<td>["ba", "r"]</td>
</tr>
<tr class="odd">
<td>["ba", "z"]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>String to dict of strings. Number of <strong>splits</strong> fixed.</p>
<div id="cell-string-split-exact" class="cell" data-execution_count="242">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.split_exact(<span class="st">"a"</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-split-exact" class="cell-output cell-output-display" data-execution_count="236">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>struct[3]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{"foo",null,null}</td>
</tr>
<tr class="even">
<td>{"b","r",null}</td>
</tr>
<tr class="odd">
<td>{"b","z",null}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>String to dict of strings. Length of <strong>output</strong> fixed.</p>
<div id="cell-string-split-length" class="cell" data-execution_count="243">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.splitn(<span class="st">"a"</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-split-length" class="cell-output cell-output-display" data-execution_count="237">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>struct[4]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{"foo",null,null,null}</td>
</tr>
<tr class="even">
<td>{"b","r",null,null}</td>
</tr>
<tr class="odd">
<td>{"b","z",null,null}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Strip white spaces.</p>
<div id="dfbe298c" class="cell" data-execution_count="244">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>pl.Series([<span class="st">'   ohh   '</span>,<span class="st">'   yeah   '</span>]).<span class="bu">str</span>.strip()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/1297794149.py:1: DeprecationWarning:

`strip` is deprecated. It has been renamed to `strip_chars`.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="238">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"ohh"</td>
</tr>
<tr class="even">
<td>"yeah"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-to-uppercase" class="cell" data-execution_count="245">
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.to_uppercase()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-to-uppercase" class="cell-output cell-output-display" data-execution_count="239">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"FOO"</td>
</tr>
<tr class="even">
<td>"BAR"</td>
</tr>
<tr class="odd">
<td>"BAZ"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-to-lowercase" class="cell" data-execution_count="246">
<div class="sourceCode cell-code" id="cb347"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.to_lowercase()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-to-lowercase" class="cell-output cell-output-display" data-execution_count="240">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"foo"</td>
</tr>
<tr class="even">
<td>"bar"</td>
</tr>
<tr class="odd">
<td>"baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-to-titlecase" class="cell" data-execution_count="247">
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.to_titlecase()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-to-titlecase" class="cell-output cell-output-display" data-execution_count="241">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Foo"</td>
</tr>
<tr class="even">
<td>"Bar"</td>
</tr>
<tr class="odd">
<td>"Baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-zfill" class="cell" data-execution_count="248">
<div class="sourceCode cell-code" id="cb349"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-zfill" class="cell-output cell-output-display" data-execution_count="242">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"00foo"</td>
</tr>
<tr class="even">
<td>"00bar"</td>
</tr>
<tr class="odd">
<td>"00baz"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-string-slice" class="cell" data-execution_count="249">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>st.<span class="bu">str</span>.<span class="bu">slice</span>(offset<span class="op">=</span><span class="dv">1</span>, length<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="string-slice" class="cell-output cell-output-display" data-execution_count="243">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">a</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"o"</td>
</tr>
<tr class="even">
<td>"a"</td>
</tr>
<tr class="odd">
<td>"a"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-dataframes" class="level1">
<h1>Polars (Eager) DataFrames</h1>
<p>Recall :</p>
<ol type="1">
<li>There is no row index (like R’s <code>data.frame</code>, <code>data.table</code>, and <code>tibble</code>; unlike Python’s <code>Pandas</code>).</li>
<li>Will not accept duplicate column names (unlike Pandas).</li>
</ol>
<section id="create" class="level2">
<h2 class="anchored" data-anchor-id="create">Create</h2>
<p>A frame can be created as you would expect. From a dictionary of series, a numpy array, a Pandas sdataframe, or a list of Polars (or Pandas) series, etc.</p>
<div id="make-dataframe" class="cell" data-execution_count="250">
<div class="sourceCode cell-code" id="cb351"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.DataFrame({</span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"integer"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], </span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>: [</span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">2</span>)), </span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">3</span>))], </span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"float"</span>: [<span class="fl">4.0</span>, <span class="fl">5.0</span>, <span class="fl">6.0</span>],</span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"string"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect" class="level2">
<h2 class="anchored" data-anchor-id="inspect">Inspect</h2>
<p>Nice HTML printing to iPython.</p>
<div id="37aec8f8" class="cell" data-execution_count="251">
<div class="sourceCode cell-code" id="cb352"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="245">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="b64e5a06" class="cell" data-execution_count="252">
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (3, 4)
┌─────────┬─────────────────────┬───────┬────────┐
│ integer ┆ date                ┆ float ┆ string │
│ ---     ┆ ---                 ┆ ---   ┆ ---    │
│ i64     ┆ datetime[μs]        ┆ f64   ┆ str    │
╞═════════╪═════════════════════╪═══════╪════════╡
│ 1       ┆ 2022-01-01 00:00:00 ┆ 4.0   ┆ a      │
│ 2       ┆ 2022-01-02 00:00:00 ┆ 5.0   ┆ b      │
│ 3       ┆ 2022-01-03 00:00:00 ┆ 6.0   ┆ c      │
└─────────┴─────────────────────┴───────┴────────┘</code></pre>
</div>
</div>
<div id="15c096d4" class="cell" data-execution_count="253">
<div class="sourceCode cell-code" id="cb355"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>df.glimpse() <span class="co"># useful for wide frames. Similar to R's str() of Pandas's .info()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3
Columns: 4
$ integer          &lt;i64&gt; 1, 2, 3
$ date    &lt;datetime[μs]&gt; 2022-01-01 00:00:00, 2022-01-02 00:00:00, 2022-01-03 00:00:00
$ float            &lt;f64&gt; 4.0, 5.0, 6.0
$ string           &lt;str&gt; 'a', 'b', 'c'
</code></pre>
</div>
</div>
<div id="b584a306" class="cell" data-execution_count="254">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="248">
<pre><code>['integer', 'date', 'float', 'string']</code></pre>
</div>
</div>
<div id="e581c9fc" class="cell" data-execution_count="255">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="249">
<pre><code>(3, 4)</code></pre>
</div>
</div>
<div id="bc6eafd9" class="cell" data-execution_count="256">
<div class="sourceCode cell-code" id="cb361"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>df.height <span class="co"># probably more useful than df.shape[0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="250">
<pre><code>3</code></pre>
</div>
</div>
<div id="4da2883d" class="cell" data-execution_count="257">
<div class="sourceCode cell-code" id="cb363"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>df.width</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="251">
<pre><code>4</code></pre>
</div>
</div>
<div id="a18a8a22" class="cell" data-execution_count="258">
<div class="sourceCode cell-code" id="cb365"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>df.schema <span class="co"># similar to Pandas info()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="252">
<pre><code>OrderedDict([('integer', Int64),
             ('date', Datetime(time_unit='us', time_zone=None)),
             ('float', Float64),
             ('string', String)])</code></pre>
</div>
</div>
<div id="78a9fb39" class="cell" data-execution_count="259">
<div class="sourceCode cell-code" id="cb367"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>df.with_row_count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/354286280.py:1: DeprecationWarning:

`with_row_count` is deprecated. Use `with_row_index` instead. Note that the default column name has changed from 'row_nr' to 'index'.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="253">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">row_nr</th>
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ol type="1">
<li><code>df.schema</code> and <code>df.columns</code> will be available for lazy objects, even before materializing them.</li>
<li><code>df.height</code> and <code>df.shape</code> will not be available for lazy objects, until they are materialized.</li>
</ol>
</section>
<section id="intro-to-column-operations" class="level2">
<h2 class="anchored" data-anchor-id="intro-to-column-operations">Intro to Column Operations</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is probably the most important section of the document.</p>
</div>
</div>
<section id="sec-contexts" class="level3">
<h3 class="anchored" data-anchor-id="sec-contexts">Contexts</h3>
<p>As discussed in <a href="#sec-api-principles" class="quarto-xref">Section&nbsp;3.4.1</a>, operations on columns will always be done within a <strong>context</strong>. Pandas fans may think of Polars Context as <code>.eval()</code> or <code>.assign()</code> Pandas methods.</p>
<ul>
<li><code>df.with_columns()</code> to add columns.</li>
<li><code>df.select()</code> to select columns.</li>
<li><code>df.group_by().agg()</code> is acutually <code>.select()</code> within a <code>group_by()</code> context.</li>
<li><code>df.filter()</code> is a context for filtering rows.</li>
<li><code>pl.when()</code> is a context for conditional operations.</li>
</ul>
<p>Select Context:</p>
<div id="cell-select-context" class="cell" data-execution_count="260">
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"integer"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="select-context" class="cell-output cell-output-display" data-execution_count="254">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-with-colummns-context" class="cell" data-execution_count="261">
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.col(<span class="st">"integer"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="with-colummns-context" class="cell-output cell-output-display" data-execution_count="255">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>4</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Group-by context:</p>
<div id="cell-group-by-context" class="cell" data-execution_count="262">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>df.group_by(<span class="st">"string"</span>).agg(pl.col(<span class="st">"integer"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="group-by-context" class="cell-output cell-output-display" data-execution_count="256">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>str</th>
<th>list[i64]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"b"</td>
<td>[3]</td>
</tr>
<tr class="even">
<td>"a"</td>
<td>[2]</td>
</tr>
<tr class="odd">
<td>"c"</td>
<td>[4]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="column-access" class="level3">
<h3 class="anchored" data-anchor-id="column-access">Column Access</h3>
<p>Within a context there are many ways to access a column. Here are some examples of various ways of adding 1 to the integer column.</p>
<div id="cell-add-1-to-column" class="cell" data-execution_count="263">
<div class="sourceCode cell-code" id="col-ref" data-lst-cap="Referencing a Column in a Select Context"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="col-ref-1"><a href="#col-ref-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"integer"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="add-1-to-column" class="cell-output cell-output-display" data-execution_count="257">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="e99bbb20" class="cell" data-execution_count="264">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col([<span class="st">"integer"</span>]).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="258">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="e39a0e4c" class="cell" data-execution_count="265">
<div class="sourceCode cell-code" id="cb373"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="vs">r"^integer$"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="259">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="69fa55df" class="cell" data-execution_count="266">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(pl.Int64).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="260">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="e81cce9d" class="cell" data-execution_count="267">
<div class="sourceCode cell-code" id="cb375"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.first().add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="261">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="3f6d50d8" class="cell" data-execution_count="268">
<div class="sourceCode cell-code" id="cb376"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>df.select(cs.by_name(<span class="st">"integer"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="262">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="3a58d737" class="cell" data-execution_count="269">
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.ends_with(<span class="st">"ger"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="263">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="74e9baab" class="cell" data-execution_count="270">
<div class="sourceCode cell-code" id="cb378"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.starts_with(<span class="st">'int'</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="264">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="482d82e0" class="cell" data-execution_count="271">
<div class="sourceCode cell-code" id="cb379"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.integer().add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="265">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="7928eef3" class="cell" data-execution_count="272">
<div class="sourceCode cell-code" id="cb380"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.first().add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="266">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="ed9dc99d" class="cell" data-execution_count="273">
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.matches(<span class="vs">r"^integer$"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="267">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="d12d4516" class="cell" data-execution_count="274">
<div class="sourceCode cell-code" id="cb382"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.contains(<span class="st">"int"</span>).add(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="268">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="03692a6c" class="cell" data-execution_count="275">
<div class="sourceCode cell-code" id="cb383"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"integer"</span>)<span class="op">+</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="269">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="3fab8675" class="cell" data-execution_count="276">
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'integer'</span>]<span class="op">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="270">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="8892ca56" class="cell" data-execution_count="277">
<div class="sourceCode cell-code" id="cb385"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>df.get_column(<span class="st">'integer'</span>)<span class="op">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="271">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
<tr class="odd">
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>The following will not work because a series does not have a <code>.add(1)</code> method.</p>
<div id="15328ba3" class="cell" data-execution_count="278">
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'integer'</span>].add(<span class="dv">1</span>)</span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>df.get_column(<span class="st">'integer'</span>).add(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think: What are the differences between these methods?</p>
</div>
</div>
<p>My preferred syntax is <span class="citation" data-cites="col-ref">@col-ref</span>, which is the one I will use in the rest of the document.</p>
</section>
</section>
<section id="convert-to-other-python-objects" class="level2">
<h2 class="anchored" data-anchor-id="convert-to-other-python-objects">Convert to Other Python Objects</h2>
<p>You can always convert your <code>pl.Series</code> or <code>pl.DataFrame</code> to other Python objects.</p>
<p>To Pandas DataFrame</p>
<div id="cell-dataframe-to-Pandas" class="cell" data-execution_count="279">
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a>df.to_pandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-pandas" class="cell-output cell-output-display" data-execution_count="272">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2022-01-01</td>
<td>4.0</td>
<td>a</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>2022-01-02</td>
<td>5.0</td>
<td>b</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>2022-01-03</td>
<td>6.0</td>
<td>c</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>To Numpy Array</p>
<div id="cell-dataframe-to-numpy" class="cell" data-execution_count="280">
<div class="sourceCode cell-code" id="cb388"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>df.to_numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-numpy" class="cell-output cell-output-display" data-execution_count="273">
<pre><code>array([[1, datetime.datetime(2022, 1, 1, 0, 0), 4.0, 'a'],
       [2, datetime.datetime(2022, 1, 2, 0, 0), 5.0, 'b'],
       [3, datetime.datetime(2022, 1, 3, 0, 0), 6.0, 'c']], dtype=object)</code></pre>
</div>
</div>
<p>To List of Polars Series</p>
<div id="cell-dataframe-to-list" class="cell" data-execution_count="281">
<div class="sourceCode cell-code" id="cb390"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>df.get_columns() <span class="co"># columns as list of Polars series</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-list" class="cell-output cell-output-display" data-execution_count="274">
<pre><code>[shape: (3,)
 Series: 'integer' [i64]
 [
    1
    2
    3
 ],
 shape: (3,)
 Series: 'date' [datetime[μs]]
 [
    2022-01-01 00:00:00
    2022-01-02 00:00:00
    2022-01-03 00:00:00
 ],
 shape: (3,)
 Series: 'float' [f64]
 [
    4.0
    5.0
    6.0
 ],
 shape: (3,)
 Series: 'string' [str]
 [
    "a"
    "b"
    "c"
 ]]</code></pre>
</div>
</div>
<p>To list of tuples</p>
<div id="cell-dataframe-to-list-of-tuples" class="cell" data-execution_count="282">
<div class="sourceCode cell-code" id="cb392"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>df.rows() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-list-of-tuples" class="cell-output cell-output-display" data-execution_count="275">
<pre><code>[(1, datetime.datetime(2022, 1, 1, 0, 0), 4.0, 'a'),
 (2, datetime.datetime(2022, 1, 2, 0, 0), 5.0, 'b'),
 (3, datetime.datetime(2022, 1, 3, 0, 0), 6.0, 'c')]</code></pre>
</div>
</div>
<p>To Dict of Polars Series</p>
<div id="cell-dataframe-to-dict-of-series" class="cell" data-execution_count="283">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>df.to_dict() <span class="co"># columns as dict of Polars series</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-dict-of-series" class="cell-output cell-output-display" data-execution_count="276">
<pre><code>{'integer': shape: (3,)
 Series: 'integer' [i64]
 [
    1
    2
    3
 ],
 'date': shape: (3,)
 Series: 'date' [datetime[μs]]
 [
    2022-01-01 00:00:00
    2022-01-02 00:00:00
    2022-01-03 00:00:00
 ],
 'float': shape: (3,)
 Series: 'float' [f64]
 [
    4.0
    5.0
    6.0
 ],
 'string': shape: (3,)
 Series: 'string' [str]
 [
    "a"
    "b"
    "c"
 ]}</code></pre>
</div>
</div>
<p>To Dict of Python Lists</p>
<div id="cell-dataframe-to-dict-of-lists" class="cell" data-execution_count="284">
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>df.to_dict(as_series<span class="op">=</span><span class="va">False</span>) <span class="co"># columns as dict of Polars series</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-dict-of-lists" class="cell-output cell-output-display" data-execution_count="277">
<pre><code>{'integer': [1, 2, 3],
 'date': [datetime.datetime(2022, 1, 1, 0, 0),
  datetime.datetime(2022, 1, 2, 0, 0),
  datetime.datetime(2022, 1, 3, 0, 0)],
 'float': [4.0, 5.0, 6.0],
 'string': ['a', 'b', 'c']}</code></pre>
</div>
</div>
<p>To String Representation (<code>repr</code>)</p>
<div id="cell-dataframe-to-repr" class="cell" data-execution_count="285">
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>df.to_init_repr()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-repr" class="cell-output cell-output-display" data-execution_count="278">
<pre><code>'pl.DataFrame(\n    [\n        pl.Series("integer", [1, 2, 3], dtype=pl.Int64),\n        pl.Series("date", [datetime.datetime(2022, 1, 1, 0, 0), datetime.datetime(2022, 1, 2, 0, 0), datetime.datetime(2022, 1, 3, 0, 0)], dtype=pl.Datetime(time_unit=\'us\', time_zone=None)),\n        pl.Series("float", [4.0, 5.0, 6.0], dtype=pl.Float64),\n        pl.Series("string", [\'a\', \'b\', \'c\'], dtype=pl.String),\n    ]\n)\n'</code></pre>
</div>
</div>
<p>To a Polars Series of Polars Struct</p>
<div id="cell-dataframe-to-struct" class="cell" data-execution_count="286">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>df.to_struct()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-struct" class="cell-output cell-output-display" data-execution_count="279">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="odd">
<th>struct[4]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{1,2022-01-01 00:00:00,4.0,"a"}</td>
</tr>
<tr class="even">
<td>{2,2022-01-02 00:00:00,5.0,"b"}</td>
</tr>
<tr class="odd">
<td>{3,2022-01-03 00:00:00,6.0,"c"}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>To PyArrow Table</p>
<div id="cell-dataframe-to-arrow" class="cell" data-execution_count="287">
<div class="sourceCode cell-code" id="cb401"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a>df.to_arrow()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-to-arrow" class="cell-output cell-output-display" data-execution_count="280">
<pre><code>pyarrow.Table
integer: int64
date: timestamp[us]
float: double
string: large_string
----
integer: [[1,2,3]]
date: [[2022-01-01 00:00:00.000000,2022-01-02 00:00:00.000000,2022-01-03 00:00:00.000000]]
float: [[4,5,6]]
string: [["a","b","c"]]</code></pre>
</div>
</div>
</section>
<section id="statistical-aggregations" class="level2">
<h2 class="anchored" data-anchor-id="statistical-aggregations">Statistical Aggregations</h2>
<div id="cell-dataframe-describe" class="cell" data-execution_count="288">
<div class="sourceCode cell-code" id="cb403"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-describe" class="cell-output cell-output-display" data-execution_count="281">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>str</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"count"</td>
<td>3.0</td>
<td>"3"</td>
<td>3.0</td>
<td>"3"</td>
</tr>
<tr class="even">
<td>"null_count"</td>
<td>0.0</td>
<td>"0"</td>
<td>0.0</td>
<td>"0"</td>
</tr>
<tr class="odd">
<td>"mean"</td>
<td>2.0</td>
<td>"2022-01-02 00:00:00"</td>
<td>5.0</td>
<td>null</td>
</tr>
<tr class="even">
<td>"std"</td>
<td>1.0</td>
<td>null</td>
<td>1.0</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"min"</td>
<td>1.0</td>
<td>"2022-01-01 00:00:00"</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>2.0</td>
<td>"2022-01-02 00:00:00"</td>
<td>5.0</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>2.0</td>
<td>"2022-01-02 00:00:00"</td>
<td>5.0</td>
<td>null</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>3.0</td>
<td>"2022-01-03 00:00:00"</td>
<td>6.0</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>3.0</td>
<td>"2022-01-03 00:00:00"</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Compare to Pandas: Polars will summarize all columns even if they are not numeric.</p>
<div id="cell-dataframe-describe-pandas" class="cell" data-execution_count="289">
<div class="sourceCode cell-code" id="cb404"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>df.to_pandas().describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-describe-pandas" class="cell-output cell-output-display" data-execution_count="282">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>3.0</td>
<td>3</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>2.0</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">min</td>
<td>1.0</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25%</td>
<td>1.5</td>
<td>2022-01-01 12:00:00</td>
<td>4.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">50%</td>
<td>2.0</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">75%</td>
<td>2.5</td>
<td>2022-01-02 12:00:00</td>
<td>5.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">max</td>
<td>3.0</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">std</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Statistical aggregations operate column-wise (and in parallel!).</p>
<div id="cell-dataframe-max" class="cell" data-execution_count="290">
<div class="sourceCode cell-code" id="cb405"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-max" class="cell-output cell-output-display" data-execution_count="283">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-dataframe-min" class="cell" data-execution_count="291">
<div class="sourceCode cell-code" id="cb406"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-min" class="cell-output cell-output-display" data-execution_count="284">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-dataframe-mean" class="cell" data-execution_count="292">
<div class="sourceCode cell-code" id="cb407"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a>df.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-mean" class="cell-output cell-output-display" data-execution_count="285">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2.0</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-dataframe-median" class="cell" data-execution_count="293">
<div class="sourceCode cell-code" id="cb408"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>df.median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-median" class="cell-output cell-output-display" data-execution_count="286">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2.0</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-dataframe-quantile" class="cell" data-execution_count="294">
<div class="sourceCode cell-code" id="cb409"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>df.quantile(<span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-quantile" class="cell-output cell-output-display" data-execution_count="287">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>null</td>
<td>4.0</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-dataframe-sum" class="cell" data-execution_count="295">
<div class="sourceCode cell-code" id="cb410"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-sum" class="cell-output cell-output-display" data-execution_count="288">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6</td>
<td>null</td>
<td>15.0</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Constrast with summation in row:</p>
<div id="cell-dataframe-sum-horizontal" class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb411"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(pl.sum_horizontal(<span class="st">'*'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-sum-horizontal" class="cell-output cell-output-display" data-execution_count="289">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>str</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"16409952000000014.0a"</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>"16410816000000025.0b"</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>"16411680000000036.0c"</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sec-filtering-subsetting-frames" class="level2">
<h2 class="anchored" data-anchor-id="sec-filtering-subsetting-frames">Selections</h2>
<ol type="1">
<li>If you are used to Pandas, recall there is no index. There is thus no need for <code>loc</code> vs.&nbsp;<code>iloc</code>, <code>reset_index()</code>, etc. See <a href="https://pola-rs.github.io/Polars-book/user-guide/howcani/selecting_data/selecting_data_indexing.html">here</a> for a comparison of extractors between Polars and Pandas.</li>
<li>Filtering and selection is possible with the <code>[</code> operator, or the <code>filter()</code> and <code>select()</code> methods. The latter is recommended to facilitate query planning (discussed in <a href="#sec-query-planning" class="quarto-xref">Section&nbsp;2.3</a>).</li>
</ol>
<section id="selecting-with-indices" class="level3">
<h3 class="anchored" data-anchor-id="selecting-with-indices">Selecting With Indices</h3>
<p>The following are presented for completeness. Gnerally, you can, and should, avoid selecting with indices. See <a href="#sec-selecting-columns" class="quarto-xref">Section&nbsp;5.6.2</a> for selecting columns, and <a href="#sec-filtering-rows" class="quarto-xref">Section&nbsp;5.6.5</a> for selecting rows.</p>
<div id="cell-single-cell-extraction" class="cell" data-execution_count="297">
<div class="sourceCode cell-code" id="cb412"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">0</span>,<span class="dv">0</span>] <span class="co"># like Pandas .iloc[]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="single-cell-extraction" class="cell-output cell-output-display" data-execution_count="290">
<pre><code>1</code></pre>
</div>
</div>
<p>Slicing along rows.</p>
<div id="cell-slice-rows" class="cell" data-execution_count="298">
<div class="sourceCode cell-code" id="cb414"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">0</span>:<span class="dv">1</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="slice-rows" class="cell-output cell-output-display" data-execution_count="291">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Slicing along columns.</p>
<div id="cell-slice-columns" class="cell" data-execution_count="299">
<div class="sourceCode cell-code" id="cb415"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>df[:,<span class="dv">0</span>:<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="slice-columns" class="cell-output cell-output-display" data-execution_count="292">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sec-selecting-columns" class="level3">
<h3 class="anchored" data-anchor-id="sec-selecting-columns">Selecting Columns</h3>
<p>First- do you want to return a Polars frame or a Polars series?</p>
<p>For a frame:</p>
<div id="8534aa08" class="cell" data-execution_count="300">
<div class="sourceCode cell-code" id="cb416"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a>df.select(<span class="st">"integer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="293">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>For a series:</p>
<div id="55388061" class="cell" data-execution_count="301">
<div class="sourceCode cell-code" id="cb417"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'integer'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="294">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>How do I know which is which?</p>
<ol type="1">
<li>You can use <code>type()</code>.</li>
<li>Notice the dimension of the index in the output.</li>
</ol>
<p>Select columns with list of labels</p>
<div id="6690bef9" class="cell" data-execution_count="302">
<div class="sourceCode cell-code" id="cb418"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a>df.select([<span class="st">"integer"</span>, <span class="st">"float"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="295">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>As of Polars&gt;=15.0.0, you don’t have to pass a list:</p>
<div id="c2d1f185" class="cell" data-execution_count="303">
<div class="sourceCode cell-code" id="cb419"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>df.select(<span class="st">"integer"</span>, <span class="st">"float"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="296">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Column slicing by label</p>
<div id="87c3f94b" class="cell" data-execution_count="304">
<div class="sourceCode cell-code" id="cb420"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a>df[:,<span class="st">"integer"</span>:<span class="st">"float"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="297">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Note: <code>df.select()</code> does not support slicing ranges such as <code>df.select("integer":"float")</code>.</p>
<p>Get a column as a Polars Series.</p>
<div id="ae2f0c25" class="cell" data-execution_count="305">
<div class="sourceCode cell-code" id="cb421"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>df.get_column(<span class="st">'integer'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="298">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Get a column as a Polars series.</p>
<div id="1c5c2ad3" class="cell" data-execution_count="306">
<div class="sourceCode cell-code" id="cb422"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a>df.to_series(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="299">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="22916e04" class="cell" data-execution_count="307">
<div class="sourceCode cell-code" id="cb423"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>df.get_column_index(<span class="st">'float'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="300">
<pre><code>2</code></pre>
</div>
</div>
<div id="4e3a4fb9" class="cell" data-execution_count="308">
<div class="sourceCode cell-code" id="cb425"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>df.drop(<span class="st">"integer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="301">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p><code>df.drop()</code> not have an <code>inplace</code> argument. Use <code>df.drop_in_place()</code> instead.</p>
</section>
<section id="pl.col" class="level3">
<h3 class="anchored" data-anchor-id="pl.col">pl.col()</h3>
<p>The <code>pl.col()</code> is <strong>super important</strong>. It allows you to select columns in many ways, and provides almost all the methods (i.e.&nbsp;Polars Expressions) you will need to operate on them.</p>
<div id="e16ec4d1" class="cell" data-execution_count="309">
<div class="sourceCode cell-code" id="cb426"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(pl.Int64))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="302">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="4e69f48a" class="cell" data-execution_count="310">
<div class="sourceCode cell-code" id="cb427"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(pl.Float64))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="303">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4.0</td>
</tr>
<tr class="even">
<td>5.0</td>
</tr>
<tr class="odd">
<td>6.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="8feb6621" class="cell" data-execution_count="311">
<div class="sourceCode cell-code" id="cb428"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(pl.Utf8))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="304">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"a"</td>
</tr>
<tr class="even">
<td>"b"</td>
</tr>
<tr class="odd">
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Python List of Polars dtypes</p>
<div id="4a9645bf" class="cell" data-execution_count="312">
<div class="sourceCode cell-code" id="cb429"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col([pl.Int64, pl.Float64]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="305">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Patterns (“glob”)</p>
<div id="9abb424c" class="cell" data-execution_count="313">
<div class="sourceCode cell-code" id="cb430"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"*"</span>)) <span class="co"># same as df.select(pl.all())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="306">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Regular Expression. Important! Use <code>pl.col('^&lt;patterh&gt;$')</code> to match regular expressions.</p>
<div id="6c8630f3" class="cell" data-execution_count="314">
<div class="sourceCode cell-code" id="cb431"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"^\w</span><span class="sc">{4}</span><span class="st">$"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="307">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01 00:00:00</td>
</tr>
<tr class="even">
<td>2022-01-02 00:00:00</td>
</tr>
<tr class="odd">
<td>2022-01-03 00:00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="909f26ee" class="cell" data-execution_count="315">
<div class="sourceCode cell-code" id="cb432"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">'^.*g$'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="308">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"a"</td>
</tr>
<tr class="even">
<td>"b"</td>
</tr>
<tr class="odd">
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-pl-col-with-regex" class="cell" data-execution_count="316">
<div class="sourceCode cell-code" id="cb433"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"^.*te.*$"</span>)) <span class="co"># regex matching anything with a "te"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="pl-col-with-regex" class="cell-output cell-output-display" data-execution_count="309">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>You can use <code>pl.col()</code> to exclude columns.</p>
<div id="830e3adc" class="cell" data-execution_count="317">
<div class="sourceCode cell-code" id="cb434"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"*"</span>).exclude(<span class="st">"integer"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="310">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="a87028a2" class="cell" data-execution_count="318">
<div class="sourceCode cell-code" id="cb435"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">"*"</span>).exclude(pl.Float64))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="311">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Exciting! <a href="https://pola-rs.github.io/Polars/py-Polars/html/reference/selectors.html">New API</a> for column selection.</p>
<div id="cell-pl-column-selector" class="cell" data-execution_count="319">
<div class="sourceCode cell-code" id="cb436"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a>df.select(cs.starts_with(<span class="st">'i'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="pl-column-selector" class="cell-output cell-output-display" data-execution_count="312">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-pl-column-selector-set-opeartions" class="cell" data-execution_count="320">
<div class="sourceCode cell-code" id="cb437"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.starts_with(<span class="st">'i'</span>) <span class="op">|</span> cs.starts_with(<span class="st">'d'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="pl-column-selector-set-opeartions" class="cell-output cell-output-display" data-execution_count="313">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="45b527e0" class="cell" data-execution_count="321">
<div class="sourceCode cell-code" id="cb438"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a>df.select(cs.starts_with(<span class="st">'i'</span>) <span class="op">|</span> cs.starts_with(<span class="st">'d'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="314">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="selecting-rows-by-index" class="level3">
<h3 class="anchored" data-anchor-id="selecting-rows-by-index">Selecting Rows By Index</h3>
<div id="f2ecad32" class="cell" data-execution_count="322">
<div class="sourceCode cell-code" id="cb439"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a>df.limit(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="315">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="20b5a44c" class="cell" data-execution_count="323">
<div class="sourceCode cell-code" id="cb440"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="316">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="fd6824a8" class="cell" data-execution_count="324">
<div class="sourceCode cell-code" id="cb441"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a>df.tail(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="317">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="9740464e" class="cell" data-execution_count="325">
<div class="sourceCode cell-code" id="cb442"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a>df.take_every(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/2485267278.py:1: DeprecationWarning:

`take_every` is deprecated. It has been renamed to `gather_every`.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="318">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="fd19d6a6" class="cell" data-execution_count="326">
<div class="sourceCode cell-code" id="cb444"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">slice</span>(offset<span class="op">=</span><span class="dv">1</span>, length<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="319">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="c81b699b" class="cell" data-execution_count="327">
<div class="sourceCode cell-code" id="cb445"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="320">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Because <code>.sample()</code> requires row counts, it will not work for lazy objects.</p>
<div id="c1d900b2" class="cell" data-execution_count="328">
<div class="sourceCode cell-code" id="cb446"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a>df.row(<span class="dv">1</span>) <span class="co"># get row as tuple</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="321">
<pre><code>(2, datetime.datetime(2022, 1, 2, 0, 0), 5.0, 'b')</code></pre>
</div>
</div>
</section>
<section id="sec-filtering-rows" class="level3">
<h3 class="anchored" data-anchor-id="sec-filtering-rows">Selecting Rows By Condition</h3>
<p>Aka <a href="https://en.wikipedia.org/wiki/Projection_(relational_algebra)">Projection</a>.</p>
<p>Enter the <code>df.filter()</code> context.</p>
<div id="cell-filter-context" class="cell" data-execution_count="329">
<div class="sourceCode cell-code" id="filter-context" data-lst-cap="Filtering Rows in a DataFrame"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="filter-context-1"><a href="#filter-context-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">filter</span>(pl.col(<span class="st">"integer"</span>).eq(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="filter-context" class="cell-output cell-output-display" data-execution_count="322">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>df.filter()</code> is a <strong>Polars Context</strong>.</li>
<li>It is a <strong>keep</strong> filter, not a <strong>drop</strong> filter: it will evaluate expressions, and return the rows where the expression does not evaluate to <code>False</code>.</li>
<li>The <code>[</code> operator does not support indexing with boolean such as <code>df[df["integer"] == 2]</code>.</li>
<li>The <code>filter()</code> method is recommended over <code>[</code> by the authors of Polars, to facilitate lazy evaluation (discussed later).</li>
</ul>
<p>An alternative syntax for equality filtering, known as <strong>constraint</strong> in the Polars documentation.</p>
<div id="7e232b45" class="cell" data-execution_count="330">
<div class="sourceCode cell-code" id="cb448"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">filter</span>(integer <span class="op">=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="323">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>AND conditions:</p>
<div id="cell-filter-and" class="cell" data-execution_count="331">
<div class="sourceCode cell-code" id="cb449"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">filter</span>(</span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'integer'</span>).eq(<span class="dv">2</span>),</span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'float'</span>).gt(<span class="dv">10</span>)</span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="filter-and" class="cell-output cell-output-display" data-execution_count="324">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (0, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-filter-and-2" class="cell" data-execution_count="332">
<div class="sourceCode cell-code" id="cb450"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">filter</span>(</span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'integer'</span>).eq(<span class="dv">2</span>) <span class="op">&amp;</span></span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'float'</span>).gt(<span class="dv">10</span>)</span>
<span id="cb450-4"><a href="#cb450-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="filter-and-2" class="cell-output cell-output-display" data-execution_count="325">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (0, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>OR conditions:</p>
<div id="cell-filter-or" class="cell" data-execution_count="333">
<div class="sourceCode cell-code" id="cb451"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">filter</span>(</span>
<span id="cb451-2"><a href="#cb451-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'integer'</span>).eq(<span class="dv">2</span>) <span class="op">|</span></span>
<span id="cb451-3"><a href="#cb451-3" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'float'</span>).gt(<span class="dv">10</span>)</span>
<span id="cb451-4"><a href="#cb451-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="filter-or" class="cell-output cell-output-display" data-execution_count="326">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you write an AND, or OR condition, without using the comparison methods <code>.eq()</code>, <code>.gt()</code>, etc.?</p>
</div>
</div>
</section>
<section id="selecting-from-single-item-frame" class="level3">
<h3 class="anchored" data-anchor-id="selecting-from-single-item-frame">Selecting From Single Item Frame</h3>
<p>Say your operation returned a Polars frame with a single float, which you want to manipulate as a Python float:</p>
<div id="cell-single-item-to-python" class="cell" data-execution_count="334">
<div class="sourceCode cell-code" id="cb452"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a>pl.DataFrame([<span class="dv">1</span>]).item()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="single-item-to-python" class="cell-output cell-output-display" data-execution_count="327">
<pre><code>1</code></pre>
</div>
</div>
</section>
</section>
<section id="column-transformations" class="level2">
<h2 class="anchored" data-anchor-id="column-transformations">Column Transformations</h2>
<ol type="1">
<li>Transformations are done with Polars Expressions (<a href="#sec-expressions" class="quarto-xref">Section&nbsp;7</a>) within a <strong>context</strong> (see <a href="#sec-contexts" class="quarto-xref">Section&nbsp;5.3.1</a>).</li>
</ol>
<ul>
<li>The output column will have the same name as the input, unless you use the <code>alias()</code> method to rename it.</li>
</ul>
<div id="cell-with-columns" class="cell" data-execution_count="335">
<div class="sourceCode cell-code" id="cb454"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"integer"</span>).mul(<span class="dv">2</span>),</span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"integer"</span>).alias(<span class="st">"integer2"</span>),</span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a>    integer3 <span class="op">=</span> pl.col(<span class="st">"integer"</span>).truediv(<span class="dv">3</span>),</span>
<span id="cb454-5"><a href="#cb454-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="with-columns" class="cell-output cell-output-display" data-execution_count="328">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">integer2</th>
<th data-quarto-table-cell-role="th">integer3</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>1</td>
<td>0.333333</td>
</tr>
<tr class="even">
<td>4</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>2</td>
<td>0.666667</td>
</tr>
<tr class="odd">
<td>6</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>3</td>
<td>1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Warning!</p>
<div id="c10fd5f9" class="cell" data-execution_count="336">
<div class="sourceCode cell-code" id="cb455"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a>    integer3 <span class="op">=</span> pl.col(<span class="st">"integer"</span>).truediv(<span class="dv">3</span>),</span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"integer"</span>).mul(<span class="dv">2</span>),</span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"integer"</span>).alias(<span class="st">"integer2"</span>),</span>
<span id="cb455-5"><a href="#cb455-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Things to note:</p>
<ul>
<li>You cannot use <code>[</code> to assign! This would not have worked <code>df['integer3'] = df['integer'] * 2</code></li>
<li>The columns <code>integer</code> is multiplied by 2 <strong>in place</strong>, because no <code>alias</code> is used.</li>
<li>As of Polars version &gt;15.<em>.</em> (I think), you can use <code>=</code> to assign. That is how <code>integer3</code> is created.</li>
<li>The column <code>integer</code> is copied, by renaming it to <code>integer2</code>.</li>
<li>Why <code>.truediv()</code>? To distinguish from <code>.floordiv()</code> and <code>.mod()</code>. See <a href="https://github.com/pola-rs/polars/issues/12450">this issue</a> for a discussion of the topic.</li>
</ul>
<p>If a selection returns multiple columns, all will be transformed:</p>
<div id="cell-with-columns-multiple" class="cell" data-execution_count="337">
<div class="sourceCode cell-code" id="cb456"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb456-2"><a href="#cb456-2" aria-hidden="true" tabindex="-1"></a>    pl.col([pl.Int64,pl.Float64]).mul(<span class="dv">2</span>)</span>
<span id="cb456-3"><a href="#cb456-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="with-columns-multiple" class="cell-output cell-output-display" data-execution_count="329">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-01 00:00:00</td>
<td>8.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>4</td>
<td>2022-01-02 00:00:00</td>
<td>10.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>6</td>
<td>2022-01-03 00:00:00</td>
<td>12.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-with-columns-all-cast" class="cell" data-execution_count="338">
<div class="sourceCode cell-code" id="cb457"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a>    pl.<span class="bu">all</span>().cast(pl.Utf8)</span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="with-columns-all-cast" class="cell-output cell-output-display" data-execution_count="330">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"1"</td>
<td>"2022-01-01 00:00:00.000000"</td>
<td>"4.0"</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>"2"</td>
<td>"2022-01-02 00:00:00.000000"</td>
<td>"5.0"</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>"3"</td>
<td>"2022-01-03 00:00:00.000000"</td>
<td>"6.0"</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>You cannot <code>.alias()</code> when operating on multiple columns. But you can use <code>.name.suffix()</code> or <code>.name.prefix()</code> from the <code>.name.</code> namespace.</p>
<div id="cell-with-columns-multiple-2" class="cell" data-execution_count="339">
<div class="sourceCode cell-code" id="cb458"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>    pl.col([pl.Int64,pl.Float64]).mul(<span class="dv">2</span>).name.suffix(<span class="st">"_2X"</span>)</span>
<span id="cb458-3"><a href="#cb458-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="with-columns-multiple-2" class="cell-output cell-output-display" data-execution_count="331">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">integer_2X</th>
<th data-quarto-table-cell-role="th">float_2X</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>2</td>
<td>8.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>4</td>
<td>10.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>6</td>
<td>12.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<section id="transform-the-transformed-columns" class="level3">
<h3 class="anchored" data-anchor-id="transform-the-transformed-columns">Transform the Transformed Columns</h3>
<p>All the expressions within a context see the frame as it’s initial state. Recall, odds are expressions will be evaluated in parallel, and not sequentially. So how can I operate on columns I have just transformed? By chaining contexts!</p>
<div id="cell-chained-contexts" class="cell" data-execution_count="340">
<div class="sourceCode cell-code" id="cb459"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a>  .with_columns(</span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"integer"</span>).truediv(pl.col(<span class="st">"float"</span>)).alias(<span class="st">"ratio"</span>)</span>
<span id="cb459-5"><a href="#cb459-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb459-6"><a href="#cb459-6" aria-hidden="true" tabindex="-1"></a>  .with_columns(</span>
<span id="cb459-7"><a href="#cb459-7" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"ratio"</span>).mul(<span class="dv">100</span>)</span>
<span id="cb459-8"><a href="#cb459-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb459-9"><a href="#cb459-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="chained-contexts" class="cell-output cell-output-display" data-execution_count="332">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">ratio</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>25.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>40.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>50.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="conditional-transformation-if-else" class="level3">
<h3 class="anchored" data-anchor-id="conditional-transformation-if-else">Conditional Transformation (if-else)</h3>
<div id="cell-conditional-transformation" class="cell" data-execution_count="341">
<div class="sourceCode cell-code" id="cb460"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>    pl.when(</span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">"integer"</span>).gt(<span class="dv">2</span>)</span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a>    .then(pl.lit(<span class="dv">1</span>))</span>
<span id="cb460-6"><a href="#cb460-6" aria-hidden="true" tabindex="-1"></a>    .otherwise(pl.col(<span class="st">"integer"</span>))</span>
<span id="cb460-7"><a href="#cb460-7" aria-hidden="true" tabindex="-1"></a>    .alias(<span class="st">"new_col"</span>)</span>
<span id="cb460-8"><a href="#cb460-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="conditional-transformation" class="cell-output cell-output-display" data-execution_count="333">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">new_col</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>The <code>otherwise()</code> method is optional. If omitted, the original column will be returned (see next example).</li>
<li><code>pl.lit(1)</code> is a Polars expression that returns the literal 1. It may be ommited, but it is good practice to include it for clarity and safety.</li>
<li><code>pl.col("integer").gt(2)</code> could have been replaced with <code>pl.col("integer") &gt; 2</code>. I like the former because it allows easier composition of conditions.</li>
</ul>
<div id="d3c2abd5" class="cell" data-execution_count="342">
<div class="sourceCode cell-code" id="cb461"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>    pl.when(</span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">"integer"</span>) <span class="op">&gt;</span> <span class="dv">2</span></span>
<span id="cb461-4"><a href="#cb461-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb461-5"><a href="#cb461-5" aria-hidden="true" tabindex="-1"></a>    .then(<span class="dv">1</span>)</span>
<span id="cb461-6"><a href="#cb461-6" aria-hidden="true" tabindex="-1"></a>    .otherwise(pl.col(<span class="st">"integer"</span>))</span>
<span id="cb461-7"><a href="#cb461-7" aria-hidden="true" tabindex="-1"></a>    .alias(<span class="st">"new_col"</span>)</span>
<span id="cb461-8"><a href="#cb461-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="334">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">new_col</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="python-lambda-functions" class="level3">
<h3 class="anchored" data-anchor-id="python-lambda-functions">Python Lambda Functions</h3>
<p>Apply your own lambda function.</p>
<div id="3c367326" class="cell" data-execution_count="343">
<div class="sourceCode cell-code" id="cb462"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>df.select([pl.col(<span class="st">"integer"</span>), pl.col(<span class="st">"float"</span>)]).map_rows(<span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">+</span> x[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="335">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">map</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5.0</td>
</tr>
<tr class="even">
<td>7.0</td>
</tr>
<tr class="odd">
<td>9.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>As usual, using your own functions may have a very serious toll on performance.</p>
<div id="e77e01cb" class="cell" data-execution_count="344">
<div class="sourceCode cell-code" id="cb463"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>df_big <span class="op">=</span> pl.DataFrame(np.random.randn(<span class="dv">1000000</span>, <span class="dv">2</span>), schema<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>]) <span class="co"># previous versions used columns= instead of schema=</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="92604f03" class="cell" data-execution_count="345">
<div class="sourceCode cell-code" id="cb464"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 df_big.sum_horizontal()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.75 ms ± 219 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
<div id="c8ce8ce3" class="cell" data-execution_count="346">
<div class="sourceCode cell-code" id="cb466"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>n2 <span class="op">-</span>r2 df_big.map_rows(<span class="kw">lambda</span> x: x[<span class="dv">0</span>] <span class="op">+</span> x[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>230 ms ± 488 µs per loop (mean ± std. dev. of 2 runs, 2 loops each)</code></pre>
</div>
</div>
</section>
<section id="numpy-ufuncs" class="level3">
<h3 class="anchored" data-anchor-id="numpy-ufuncs">Numpy Ufuncs</h3>
<p>You can use Numpy’s universal functions (ufuncs) on Polars frames. There is little overhead in using Numpy ufuncs.</p>
<ul>
<li>See <a href="https://docs.pola.rs/user-guide/expressions/numpy/">here</a> to use Numpy ufuncs in Polars.</li>
<li>See <a href="https://www.w3schools.com/python/numpy/numpy_ufunc_create_function.asp">here</a> to create your own Numpy ufunc’s.</li>
</ul>
<p>Applying off-the-shelf Numpy ufuncs is as simple.</p>
<div id="cell-numpy-ufunc" class="cell" data-execution_count="347">
<div class="sourceCode cell-code" id="cb468"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a>df.select(pl.col(<span class="st">'integer'</span>).pipe(np.sin))</span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the same as </span></span>
<span id="cb468-3"><a href="#cb468-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df.select(np.sin(pl.col('integer')))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="numpy-ufunc" class="cell-output cell-output-display" data-execution_count="339">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.841471</td>
</tr>
<tr class="even">
<td>0.909297</td>
</tr>
<tr class="odd">
<td>0.14112</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Writing your own Numpy ufunc is easy.</p>
<div id="cell-numpy-ufunc-2" class="cell" data-execution_count="348">
<div class="sourceCode cell-code" id="cb469"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb469-1"><a href="#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> myfunc(x):</span>
<span id="cb469-2"><a href="#cb469-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> x<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>x <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb469-3"><a href="#cb469-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-4"><a href="#cb469-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make myfunc a ufunc</span></span>
<span id="cb469-5"><a href="#cb469-5" aria-hidden="true" tabindex="-1"></a>myfunc_ufunc <span class="op">=</span> np.frompyfunc(myfunc, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb469-6"><a href="#cb469-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-7"><a href="#cb469-7" aria-hidden="true" tabindex="-1"></a>df.select(</span>
<span id="cb469-8"><a href="#cb469-8" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'float'</span>).pipe(myfunc_ufunc, casting<span class="op">=</span><span class="st">'unsafe'</span>)</span>
<span id="cb469-9"><a href="#cb469-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="numpy-ufunc-2" class="cell-output cell-output-display" data-execution_count="340">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>25.0</td>
</tr>
<tr class="even">
<td>36.0</td>
</tr>
<tr class="odd">
<td>49.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>My Ufunc is created with <code>np.frompyfunc()</code>. It could have also been created with <code>np.vectorize()</code>.</li>
<li>The <code>casting='unsafe'</code> argument is required, to deal with dtype mismatch. There could be a more elegant way, but I did not find it.</li>
<li>Calling a <strong>Ufunc with multiple arguments</strong> is slightly more involved, and I currently did not find a “clean” solution.</li>
</ul>
</section>
</section>
<section id="uniques-and-duplicates-1" class="level2">
<h2 class="anchored" data-anchor-id="uniques-and-duplicates-1">Uniques and Duplicates</h2>
<p>Keep uniques; same as <code>pd.drop_duplicates()</code>.</p>
<div id="cell-dataframe-unique" class="cell" data-execution_count="349">
<div class="sourceCode cell-code" id="cb470"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a>df.unique() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-unique" class="cell-output cell-output-display" data-execution_count="341">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Can be used with column subset</p>
<div id="cell-dataframe-unique-subset" class="cell" data-execution_count="350">
<div class="sourceCode cell-code" id="cb471"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a>df.unique([<span class="st">"integer"</span>, <span class="st">"float"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-unique-subset" class="cell-output cell-output-display" data-execution_count="342">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="ebef5a36" class="cell" data-execution_count="351">
<div class="sourceCode cell-code" id="cb472"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb472-1"><a href="#cb472-1" aria-hidden="true" tabindex="-1"></a>df.is_unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="343">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>true</td>
</tr>
<tr class="even">
<td>true</td>
</tr>
<tr class="odd">
<td>true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="27e94628" class="cell" data-execution_count="352">
<div class="sourceCode cell-code" id="cb473"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a>df.is_duplicated()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="344">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
</tr>
<tr class="odd">
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>false</td>
</tr>
<tr class="even">
<td>false</td>
</tr>
<tr class="odd">
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cab56ba5" class="cell" data-execution_count="353">
<div class="sourceCode cell-code" id="cb474"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb474-1"><a href="#cb474-1" aria-hidden="true" tabindex="-1"></a>df.n_unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="345">
<pre><code>3</code></pre>
</div>
</div>
</section>
<section id="missing-1" class="level2">
<h2 class="anchored" data-anchor-id="missing-1">Missing</h2>
<p>Make some data with missing.</p>
<div id="make-dataframe-with-nulls" class="cell" data-execution_count="354">
<div class="sourceCode cell-code" id="cb476"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb476-1"><a href="#cb476-1" aria-hidden="true" tabindex="-1"></a>df_with_nulls <span class="op">=</span> df.with_columns(</span>
<span id="cb476-2"><a href="#cb476-2" aria-hidden="true" tabindex="-1"></a>    null_1 <span class="op">=</span> pl.Series(<span class="st">"missing"</span>, [<span class="dv">3</span>, <span class="va">None</span>, np.nan]),</span>
<span id="cb476-3"><a href="#cb476-3" aria-hidden="true" tabindex="-1"></a>    null_2 <span class="op">=</span> pl.Series(<span class="st">"missing"</span>, [<span class="va">None</span>, <span class="dv">5</span>, <span class="dv">6</span>]),</span>
<span id="cb476-4"><a href="#cb476-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-dataframe-with-nulls" class="cell" data-execution_count="355">
<div class="sourceCode cell-code" id="cb477"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a>df_with_nulls.null_count() <span class="co"># same as pd.isnull().sum()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dataframe-with-nulls" class="cell-output cell-output-display" data-execution_count="347">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">null_1</th>
<th data-quarto-table-cell-role="th">null_2</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>u32</th>
<th>u32</th>
<th>u32</th>
<th>u32</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-df-drop-nulls" class="cell" data-execution_count="356">
<div class="sourceCode cell-code" id="cb478"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb478-1"><a href="#cb478-1" aria-hidden="true" tabindex="-1"></a>df_with_nulls.drop_nulls() <span class="co"># same as pd.dropna()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="df-drop-nulls" class="cell-output cell-output-display" data-execution_count="348">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">null_1</th>
<th data-quarto-table-cell-role="th">null_2</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>NaN</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Can I also drop <code>np.nan</code>’s? There is no <code>drop_nan()</code> method. See <a href="https://stackoverflow.com/questions/75548444/Polars-dataframe-drop-nans">StackOverflow</a> for workarounds.</p>
<div id="cell-df-fill-nulls" class="cell" data-execution_count="357">
<div class="sourceCode cell-code" id="cb479"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a>df_with_nulls.fill_null(<span class="dv">0</span>) <span class="co"># same as pd.fillna(0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="df-fill-nulls" class="cell-output cell-output-display" data-execution_count="349">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">null_1</th>
<th data-quarto-table-cell-role="th">null_2</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>3.0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>0.0</td>
<td>5</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>NaN</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>But recall that <code>None</code> and <code>np.nan</code> are not the same thing.</p>
<div id="cell-df-fill-nans" class="cell" data-execution_count="358">
<div class="sourceCode cell-code" id="cb480"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb480-1"><a href="#cb480-1" aria-hidden="true" tabindex="-1"></a>df_with_nulls.fill_nan(<span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="df-fill-nans" class="cell-output cell-output-display" data-execution_count="350">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">null_1</th>
<th data-quarto-table-cell-role="th">null_2</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>3.0</td>
<td>null</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>null</td>
<td>5</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>99.0</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-df-null-interpolate" class="cell" data-execution_count="359">
<div class="sourceCode cell-code" id="cb481"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a>df_with_nulls.interpolate()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="df-null-interpolate" class="cell-output cell-output-display" data-execution_count="351">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">null_1</th>
<th data-quarto-table-cell-role="th">null_2</th>
</tr>
<tr class="odd">
<th>f64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>3.0</td>
<td>null</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>NaN</td>
<td>5.0</td>
</tr>
<tr class="odd">
<td>3.0</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>NaN</td>
<td>6.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="sorting" class="level2">
<h2 class="anchored" data-anchor-id="sorting">Sorting</h2>
<div id="64a5f8fd" class="cell" data-execution_count="360">
<div class="sourceCode cell-code" id="cb482"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb482-1"><a href="#cb482-1" aria-hidden="true" tabindex="-1"></a>df.sort(by<span class="op">=</span>[<span class="st">"integer"</span>,<span class="st">"float"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="352">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="e4c3aeaf" class="cell" data-execution_count="361">
<div class="sourceCode cell-code" id="cb483"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a>df.reverse()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="353">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="groupby" class="level2">
<h2 class="anchored" data-anchor-id="groupby">Groupby</h2>
<p>High level:</p>
<ul>
<li><code>df.group_by()</code> is a <strong>context</strong>, for grouping. Just like Pandas, only parallelized, etc. The output will have as many rows as the number of groups.</li>
<li><code>df.partion_by()</code> will return a <strong>list</strong> of frames.</li>
<li><code>pl.col().expression().over()</code> is like Pandas <code>df.groupby.transform()</code>: will will not collapse rows in the original frame. Rather, it will assign each row in the original frame with the aggregate in the group. The output will have the same number of rows as the input.</li>
</ul>
<p>Grouping over time:</p>
<ul>
<li><code>df.grouby_rolling()</code> for rolling window grouping, a.k.a. a sliding window. Each row will be assigned the aggregate in the window.</li>
<li><code>df.group_by_dynamic()</code> for dynamic grouping. Each period will be assigned the agregate in the period. The output may have more rows than the input.</li>
</ul>
<p>The <code>group_by()</code> context will be followed by an aggregation:</p>
<ol type="1">
<li><code>df.group_by().agg()</code>: an aggregating context.</li>
<li><code>df.group_by().apply()</code>: deprecated and replaced by <code>df.group_by().map_groups()</code>.</li>
<li><code>df.group_by().map_groups()</code>: to apply your own function to each group.</li>
</ol>
<p>See the <a href="https://docs.pola.rs/py-polars/html/reference/dataframe/api/polars.DataFrame.group_by.html">API reference</a> for the various options. Also see the <a href="https://docs.pola.rs/user-guide/transformations/time-series/rolling/">user guide</a> for more details.</p>
<div id="97d8507f" class="cell" data-execution_count="362">
<div class="sourceCode cell-code" id="cb484"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb484-1"><a href="#cb484-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pl.DataFrame({</span>
<span id="cb484-2"><a href="#cb484-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"integer"</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>],</span>
<span id="cb484-3"><a href="#cb484-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"float"</span>: [<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>, <span class="fl">4.0</span>, <span class="fl">5.0</span>, <span class="fl">6.0</span>],</span>
<span id="cb484-4"><a href="#cb484-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"string"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"d"</span>],</span>
<span id="cb484-5"><a href="#cb484-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"datetime"</span>: [</span>
<span id="cb484-6"><a href="#cb484-6" aria-hidden="true" tabindex="-1"></a>        (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">4</span>)), </span>
<span id="cb484-7"><a href="#cb484-7" aria-hidden="true" tabindex="-1"></a>        (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">4</span>)), </span>
<span id="cb484-8"><a href="#cb484-8" aria-hidden="true" tabindex="-1"></a>        (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">4</span>)), </span>
<span id="cb484-9"><a href="#cb484-9" aria-hidden="true" tabindex="-1"></a>        (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">9</span>)), </span>
<span id="cb484-10"><a href="#cb484-10" aria-hidden="true" tabindex="-1"></a>        (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">9</span>)), </span>
<span id="cb484-11"><a href="#cb484-11" aria-hidden="true" tabindex="-1"></a>        (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">9</span>))],</span>
<span id="cb484-12"><a href="#cb484-12" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="partition_by" class="level3">
<h3 class="anchored" data-anchor-id="partition_by">partition_by()</h3>
<p>Make the list of frames</p>
<div id="cell-partition-by" class="cell" data-execution_count="363">
<div class="sourceCode cell-code" id="cb485"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a>partitioner <span class="op">=</span> df2.partition_by(<span class="st">"integer"</span>)</span>
<span id="cb485-2"><a href="#cb485-2" aria-hidden="true" tabindex="-1"></a>partitioner</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="partition-by" class="cell-output cell-output-display" data-execution_count="355">
<pre><code>[shape: (2, 4)
 ┌─────────┬───────┬────────┬─────────────────────┐
 │ integer ┆ float ┆ string ┆ datetime            │
 │ ---     ┆ ---   ┆ ---    ┆ ---                 │
 │ i64     ┆ f64   ┆ str    ┆ datetime[μs]        │
 ╞═════════╪═══════╪════════╪═════════════════════╡
 │ 1       ┆ 1.0   ┆ a      ┆ 2022-01-04 00:00:00 │
 │ 1       ┆ 2.0   ┆ b      ┆ 2022-01-04 00:00:00 │
 └─────────┴───────┴────────┴─────────────────────┘,
 shape: (2, 4)
 ┌─────────┬───────┬────────┬─────────────────────┐
 │ integer ┆ float ┆ string ┆ datetime            │
 │ ---     ┆ ---   ┆ ---    ┆ ---                 │
 │ i64     ┆ f64   ┆ str    ┆ datetime[μs]        │
 ╞═════════╪═══════╪════════╪═════════════════════╡
 │ 2       ┆ 3.0   ┆ c      ┆ 2022-01-04 00:00:00 │
 │ 2       ┆ 4.0   ┆ c      ┆ 2022-01-09 00:00:00 │
 └─────────┴───────┴────────┴─────────────────────┘,
 shape: (2, 4)
 ┌─────────┬───────┬────────┬─────────────────────┐
 │ integer ┆ float ┆ string ┆ datetime            │
 │ ---     ┆ ---   ┆ ---    ┆ ---                 │
 │ i64     ┆ f64   ┆ str    ┆ datetime[μs]        │
 ╞═════════╪═══════╪════════╪═════════════════════╡
 │ 3       ┆ 5.0   ┆ d      ┆ 2022-01-09 00:00:00 │
 │ 3       ┆ 6.0   ┆ d      ┆ 2022-01-09 00:00:00 │
 └─────────┴───────┴────────┴─────────────────────┘]</code></pre>
</div>
</div>
<p>The iterate like any Python list, with a function that operates on Polars frames:</p>
<div id="38f73849" class="cell" data-execution_count="364">
<div class="sourceCode cell-code" id="cb487"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> myfunc(</span>
<span id="cb487-2"><a href="#cb487-2" aria-hidden="true" tabindex="-1"></a>  df: pl.DataFrame</span>
<span id="cb487-3"><a href="#cb487-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">-&gt;</span> pl.DataFrame:</span>
<span id="cb487-4"><a href="#cb487-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> df.select(pl.col(<span class="st">"float"</span>).<span class="bu">sum</span>())</span>
<span id="cb487-5"><a href="#cb487-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-6"><a href="#cb487-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> partitioner: </span>
<span id="cb487-7"><a href="#cb487-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(myfunc(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>shape: (1, 1)
┌───────┐
│ float │
│ ---   │
│ f64   │
╞═══════╡
│ 3.0   │
└───────┘
shape: (1, 1)
┌───────┐
│ float │
│ ---   │
│ f64   │
╞═══════╡
│ 7.0   │
└───────┘
shape: (1, 1)
┌───────┐
│ float │
│ ---   │
│ f64   │
╞═══════╡
│ 11.0  │
└───────┘</code></pre>
</div>
</div>
</section>
<section id="group_by" class="level3">
<h3 class="anchored" data-anchor-id="group_by">group_by()</h3>
<div id="group-by" class="cell" data-execution_count="365">
<div class="sourceCode cell-code" id="cb489"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a>groupper <span class="op">=</span> df2.group_by(<span class="st">"integer"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="66f1a8f6" class="cell" data-execution_count="366">
<div class="sourceCode cell-code" id="cb490"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb490-1"><a href="#cb490-1" aria-hidden="true" tabindex="-1"></a>groupper.agg(</span>
<span id="cb490-2"><a href="#cb490-2" aria-hidden="true" tabindex="-1"></a>  cs.numeric().<span class="bu">sum</span>().name.suffix(<span class="st">"_sum"</span>),</span>
<span id="cb490-3"><a href="#cb490-3" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'string'</span>).n_unique().name.suffix(<span class="st">"_n_unique"</span>),</span>
<span id="cb490-4"><a href="#cb490-4" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'string'</span>),</span>
<span id="cb490-5"><a href="#cb490-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="358">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float_sum</th>
<th data-quarto-table-cell-role="th">string_n_unique</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
<th>u32</th>
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3.0</td>
<td>2</td>
<td>["a", "b"]</td>
</tr>
<tr class="even">
<td>2</td>
<td>7.0</td>
<td>1</td>
<td>["c", "c"]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>11.0</td>
<td>1</td>
<td>["d", "d"]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>Don’t expect an index. This is Polars, not Pandas.</li>
<li>The grouping may be saved as an object, and used later.</li>
<li>The <code>group_by()</code> and <code>.agg()</code> contexts offer the usual functonality of <code>.select()</code> and <code>.with_columns()</code>. In particular, you can use <code>pl.col()</code> to access columns, or the <code>pl.selector</code> module (<code>cs</code>).</li>
<li>In the selector is not followed by an expression, it will collapse the Series to a Polars List (see <a href="#sec-nested-dtypes" class="quarto-xref">Section&nbsp;5.13</a>).</li>
</ul>
<p>Some random/useful examples now follow.</p>
<section id="examples" class="level4">
<h4 class="anchored" data-anchor-id="examples">Examples</h4>
<p>The count (length) of each group:</p>
<div id="097200a0" class="cell" data-execution_count="367">
<div class="sourceCode cell-code" id="cb491"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a>groupper.agg(pl.<span class="bu">len</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="359">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">len</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>When operating on all columns,</p>
<div id="d35e5fc5" class="cell" data-execution_count="368">
<div class="sourceCode cell-code" id="cb492"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb492-1"><a href="#cb492-1" aria-hidden="true" tabindex="-1"></a>groupper.<span class="bu">len</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="360">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">len</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>u32</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="0638b73b" class="cell" data-execution_count="369">
<div class="sourceCode cell-code" id="cb493"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a>groupper.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="361">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">datetime</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
<th>str</th>
<th>datetime[μs]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>3.0</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>2</td>
<td>7.0</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>3</td>
<td>11.0</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="over" class="level3">
<h3 class="anchored" data-anchor-id="over">over()</h3>
<p>You may be familar with Pandas <code>group_by().transform()</code>, which will return a frame with the same row-count as its input. You may be familiar with Postgres SQL <a href="https://www.postgresql.org/docs/current/tutorial-window.html">window function</a>. You may not be familiar with neither, and still want to aggregate within group, but propagate the result to all group members. Polars’ <code>.over()</code> is the answer.</p>
<div id="cell-over" class="cell" data-execution_count="370">
<div class="sourceCode cell-code" id="cb494"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb494-1"><a href="#cb494-1" aria-hidden="true" tabindex="-1"></a>df2.with_columns(</span>
<span id="cb494-2"><a href="#cb494-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"float"</span>).<span class="bu">sum</span>().over(<span class="st">"string"</span>).alias(<span class="st">"sum"</span>)</span>
<span id="cb494-3"><a href="#cb494-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="over" class="cell-output cell-output-display" data-execution_count="362">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">sum</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
<th>str</th>
<th>datetime[μs]</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1.0</td>
<td>"a"</td>
<td>2022-01-04 00:00:00</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>2.0</td>
<td>"b"</td>
<td>2022-01-04 00:00:00</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3.0</td>
<td>"c"</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>4.0</td>
<td>"c"</td>
<td>2022-01-09 00:00:00</td>
<td>7.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5.0</td>
<td>"d"</td>
<td>2022-01-09 00:00:00</td>
<td>11.0</td>
</tr>
<tr class="even">
<td>3</td>
<td>6.0</td>
<td>"d"</td>
<td>2022-01-09 00:00:00</td>
<td>11.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>The output will have the same number of rows as the input.</li>
<li><code>.over()</code> is a <strong>context</strong>. As such, you can evaluate column selectors and expressions within it.</li>
<li><strong>Careful</strong>: <code>over()</code> should be the last operation in a chain. <span class="citation" data-cites="over-wrong">@over-wrong</span> will sadly <strong>not fail</strong>, while it should have.</li>
</ul>
<div id="cell-over-wrong" class="cell" data-execution_count="371">
<div class="sourceCode cell-code" id="over-wrong" data-lst-cap="A wrong use of over()"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="over-wrong-1"><a href="#over-wrong-1" aria-hidden="true" tabindex="-1"></a>df2.with_columns(</span>
<span id="over-wrong-2"><a href="#over-wrong-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"float"</span>).over(<span class="st">"string"</span>).<span class="bu">sum</span>().alias(<span class="st">"sum"</span>)</span>
<span id="over-wrong-3"><a href="#over-wrong-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="over-wrong" class="cell-output cell-output-display" data-execution_count="363">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">sum</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
<th>str</th>
<th>datetime[μs]</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1.0</td>
<td>"a"</td>
<td>2022-01-04 00:00:00</td>
<td>21.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>2.0</td>
<td>"b"</td>
<td>2022-01-04 00:00:00</td>
<td>21.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>3.0</td>
<td>"c"</td>
<td>2022-01-04 00:00:00</td>
<td>21.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>4.0</td>
<td>"c"</td>
<td>2022-01-09 00:00:00</td>
<td>21.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5.0</td>
<td>"d"</td>
<td>2022-01-09 00:00:00</td>
<td>21.0</td>
</tr>
<tr class="even">
<td>3</td>
<td>6.0</td>
<td>"d"</td>
<td>2022-01-09 00:00:00</td>
<td>21.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="grouping-on-time" class="level3">
<h3 class="anchored" data-anchor-id="grouping-on-time">Grouping on time</h3>
<p>High level:</p>
<ol type="1">
<li>Grouping on time is special, because a temporal variable implies multiple resolutions which may be used for grouping. E.g. a date may be grouped by year, month, day, etc.</li>
<li>For a temporal version of <code>group_by()</code>, use <code>df.group_by_dynamic()</code>.</li>
<li>For a temporal version of <code>over()</code>, use <code>df.rolling()</code>.</li>
</ol>
<div id="cell-group-by-dynamic" class="cell" data-execution_count="372">
<div class="sourceCode cell-code" id="cb495"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a>  df2</span>
<span id="cb495-3"><a href="#cb495-3" aria-hidden="true" tabindex="-1"></a>  .sort(<span class="st">"datetime"</span>)</span>
<span id="cb495-4"><a href="#cb495-4" aria-hidden="true" tabindex="-1"></a>  .group_by_dynamic(</span>
<span id="cb495-5"><a href="#cb495-5" aria-hidden="true" tabindex="-1"></a>    index_column<span class="op">=</span><span class="st">"datetime"</span>, </span>
<span id="cb495-6"><a href="#cb495-6" aria-hidden="true" tabindex="-1"></a>    every<span class="op">=</span><span class="st">"1d"</span>,</span>
<span id="cb495-7"><a href="#cb495-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb495-8"><a href="#cb495-8" aria-hidden="true" tabindex="-1"></a>  .agg(pl.col(<span class="st">"float"</span>).<span class="bu">sum</span>())</span>
<span id="cb495-9"><a href="#cb495-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="group-by-dynamic" class="cell-output cell-output-display" data-execution_count="364">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-04 00:00:00</td>
<td>6.0</td>
</tr>
<tr class="even">
<td>2022-01-09 00:00:00</td>
<td>15.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="cell-rolling" class="cell" data-execution_count="373">
<div class="sourceCode cell-code" id="cb496"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb496-1"><a href="#cb496-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb496-2"><a href="#cb496-2" aria-hidden="true" tabindex="-1"></a>  df2</span>
<span id="cb496-3"><a href="#cb496-3" aria-hidden="true" tabindex="-1"></a>  .sort(<span class="st">"datetime"</span>)</span>
<span id="cb496-4"><a href="#cb496-4" aria-hidden="true" tabindex="-1"></a>  .rolling(</span>
<span id="cb496-5"><a href="#cb496-5" aria-hidden="true" tabindex="-1"></a>    index_column<span class="op">=</span><span class="st">"datetime"</span>, </span>
<span id="cb496-6"><a href="#cb496-6" aria-hidden="true" tabindex="-1"></a>    period<span class="op">=</span><span class="st">'1d'</span>,</span>
<span id="cb496-7"><a href="#cb496-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb496-8"><a href="#cb496-8" aria-hidden="true" tabindex="-1"></a>  .agg(pl.col(<span class="st">"float"</span>).<span class="bu">sum</span>())</span>
<span id="cb496-9"><a href="#cb496-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="rolling" class="cell-output cell-output-display" data-execution_count="365">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 2)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">datetime</th>
<th data-quarto-table-cell-role="th">float</th>
</tr>
<tr class="odd">
<th>datetime[μs]</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2022-01-04 00:00:00</td>
<td>6.0</td>
</tr>
<tr class="even">
<td>2022-01-04 00:00:00</td>
<td>6.0</td>
</tr>
<tr class="odd">
<td>2022-01-04 00:00:00</td>
<td>6.0</td>
</tr>
<tr class="even">
<td>2022-01-09 00:00:00</td>
<td>15.0</td>
</tr>
<tr class="odd">
<td>2022-01-09 00:00:00</td>
<td>15.0</td>
</tr>
<tr class="even">
<td>2022-01-09 00:00:00</td>
<td>15.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="sec-joins" class="level2">
<h2 class="anchored" data-anchor-id="sec-joins">Joins</h2>
<p>High level:</p>
<ul>
<li><code>df.join()</code> for joins; like Pandas <code>pd.merge()</code> or <code>df.join()</code>.</li>
<li><code>df.join_asof()</code> for asof joins; like Pandas <code>pd.merge_asof()</code>.</li>
<li><code>df.hstack()</code> for horizontal concatenation; like Pandas <code>pd.concat([],axis=1)</code> or R’s <code>cbind</code>.</li>
<li><code>df.vstack()</code> for vertical concatenation; like Pandas <code>pd.concat([],axis=0)</code> or R’s <code>rbind</code>.</li>
<li><code>df.merge_sorted()</code> for vertical stacking, with sorting.</li>
<li><code>pl.concat()</code>, which is similar to the previous two, but with memory re-chunking. <code>pl.concat()</code> also allows diagonal concatenation, if columns are not shared.</li>
<li><code>df.extend()</code> for vertical concatenation, but with memory re-chunking. Similar to <code>df.vstack().rechunk()</code>.</li>
</ul>
<p>For more on the differences between these methods, see <a href="https://www.rhosignal.com/posts/Polars-extend-vstack/">here</a>.</p>
<section id="join" class="level3">
<h3 class="anchored" data-anchor-id="join">join()</h3>
<div id="cell-join" class="cell" data-execution_count="374">
<div class="sourceCode cell-code" id="cb497"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.DataFrame({</span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"integer"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], </span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>: [</span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">2</span>)), </span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">3</span>))], </span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"float"</span>: [<span class="fl">4.0</span>, <span class="fl">5.0</span>, <span class="fl">6.0</span>],</span>
<span id="cb497-8"><a href="#cb497-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"string"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>]})</span>
<span id="cb497-9"><a href="#cb497-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb497-10"><a href="#cb497-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb497-11"><a href="#cb497-11" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pl.DataFrame({</span>
<span id="cb497-12"><a href="#cb497-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"integer"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], </span>
<span id="cb497-13"><a href="#cb497-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>: [</span>
<span id="cb497-14"><a href="#cb497-14" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">4</span>)), </span>
<span id="cb497-15"><a href="#cb497-15" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">5</span>)), </span>
<span id="cb497-16"><a href="#cb497-16" aria-hidden="true" tabindex="-1"></a>    (datetime(<span class="dv">2022</span>, <span class="dv">1</span>, <span class="dv">6</span>))], </span>
<span id="cb497-17"><a href="#cb497-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"float"</span>:[<span class="fl">7.0</span>, <span class="fl">8.0</span>, <span class="fl">9.0</span>],</span>
<span id="cb497-18"><a href="#cb497-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"string"</span>: [<span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"d"</span>]})</span>
<span id="cb497-19"><a href="#cb497-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb497-20"><a href="#cb497-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb497-21"><a href="#cb497-21" aria-hidden="true" tabindex="-1"></a>df.join(</span>
<span id="cb497-22"><a href="#cb497-22" aria-hidden="true" tabindex="-1"></a>  df2, </span>
<span id="cb497-23"><a href="#cb497-23" aria-hidden="true" tabindex="-1"></a>  on<span class="op">=</span><span class="st">"integer"</span>, </span>
<span id="cb497-24"><a href="#cb497-24" aria-hidden="true" tabindex="-1"></a>  how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb497-25"><a href="#cb497-25" aria-hidden="true" tabindex="-1"></a>  validate<span class="op">=</span><span class="st">'m:1'</span></span>
<span id="cb497-26"><a href="#cb497-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="join" class="cell-output cell-output-display" data-execution_count="366">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 7)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">date_right</th>
<th data-quarto-table-cell-role="th">float_right</th>
<th data-quarto-table-cell-role="th">string_right</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>Repeating column names have been suffixed with “_right”.</li>
<li>Recall, there are <strong>no indices</strong>. The <code>on</code>/<code>left_on</code>/<code>right_on</code> argument is always required.</li>
<li><code>how=</code> may take the following values: ‘inner’, ‘left’, ‘outer’, ‘semi’, ‘anti’, ‘cross’. ‘inner’ is the default.</li>
<li>I like to add the <code>validate=</code> argument, for safety.</li>
<li>The join is super fast, as demonstrated in <a href="#sec-motivation" class="quarto-xref">Section&nbsp;2</a> above.</li>
</ul>
</section>
<section id="join_asof" class="level3">
<h3 class="anchored" data-anchor-id="join_asof">join_asof()</h3>
<div id="ddefd19e" class="cell" data-execution_count="375">
<div class="sourceCode cell-code" id="cb498"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb498-1"><a href="#cb498-1" aria-hidden="true" tabindex="-1"></a>df.join_asof(</span>
<span id="cb498-2"><a href="#cb498-2" aria-hidden="true" tabindex="-1"></a>    df2, </span>
<span id="cb498-3"><a href="#cb498-3" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">"date"</span>, </span>
<span id="cb498-4"><a href="#cb498-4" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">'date'</span>, </span>
<span id="cb498-5"><a href="#cb498-5" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">"integer"</span>, </span>
<span id="cb498-6"><a href="#cb498-6" aria-hidden="true" tabindex="-1"></a>    strategy<span class="op">=</span><span class="st">"backward"</span>, </span>
<span id="cb498-7"><a href="#cb498-7" aria-hidden="true" tabindex="-1"></a>    tolerance<span class="op">=</span><span class="st">'1w'</span>,</span>
<span id="cb498-8"><a href="#cb498-8" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="367">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 6)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">float_right</th>
<th data-quarto-table-cell-role="th">string_right</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li>Yes! <code>join_asof()</code> is available. In streaming engine as well!</li>
<li>The <code>strategy=</code> argument may take the following values: ‘backward’, ‘forward’.</li>
<li>The <code>tolerance=</code> argument may take the following values: ‘1w’, ‘1d’, ‘1h’, ‘1m’, ‘1s’, ‘1ms’, ‘1us’, ‘1ns’.</li>
</ul>
</section>
<section id="hstack" class="level3">
<h3 class="anchored" data-anchor-id="hstack">hstack</h3>
<div id="cell-hstack" class="cell" data-execution_count="376">
<div class="sourceCode cell-code" id="cb499"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a>new_column <span class="op">=</span> pl.Series(<span class="st">"c"</span>, np.repeat(<span class="dv">1</span>, df.height))</span>
<span id="cb499-2"><a href="#cb499-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb499-3"><a href="#cb499-3" aria-hidden="true" tabindex="-1"></a>df.hstack([new_column])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="hstack" class="cell-output cell-output-display" data-execution_count="368">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="vstack" class="level3">
<h3 class="anchored" data-anchor-id="vstack">vstack</h3>
<div id="cell-vstack" class="cell" data-execution_count="377">
<div class="sourceCode cell-code" id="cb500"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb500-1"><a href="#cb500-1" aria-hidden="true" tabindex="-1"></a>df.vstack(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="vstack" class="cell-output cell-output-display" data-execution_count="369">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Caution: Joining along rows is possible only if matched columns have the same dtype. Timestamps may be tricky because they may have different time units. Recall that timeunits may be cast before joining using <code>series.dt.cast_time_unit()</code>. Here is a demonstration of the problem:</p>
<div id="vstack-caution" class="cell" data-execution_count="378">
<div class="sourceCode cell-code" id="cb501"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a>  .vstack(</span>
<span id="cb501-4"><a href="#cb501-4" aria-hidden="true" tabindex="-1"></a>    df2</span>
<span id="cb501-5"><a href="#cb501-5" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb501-6"><a href="#cb501-6" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">'date'</span>).dt.cast_time_unit(time_unit<span class="op">=</span><span class="st">"ms"</span>)</span>
<span id="cb501-7"><a href="#cb501-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb501-8"><a href="#cb501-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb501-9"><a href="#cb501-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge_sorted" class="level3">
<h3 class="anchored" data-anchor-id="merge_sorted">merge_sorted</h3>
<p>This is a <strong>vertical</strong> stacking, when expecting a sorted result, and assuming inputs are sorted.</p>
<div id="32524150" class="cell" data-execution_count="379">
<div class="sourceCode cell-code" id="cb502"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb502-1"><a href="#cb502-1" aria-hidden="true" tabindex="-1"></a>df.merge_sorted(df2, key<span class="op">=</span><span class="st">"integer"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="370">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="concat" class="level3">
<h3 class="anchored" data-anchor-id="concat">concat()</h3>
<p>Vertical</p>
<div id="5ddbc884" class="cell" data-execution_count="380">
<div class="sourceCode cell-code" id="cb503"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a>pl.concat([df, df2]) </span>
<span id="cb503-2"><a href="#cb503-2" aria-hidden="true" tabindex="-1"></a><span class="co"># equivalent to:</span></span>
<span id="cb503-3"><a href="#cb503-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pl.concat([df, df2], how='vertical', rechunk=True, parallel=True) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="371">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Horizontal</p>
<div id="2968c7b5" class="cell" data-execution_count="381">
<div class="sourceCode cell-code" id="cb504"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb504-1"><a href="#cb504-1" aria-hidden="true" tabindex="-1"></a>pl.concat(</span>
<span id="cb504-2"><a href="#cb504-2" aria-hidden="true" tabindex="-1"></a>  [df,new_column.to_frame()], </span>
<span id="cb504-3"><a href="#cb504-3" aria-hidden="true" tabindex="-1"></a>  how<span class="op">=</span><span class="st">'horizontal'</span>,</span>
<span id="cb504-4"><a href="#cb504-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="372">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Diagonal</p>
<div id="b669df3f" class="cell" data-execution_count="382">
<div class="sourceCode cell-code" id="cb505"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a>pl.concat(</span>
<span id="cb505-2"><a href="#cb505-2" aria-hidden="true" tabindex="-1"></a>  [df,new_column.to_frame()], </span>
<span id="cb505-3"><a href="#cb505-3" aria-hidden="true" tabindex="-1"></a>  how<span class="op">=</span><span class="st">'diagonal'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="373">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>null</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>null</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>null</td>
</tr>
<tr class="even">
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1</td>
</tr>
<tr class="odd">
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1</td>
</tr>
<tr class="even">
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>What is the difference between <code>pl.concat()</code> and <code>df.vstack()</code> and <code>hstack()</code>? <code>pl.concat()</code> is more general with more functionality.</p>
<ul>
<li>concat includes re-chunking, which is useful for memory management.</li>
<li>concat includes diagonal concatenation, which is useful when columns are not shared.</li>
<li>concat includes parallel execution, which is useful for performance.</li>
<li>concat has recenetly been equipped with <code>how=vertial_relaxed</code> and <code>how=horizontal_relaxed</code>, which finds a common dtype if schemas are mismatched.</li>
</ul>
</section>
<section id="extend" class="level3">
<h3 class="anchored" data-anchor-id="extend">extend()</h3>
<p>Like <code>vstack()</code>, but with memory re-chunking. Similar to <code>df.vstack().rechunk()</code>.</p>
<div id="d1866a84" class="cell" data-execution_count="383">
<div class="sourceCode cell-code" id="cb506"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a>df.extend(df2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="374">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Why should I care about re-chunking? Since Polar is a columnar store, it is important to have contiguous memory layout. Otherwise, you may not enjoy the benefits of vectorized operations.</p>
<p>Is there a method for <code>df.hstack().rechunk()</code>? No.&nbsp; A columnar storage is not sensitive to emory framgmentation along columns.</p>
</section>
</section>
<section id="sec-nested-dtypes" class="level2">
<h2 class="anchored" data-anchor-id="sec-nested-dtypes">Nested dtypes</h2>
<p>Recall the nested dtypes:</p>
<ol type="1">
<li>Polars Struct: Like a Python dict within a cell; Multiple named elements.</li>
<li>Polars List: Similar to a Python list within a cell; Multiple unnamed elements. Unlike the Python list, in a Polars list, all elements must have the same dtype.</li>
<li>Polars Array: Like a Polars list, but with a fixed length for all cells in the column.</li>
</ol>
<section id="sec-struct" class="level3">
<h3 class="anchored" data-anchor-id="sec-struct">Polars Struct</h3>
<p>Why would I want to use a Polars Struct?</p>
<ol type="1">
<li>To call functions that expects a dict argument constructed from multiple columns. E.g. a Ufunc called using <code>pl.col().pipe()</code> or <code>pl.col().map_elements()</code>. See <a href="https://docs.pola.rs/user-guide/expressions/user-defined-functions/">here</a>.</li>
<li>To use column methods on multiple columns: hashing, checking uniqueness, etc.</li>
<li>As the output of a an operation that returns multiple columns. E.g. <code>value_counts()</code> within a <code>group_by()</code> context.</li>
<li>When information cannot be structured into tabular form.</li>
</ol>
<p>See <a href="https://docs.pola.rs/user-guide/expressions/structs/">here</a> for more information on Polars Structs.</p>
<p>Make a Polars Struct</p>
<div id="cell-struct" class="cell" data-execution_count="384">
<div class="sourceCode cell-code" id="struct" data-lst-cap="Making a Polars Struct"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="struct-1"><a href="#struct-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="struct-2"><a href="#struct-2" aria-hidden="true" tabindex="-1"></a>  pl.struct(</span>
<span id="struct-3"><a href="#struct-3" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"integer"</span>),</span>
<span id="struct-4"><a href="#struct-4" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"float"</span>),</span>
<span id="struct-5"><a href="#struct-5" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">"string"</span>),</span>
<span id="struct-6"><a href="#struct-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="struct-7"><a href="#struct-7" aria-hidden="true" tabindex="-1"></a>  .alias(<span class="st">"struct"</span>)</span>
<span id="struct-8"><a href="#struct-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct" class="cell-output cell-output-display" data-execution_count="375">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">struct</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>struct[3]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>{1,4.0,"a"}</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>{2,5.0,"b"}</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>{3,6.0,"c"}</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
<td>{1,7.0,"d"}</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
<td>{2,8.0,"d"}</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
<td>{3,9.0,"d"}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Or more compactly:</p>
<div id="4ff9f747" class="cell" data-execution_count="385">
<div class="sourceCode cell-code" id="cb507"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a>df.with_columns(</span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>  pl.struct(<span class="st">'integer'</span>, <span class="st">'float'</span>, <span class="st">'string'</span>).alias(<span class="st">'struct'</span>)</span>
<span id="cb507-3"><a href="#cb507-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="376">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">struct</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>struct[3]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>{1,4.0,"a"}</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>{2,5.0,"b"}</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>{3,6.0,"c"}</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
<td>{1,7.0,"d"}</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
<td>{2,8.0,"d"}</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
<td>{3,9.0,"d"}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Now add field names:</p>
<div id="939a2112" class="cell" data-execution_count="386">
<div class="sourceCode cell-code" id="cb508"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb508-1"><a href="#cb508-1" aria-hidden="true" tabindex="-1"></a>df_with_struct <span class="op">=</span> df.select(</span>
<span id="cb508-2"><a href="#cb508-2" aria-hidden="true" tabindex="-1"></a>  pl.struct(</span>
<span id="cb508-3"><a href="#cb508-3" aria-hidden="true" tabindex="-1"></a>    integer<span class="op">=</span>pl.col(<span class="st">"integer"</span>),</span>
<span id="cb508-4"><a href="#cb508-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">float</span><span class="op">=</span>pl.col(<span class="st">"float"</span>),</span>
<span id="cb508-5"><a href="#cb508-5" aria-hidden="true" tabindex="-1"></a>    string<span class="op">=</span>pl.col(<span class="st">"string"</span>),</span>
<span id="cb508-6"><a href="#cb508-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb508-7"><a href="#cb508-7" aria-hidden="true" tabindex="-1"></a>  .alias(<span class="st">"struct"</span>)</span>
<span id="cb508-8"><a href="#cb508-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb508-9"><a href="#cb508-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb508-10"><a href="#cb508-10" aria-hidden="true" tabindex="-1"></a>df_with_struct</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="377">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">struct</th>
</tr>
<tr class="odd">
<th>struct[3]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>{1,4.0,"a"}</td>
</tr>
<tr class="even">
<td>{2,5.0,"b"}</td>
</tr>
<tr class="odd">
<td>{3,6.0,"c"}</td>
</tr>
<tr class="even">
<td>{1,7.0,"d"}</td>
</tr>
<tr class="odd">
<td>{2,8.0,"d"}</td>
</tr>
<tr class="even">
<td>{3,9.0,"d"}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Convert struct to string in JSON format</p>
<div id="2602a395" class="cell" data-execution_count="387">
<div class="sourceCode cell-code" id="cb509"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a>df_with_struct.select(</span>
<span id="cb509-2"><a href="#cb509-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"struct"</span>).struct.json_encode()</span>
<span id="cb509-3"><a href="#cb509-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="378">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">struct</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"{"integer":1,"float":4.0,"string":"a"}"</td>
</tr>
<tr class="even">
<td>"{"integer":2,"float":5.0,"string":"b"}"</td>
</tr>
<tr class="odd">
<td>"{"integer":3,"float":6.0,"string":"c"}"</td>
</tr>
<tr class="even">
<td>"{"integer":1,"float":7.0,"string":"d"}"</td>
</tr>
<tr class="odd">
<td>"{"integer":2,"float":8.0,"string":"d"}"</td>
</tr>
<tr class="even">
<td>"{"integer":3,"float":9.0,"string":"d"}"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Get field names</p>
<div id="cell-struct-fields" class="cell" data-execution_count="388">
<div class="sourceCode cell-code" id="struct-fields" data-lst-cap="Getting the fields of a Polars Struct"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="struct-fields-1"><a href="#struct-fields-1" aria-hidden="true" tabindex="-1"></a>df_with_struct[<span class="st">"struct"</span>].struct.fields</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-fields" class="cell-output cell-output-display" data-execution_count="379">
<pre><code>['integer', 'float', 'string']</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <span class="citation" data-cites="struct-fields">@struct-fields</span>, I used a Series method. For reasons I do not understand, <code>struct.fields</code> has currently only a <code>pl.Series</code> <a href="https://docs.pola.rs/py-polars/html/reference/series/struct.html">version</a>, and not a <code>pl.Expr</code> <a href="https://docs.pola.rs/py-polars/html/reference/expressions/struct.html">version</a>.</p>
</div>
</div>
<p>Accessing fields</p>
<div id="cell-struct-access" class="cell" data-execution_count="389">
<div class="sourceCode cell-code" id="cb511"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a>df_with_struct.select(</span>
<span id="cb511-2"><a href="#cb511-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"struct"</span>).struct.field(<span class="st">"integer"</span>)</span>
<span id="cb511-3"><a href="#cb511-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="struct-access" class="cell-output cell-output-display" data-execution_count="380">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
</tr>
<tr class="odd">
<th>i64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
</tr>
<tr class="even">
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Struct to columns with <code>unnest()</code></p>
<div id="fdc9f499" class="cell" data-execution_count="390">
<div class="sourceCode cell-code" id="cb512"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb512-1"><a href="#cb512-1" aria-hidden="true" tabindex="-1"></a>df_with_struct.unnest(columns<span class="op">=</span>[<span class="st">"struct"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="381">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>1</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>3</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="polars-list" class="level3">
<h3 class="anchored" data-anchor-id="polars-list">Polars List</h3>
<p>When will I want to use a Polars List?</p>
<ol type="1">
<li>When I want to hold variable length data in a single cell. E.g. a list of tags, a list of items in a shopping cart, etc.</li>
</ol>
<p>See <a href="https://docs.pola.rs/user-guide/expressions/lists/">here</a> for more information on Polars Lists.</p>
<p>Make a Polars Series with strings</p>
<div id="cell-list" class="cell" data-execution_count="391">
<div class="sourceCode cell-code" id="cb513"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a>pl.Series([<span class="st">"Alice, Bob, Charlie"</span>, <span class="st">"David, Eve, Frank"</span>, <span class="st">"George, Helen, Ida, Jack, Kate"</span>])</span>
<span id="cb513-2"><a href="#cb513-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-3"><a href="#cb513-3" aria-hidden="true" tabindex="-1"></a>df_with_long_strings <span class="op">=</span> pl.DataFrame(</span>
<span id="cb513-4"><a href="#cb513-4" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"employees"</span>: [</span>
<span id="cb513-5"><a href="#cb513-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Alice, Bob, Charlie"</span>, </span>
<span id="cb513-6"><a href="#cb513-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"David, Eve, Frank"</span>, </span>
<span id="cb513-7"><a href="#cb513-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"George, Helen, Ida, Jack, Kate"</span>,</span>
<span id="cb513-8"><a href="#cb513-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Liam, Mary, Noah, Olivia, Paul, Queen, Rose, Sam, Tom, Uma, Victor, Wendy, Xavier, Yara, Zane"</span>,</span>
<span id="cb513-9"><a href="#cb513-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Abe, Ben, Cal, Dan, Ed, Fred, Gus, Hal, Ike, Joe, Ken, Lou, Max, Ned, Ollie, Pat, Quin, Ray, Sam, Tom, Ulf, Vic, Will, Xan, Yul, Zed"</span>,</span>
<span id="cb513-10"><a href="#cb513-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Tim, Kim, Jim, Sim, Dim, Lim, Mim, Rim, Vim"</span>,</span>
<span id="cb513-11"><a href="#cb513-11" aria-hidden="true" tabindex="-1"></a>  ]}</span>
<span id="cb513-12"><a href="#cb513-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb513-13"><a href="#cb513-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-14"><a href="#cb513-14" aria-hidden="true" tabindex="-1"></a>pl.Config.set_fmt_str_lengths(<span class="dv">200</span>)</span>
<span id="cb513-15"><a href="#cb513-15" aria-hidden="true" tabindex="-1"></a>df_with_long_strings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list" class="cell-output cell-output-display" data-execution_count="382">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">employees</th>
</tr>
<tr class="odd">
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Alice, Bob, Charlie"</td>
</tr>
<tr class="even">
<td>"David, Eve, Frank"</td>
</tr>
<tr class="odd">
<td>"George, Helen, Ida, Jack, Kate"</td>
</tr>
<tr class="even">
<td>"Liam, Mary, Noah, Olivia, Paul, Queen, Rose, Sam, Tom, Uma, Victor, Wendy, Xavier, Yara, Zane"</td>
</tr>
<tr class="odd">
<td>"Abe, Ben, Cal, Dan, Ed, Fred, Gus, Hal, Ike, Joe, Ken, Lou, Max, Ned, Ollie, Pat, Quin, Ray, Sam, Tom, Ulf, Vic, Will, Xan, Yul, Zed"</td>
</tr>
<tr class="even">
<td>"Tim, Kim, Jim, Sim, Dim, Lim, Mim, Rim, Vim"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Break strings into list</p>
<div id="cell-list-split" class="cell" data-execution_count="392">
<div class="sourceCode cell-code" id="cb514"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb514-1"><a href="#cb514-1" aria-hidden="true" tabindex="-1"></a>df_with_list <span class="op">=</span> df_with_long_strings.with_columns(</span>
<span id="cb514-2"><a href="#cb514-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"employees"</span>).<span class="bu">str</span>.split(<span class="st">", "</span>).alias(<span class="st">"employees"</span>)</span>
<span id="cb514-3"><a href="#cb514-3" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb514-4"><a href="#cb514-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-5"><a href="#cb514-5" aria-hidden="true" tabindex="-1"></a>pl.Config.set_fmt_table_cell_list_len(<span class="dv">100</span>)</span>
<span id="cb514-6"><a href="#cb514-6" aria-hidden="true" tabindex="-1"></a>df_with_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-split" class="cell-output cell-output-display" data-execution_count="383">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">employees</th>
</tr>
<tr class="odd">
<th>list[str]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>["Alice", "Bob", "Charlie"]</td>
</tr>
<tr class="even">
<td>["David", "Eve", "Frank"]</td>
</tr>
<tr class="odd">
<td>["George", "Helen", "Ida", "Jack", "Kate"]</td>
</tr>
<tr class="even">
<td>["Liam", "Mary", "Noah", "Olivia", "Paul", "Queen", "Rose", "Sam", "Tom", "Uma", "Victor", "Wendy", "Xavier", "Yara", "Zane"]</td>
</tr>
<tr class="odd">
<td>["Abe", "Ben", "Cal", "Dan", "Ed", "Fred", "Gus", "Hal", "Ike", "Joe", "Ken", "Lou", "Max", "Ned", "Ollie", "Pat", "Quin", "Ray", "Sam", "Tom", "Ulf", "Vic", "Will", "Xan", "Yul", "Zed"]</td>
</tr>
<tr class="even">
<td>["Tim", "Kim", "Jim", "Sim", "Dim", "Lim", "Mim", "Rim", "Vim"]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Start Operating on List Elements</p>
<div id="cell-list-operations" class="cell" data-execution_count="393">
<div class="sourceCode cell-code" id="cb515"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a>df_with_list.select(</span>
<span id="cb515-2"><a href="#cb515-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"employees"</span>).<span class="bu">list</span>.<span class="bu">len</span>().alias(<span class="st">"n_employees"</span>),</span>
<span id="cb515-3"><a href="#cb515-3" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"employees"</span>).<span class="bu">list</span>.first().alias(<span class="st">"first_employee"</span>),</span>
<span id="cb515-4"><a href="#cb515-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pl.col("employees").list.get(0).alias("first_employee"), will also work</span></span>
<span id="cb515-5"><a href="#cb515-5" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"employees"</span>).<span class="bu">list</span>.last().alias(<span class="st">"last_employee"</span>),</span>
<span id="cb515-6"><a href="#cb515-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pl.col("employees").list.get(-1).alias("last_employee"), will also work</span></span>
<span id="cb515-7"><a href="#cb515-7" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"employees"</span>).<span class="bu">list</span>.<span class="bu">slice</span>(offset<span class="op">=</span><span class="dv">1</span>, length<span class="op">=</span><span class="dv">2</span>).alias(<span class="st">"second_and_third_employees"</span>),</span>
<span id="cb515-8"><a href="#cb515-8" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">"employees"</span>).<span class="bu">list</span>.contains(<span class="st">"Alice"</span>).alias(<span class="st">"contains_Alice"</span>)</span>
<span id="cb515-9"><a href="#cb515-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-operations" class="cell-output cell-output-display" data-execution_count="384">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">n_employees</th>
<th data-quarto-table-cell-role="th">first_employee</th>
<th data-quarto-table-cell-role="th">last_employee</th>
<th data-quarto-table-cell-role="th">second_and_third_employees</th>
<th data-quarto-table-cell-role="th">contains_Alice</th>
</tr>
<tr class="odd">
<th>u32</th>
<th>str</th>
<th>str</th>
<th>list[str]</th>
<th>bool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>"Alice"</td>
<td>"Charlie"</td>
<td>["Bob", "Charlie"]</td>
<td>true</td>
</tr>
<tr class="even">
<td>3</td>
<td>"David"</td>
<td>"Frank"</td>
<td>["Eve", "Frank"]</td>
<td>false</td>
</tr>
<tr class="odd">
<td>5</td>
<td>"George"</td>
<td>"Kate"</td>
<td>["Helen", "Ida"]</td>
<td>false</td>
</tr>
<tr class="even">
<td>15</td>
<td>"Liam"</td>
<td>"Zane"</td>
<td>["Mary", "Noah"]</td>
<td>false</td>
</tr>
<tr class="odd">
<td>26</td>
<td>"Abe"</td>
<td>"Zed"</td>
<td>["Ben", "Cal"]</td>
<td>false</td>
</tr>
<tr class="even">
<td>9</td>
<td>"Tim"</td>
<td>"Vim"</td>
<td>["Kim", "Jim"]</td>
<td>false</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ol type="1">
<li>Use <code>.list.</code> to access list methods.</li>
<li>The full list of list methods is <a href="https://docs.pola.rs/py-polars/html/reference/expressions/list.html">here</a>.</li>
</ol>
</section>
<section id="explode" class="level3">
<h3 class="anchored" data-anchor-id="explode">explode()</h3>
<p>Polars List columns may be “exploded”, i.e.&nbsp;broken into rows of a single list element each.</p>
<div id="cell-explode" class="cell" data-execution_count="394">
<div class="sourceCode cell-code" id="cb516"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb516-1"><a href="#cb516-1" aria-hidden="true" tabindex="-1"></a>df_with_list.explode(<span class="st">"employees"</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="explode" class="cell-output cell-output-display" data-execution_count="385">
<pre><code>(61, 1)</code></pre>
</div>
</div>
<section id="list-to-struct-and-struct-to-list" class="level4">
<h4 class="anchored" data-anchor-id="list-to-struct-and-struct-to-list">List-to-Struct and Struct-to List</h4>
<p>Sometimes, you need to convert a list to a struct. For instance, if you want to <code>unnest()</code> a list, you will need to convert it to a struct first. Alternatively, if you want named access to list elements.</p>
<p>List to Struct</p>
<div id="cell-list-to-struct" class="cell" data-execution_count="395">
<div class="sourceCode cell-code" id="cb518"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb518-1"><a href="#cb518-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb518-2"><a href="#cb518-2" aria-hidden="true" tabindex="-1"></a>  df_with_list</span>
<span id="cb518-3"><a href="#cb518-3" aria-hidden="true" tabindex="-1"></a>  .select(</span>
<span id="cb518-4"><a href="#cb518-4" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'employees'</span>).<span class="bu">list</span>.to_struct(</span>
<span id="cb518-5"><a href="#cb518-5" aria-hidden="true" tabindex="-1"></a>      n_field_strategy<span class="op">=</span><span class="st">'max_width'</span>,</span>
<span id="cb518-6"><a href="#cb518-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb518-7"><a href="#cb518-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb518-8"><a href="#cb518-8" aria-hidden="true" tabindex="-1"></a>  .unnest(<span class="st">'employees'</span>)</span>
<span id="cb518-9"><a href="#cb518-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="list-to-struct" class="cell-output cell-output-display" data-execution_count="386">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 26)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">field_0</th>
<th data-quarto-table-cell-role="th">field_1</th>
<th data-quarto-table-cell-role="th">field_2</th>
<th data-quarto-table-cell-role="th">field_3</th>
<th data-quarto-table-cell-role="th">field_4</th>
<th data-quarto-table-cell-role="th">field_5</th>
<th data-quarto-table-cell-role="th">field_6</th>
<th data-quarto-table-cell-role="th">field_7</th>
<th data-quarto-table-cell-role="th">field_8</th>
<th data-quarto-table-cell-role="th">field_9</th>
<th data-quarto-table-cell-role="th">field_10</th>
<th data-quarto-table-cell-role="th">field_11</th>
<th data-quarto-table-cell-role="th">field_12</th>
<th data-quarto-table-cell-role="th">field_13</th>
<th data-quarto-table-cell-role="th">field_14</th>
<th data-quarto-table-cell-role="th">field_15</th>
<th data-quarto-table-cell-role="th">field_16</th>
<th data-quarto-table-cell-role="th">field_17</th>
<th data-quarto-table-cell-role="th">field_18</th>
<th data-quarto-table-cell-role="th">field_19</th>
<th data-quarto-table-cell-role="th">field_20</th>
<th data-quarto-table-cell-role="th">field_21</th>
<th data-quarto-table-cell-role="th">field_22</th>
<th data-quarto-table-cell-role="th">field_23</th>
<th data-quarto-table-cell-role="th">field_24</th>
<th data-quarto-table-cell-role="th">field_25</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Alice"</td>
<td>"Bob"</td>
<td>"Charlie"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>"David"</td>
<td>"Eve"</td>
<td>"Frank"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"George"</td>
<td>"Helen"</td>
<td>"Ida"</td>
<td>"Jack"</td>
<td>"Kate"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="even">
<td>"Liam"</td>
<td>"Mary"</td>
<td>"Noah"</td>
<td>"Olivia"</td>
<td>"Paul"</td>
<td>"Queen"</td>
<td>"Rose"</td>
<td>"Sam"</td>
<td>"Tom"</td>
<td>"Uma"</td>
<td>"Victor"</td>
<td>"Wendy"</td>
<td>"Xavier"</td>
<td>"Yara"</td>
<td>"Zane"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"Abe"</td>
<td>"Ben"</td>
<td>"Cal"</td>
<td>"Dan"</td>
<td>"Ed"</td>
<td>"Fred"</td>
<td>"Gus"</td>
<td>"Hal"</td>
<td>"Ike"</td>
<td>"Joe"</td>
<td>"Ken"</td>
<td>"Lou"</td>
<td>"Max"</td>
<td>"Ned"</td>
<td>"Ollie"</td>
<td>"Pat"</td>
<td>"Quin"</td>
<td>"Ray"</td>
<td>"Sam"</td>
<td>"Tom"</td>
<td>"Ulf"</td>
<td>"Vic"</td>
<td>"Will"</td>
<td>"Xan"</td>
<td>"Yul"</td>
<td>"Zed"</td>
</tr>
<tr class="even">
<td>"Tim"</td>
<td>"Kim"</td>
<td>"Jim"</td>
<td>"Sim"</td>
<td>"Dim"</td>
<td>"Lim"</td>
<td>"Mim"</td>
<td>"Rim"</td>
<td>"Vim"</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>When converting list to struct there are two things to consider: the number of fields and their names. The number of fields is governed by the <code>n_field_strategy</code> argument. The name of the fields is governed by the <code>fields</code> argument.</p>
</section>
</section>
<section id="polars-array" class="level3">
<h3 class="anchored" data-anchor-id="polars-array">Polars Array</h3>
<p>As of March 2024, Arrays are quite new to Polars. Currently, the behave mostly like lists, but with a fixed length. I can expect that the fixed length constraint will allow for more efficient memory allocation, and simpler API than the more general Polars Lists.</p>
<p>See <a href="https://docs.pola.rs/py-polars/html/reference/expressions/array.html">here</a> for more information on Polars Arrays.</p>
</section>
</section>
<section id="reshaping" class="level2">
<h2 class="anchored" data-anchor-id="reshaping">Reshaping</h2>
<p>High level:</p>
<ul>
<li><code>df.transpose()</code> as the name suggests.</li>
<li><code>df.melt()</code> for wide to long.</li>
<li><code>df.pivot()</code> for long to wide.</li>
<li><code>df.unnest()</code> for breaking structs into columns.</li>
<li><code>df.unstack()</code></li>
</ul>
<section id="transpose" class="level3">
<h3 class="anchored" data-anchor-id="transpose">transpose()</h3>
<p>Recall</p>
<div id="0d4b229f" class="cell" data-execution_count="396">
<div class="sourceCode cell-code" id="cb519"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="387">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Since there are no indices, if you want to keep the column names, as a new column you need to use the <code>include_header=True</code> argument.</p>
<div id="ad43f3f4" class="cell" data-execution_count="397">
<div class="sourceCode cell-code" id="cb520"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb520-1"><a href="#cb520-1" aria-hidden="true" tabindex="-1"></a>df.transpose(include_header<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="388">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 7)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">column_0</th>
<th data-quarto-table-cell-role="th">column_1</th>
<th data-quarto-table-cell-role="th">column_2</th>
<th data-quarto-table-cell-role="th">column_3</th>
<th data-quarto-table-cell-role="th">column_4</th>
<th data-quarto-table-cell-role="th">column_5</th>
</tr>
<tr class="odd">
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"integer"</td>
<td>"1"</td>
<td>"2"</td>
<td>"3"</td>
<td>"1"</td>
<td>"2"</td>
<td>"3"</td>
</tr>
<tr class="even">
<td>"date"</td>
<td>"2022-01-01 00:00:00.000000"</td>
<td>"2022-01-02 00:00:00.000000"</td>
<td>"2022-01-03 00:00:00.000000"</td>
<td>"2022-01-04 00:00:00.000000"</td>
<td>"2022-01-05 00:00:00.000000"</td>
<td>"2022-01-06 00:00:00.000000"</td>
</tr>
<tr class="odd">
<td>"float"</td>
<td>"4.0"</td>
<td>"5.0"</td>
<td>"6.0"</td>
<td>"7.0"</td>
<td>"8.0"</td>
<td>"9.0"</td>
</tr>
<tr class="even">
<td>"string"</td>
<td>"a"</td>
<td>"b"</td>
<td>"c"</td>
<td>"d"</td>
<td>"d"</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="wide-to-long--melt" class="level3">
<h3 class="anchored" data-anchor-id="wide-to-long--melt">Wide to Long- melt()</h3>
<p>Some data in wide format</p>
<div id="ecbf0454" class="cell" data-execution_count="398">
<div class="sourceCode cell-code" id="cb521"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following example is adapted from Pandas documentation: https://Pandas.pydata.org/docs/reference/api/Pandas.wide_to_long.html</span></span>
<span id="cb521-2"><a href="#cb521-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-3"><a href="#cb521-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb521-4"><a href="#cb521-4" aria-hidden="true" tabindex="-1"></a>wide <span class="op">=</span> pl.DataFrame({</span>
<span id="cb521-5"><a href="#cb521-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'famid'</span>: [<span class="st">"11"</span>, <span class="st">"12"</span>, <span class="st">"13"</span>],</span>
<span id="cb521-6"><a href="#cb521-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'birth'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb521-7"><a href="#cb521-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ht1'</span>: [<span class="fl">2.8</span>, <span class="fl">2.9</span>, <span class="fl">2.2</span>],</span>
<span id="cb521-8"><a href="#cb521-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ht2'</span>: [<span class="fl">3.4</span>, <span class="fl">3.8</span>, <span class="fl">2.9</span>]})</span>
<span id="cb521-9"><a href="#cb521-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb521-10"><a href="#cb521-10" aria-hidden="true" tabindex="-1"></a>wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="389">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">famid</th>
<th data-quarto-table-cell-role="th">birth</th>
<th data-quarto-table-cell-role="th">ht1</th>
<th data-quarto-table-cell-role="th">ht2</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"11"</td>
<td>1</td>
<td>2.8</td>
<td>3.4</td>
</tr>
<tr class="even">
<td>"12"</td>
<td>2</td>
<td>2.9</td>
<td>3.8</td>
</tr>
<tr class="odd">
<td>"13"</td>
<td>3</td>
<td>2.2</td>
<td>2.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Reshape into long format</p>
<div id="a4f4ac96" class="cell" data-execution_count="399">
<div class="sourceCode cell-code" id="cb522"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a>wide.melt(</span>
<span id="cb522-2"><a href="#cb522-2" aria-hidden="true" tabindex="-1"></a>  id_vars<span class="op">=</span>[<span class="st">'famid'</span>, <span class="st">'birth'</span>], </span>
<span id="cb522-3"><a href="#cb522-3" aria-hidden="true" tabindex="-1"></a>  value_vars<span class="op">=</span>[<span class="st">'ht1'</span>, <span class="st">'ht2'</span>], </span>
<span id="cb522-4"><a href="#cb522-4" aria-hidden="true" tabindex="-1"></a>  variable_name<span class="op">=</span><span class="st">'treatment'</span>, </span>
<span id="cb522-5"><a href="#cb522-5" aria-hidden="true" tabindex="-1"></a>  value_name<span class="op">=</span><span class="st">'height'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="390">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">famid</th>
<th data-quarto-table-cell-role="th">birth</th>
<th data-quarto-table-cell-role="th">treatment</th>
<th data-quarto-table-cell-role="th">height</th>
</tr>
<tr class="odd">
<th>str</th>
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"11"</td>
<td>1</td>
<td>"ht1"</td>
<td>2.8</td>
</tr>
<tr class="even">
<td>"12"</td>
<td>2</td>
<td>"ht1"</td>
<td>2.9</td>
</tr>
<tr class="odd">
<td>"13"</td>
<td>3</td>
<td>"ht1"</td>
<td>2.2</td>
</tr>
<tr class="even">
<td>"11"</td>
<td>1</td>
<td>"ht2"</td>
<td>3.4</td>
</tr>
<tr class="odd">
<td>"12"</td>
<td>2</td>
<td>"ht2"</td>
<td>3.8</td>
</tr>
<tr class="even">
<td>"13"</td>
<td>3</td>
<td>"ht2"</td>
<td>2.9</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>id_vars</code> are the columns that index the wide format; these will be repeated.</li>
<li><code>value_vars</code> are the columns that hold information in the wide format; these will be stacked in the long format.</li>
<li><code>variable_name</code> is the column name, in the long format, that holds the column names from the wide format. The indexing columns in the long format will thus be <code>id_vars</code>+<code>variable_name</code>.</li>
<li><code>value_name</code> is the column name, in the long format, that holds the values after stacking.</li>
</ul>
</section>
<section id="long-to-wide" class="level3">
<h3 class="anchored" data-anchor-id="long-to-wide">Long to Wide</h3>
<p>stopped here</p>
<div id="a44a7331" class="cell" data-execution_count="400">
<div class="sourceCode cell-code" id="cb523"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example adapted from https://stackoverflow.com/questions/5890584/how-to-reshape-data-from-long-to-wide-format</span></span>
<span id="cb523-2"><a href="#cb523-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb523-3"><a href="#cb523-3" aria-hidden="true" tabindex="-1"></a><span class="bu">long</span> <span class="op">=</span> pl.DataFrame({</span>
<span id="cb523-4"><a href="#cb523-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'id'</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>],</span>
<span id="cb523-5"><a href="#cb523-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'treatment'</span>: [<span class="st">'A'</span>, <span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'A'</span>, <span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'A'</span>, <span class="st">'A'</span>, <span class="st">'B'</span>],</span>
<span id="cb523-6"><a href="#cb523-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'height'</span>: [<span class="fl">2.8</span>, <span class="fl">2.9</span>, <span class="fl">2.2</span>, <span class="dv">2</span>, <span class="fl">1.8</span>, <span class="fl">1.9</span>, <span class="fl">2.2</span>, <span class="fl">2.3</span>, <span class="fl">2.1</span>]</span>
<span id="cb523-7"><a href="#cb523-7" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb523-8"><a href="#cb523-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb523-9"><a href="#cb523-9" aria-hidden="true" tabindex="-1"></a><span class="bu">long</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="391">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 3)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">treatment</th>
<th data-quarto-table-cell-role="th">height</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>"A"</td>
<td>2.8</td>
</tr>
<tr class="even">
<td>1</td>
<td>"A"</td>
<td>2.9</td>
</tr>
<tr class="odd">
<td>1</td>
<td>"B"</td>
<td>2.2</td>
</tr>
<tr class="even">
<td>2</td>
<td>"A"</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>"A"</td>
<td>1.8</td>
</tr>
<tr class="even">
<td>2</td>
<td>"B"</td>
<td>1.9</td>
</tr>
<tr class="odd">
<td>3</td>
<td>"A"</td>
<td>2.2</td>
</tr>
<tr class="even">
<td>3</td>
<td>"A"</td>
<td>2.3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>"B"</td>
<td>2.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Pivot Without Aggregation</p>
<div id="165178d4" class="cell" data-execution_count="401">
<div class="sourceCode cell-code" id="cb524"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="bu">long</span>.pivot(</span>
<span id="cb524-2"><a href="#cb524-2" aria-hidden="true" tabindex="-1"></a>  values<span class="op">=</span><span class="st">'height'</span>,</span>
<span id="cb524-3"><a href="#cb524-3" aria-hidden="true" tabindex="-1"></a>  index<span class="op">=</span><span class="st">'id'</span>, <span class="co"># index in the wide format</span></span>
<span id="cb524-4"><a href="#cb524-4" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span><span class="st">'treatment'</span>, <span class="co"># defines columns in the wide format</span></span>
<span id="cb524-5"><a href="#cb524-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ComputeError: found multiple elements in the same group, please specify an aggregation function</code></pre>
</div>
</div>
<p>Pivot with Aggregation</p>
<section id="pivot-vs-value_counts" class="level4">
<h4 class="anchored" data-anchor-id="pivot-vs-value_counts">pivot() VS value_counts()</h4>
</section>
</section>
<section id="unstack" class="level3">
<h3 class="anchored" data-anchor-id="unstack">unstack()</h3>
<p>Works like a transpose, and then wrap rows. Change the <code>step=</code> to get the feeling.</p>
<div id="3b70d3cb" class="cell" data-execution_count="402">
<div class="sourceCode cell-code" id="cb526"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="bu">long</span>.unstack(step<span class="op">=</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="393">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 15)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">id_0</th>
<th data-quarto-table-cell-role="th">id_1</th>
<th data-quarto-table-cell-role="th">id_2</th>
<th data-quarto-table-cell-role="th">id_3</th>
<th data-quarto-table-cell-role="th">id_4</th>
<th data-quarto-table-cell-role="th">treatment_0</th>
<th data-quarto-table-cell-role="th">treatment_1</th>
<th data-quarto-table-cell-role="th">treatment_2</th>
<th data-quarto-table-cell-role="th">treatment_3</th>
<th data-quarto-table-cell-role="th">treatment_4</th>
<th data-quarto-table-cell-role="th">height_0</th>
<th data-quarto-table-cell-role="th">height_1</th>
<th data-quarto-table-cell-role="th">height_2</th>
<th data-quarto-table-cell-role="th">height_3</th>
<th data-quarto-table-cell-role="th">height_4</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>i64</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>str</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>3</td>
<td>"A"</td>
<td>"B"</td>
<td>"A"</td>
<td>"A"</td>
<td>"B"</td>
<td>2.8</td>
<td>2.2</td>
<td>1.8</td>
<td>2.2</td>
<td>2.1</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>null</td>
<td>"A"</td>
<td>"A"</td>
<td>"B"</td>
<td>"A"</td>
<td>null</td>
<td>2.9</td>
<td>2.0</td>
<td>1.9</td>
<td>2.3</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="unest" class="level3">
<h3 class="anchored" data-anchor-id="unest">unest()</h3>
<p>See <a href="#sec-struct" class="quarto-xref">Section&nbsp;5.13.1</a>.</p>
</section>
</section>
<section id="dataframe-in-memory" class="level2">
<h2 class="anchored" data-anchor-id="dataframe-in-memory">Dataframe in Memory</h2>
<div id="afe72599" class="cell" data-execution_count="403">
<div class="sourceCode cell-code" id="cb527"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb527-1"><a href="#cb527-1" aria-hidden="true" tabindex="-1"></a>df.estimated_size(unit<span class="op">=</span><span class="st">"mb"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="394">
<pre><code>0.0002288818359375</code></pre>
</div>
</div>
<div id="d7619ffd" class="cell" data-execution_count="404">
<div class="sourceCode cell-code" id="cb529"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb529-1"><a href="#cb529-1" aria-hidden="true" tabindex="-1"></a>df.n_chunks() <span class="co"># number of ChunkedArrays in the dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="395">
<pre><code>1</code></pre>
</div>
</div>
<div id="21418ca4" class="cell" data-execution_count="405">
<div class="sourceCode cell-code" id="cb531"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a>df.rechunk() <span class="co"># ensure contiguous memory layout</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="396">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="a6f6d7a1" class="cell" data-execution_count="406">
<div class="sourceCode cell-code" id="cb532"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb532-1"><a href="#cb532-1" aria-hidden="true" tabindex="-1"></a>df.shrink_to_fit() <span class="co"># reduce memory allocation to actual size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="397">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="io" class="level1">
<h1>I/O</h1>
<section id="reading-frames-from-disk" class="level2">
<h2 class="anchored" data-anchor-id="reading-frames-from-disk">Reading Frames from Disk</h2>
</section>
<section id="sec-disk-export" class="level2">
<h2 class="anchored" data-anchor-id="sec-disk-export">Writing Frames to Disk</h2>
</section>
</section>
<section id="sec-expressions" class="level1">
<h1>Polars Expressions</h1>
<p>Things to recall about Polars expressions:</p>
<ol type="1">
<li>Think of them as functions, that can be chained, and evaluated (lazyly) within a Polars context such as <code>df.select()</code>, <code>df.with_columns()</code>, etc.</li>
<li>They are not the same as Python functions, and will not work outside of a Polars context.</li>
<li>Almost all <code>pl.Series()</code> methods are available as Polars expressions. There are however some exceptions.</li>
</ol>
<p>Because almost all Polars Series methods are available as Polars expressions, we refer the reader to <a href="#sec-series" class="quarto-xref">Section&nbsp;4</a> for a review of importanta series methods. In this section we will focus on exceptions, and some important expressions that are not available for Series.</p>
<section id="arithmetic" class="level2">
<h2 class="anchored" data-anchor-id="arithmetic">Arithmetic</h2>
</section>
</section>
<section id="polars-lazyframes" class="level1">
<h1>Polars LazyFrames</h1>
<section id="processing-multiple-frames-simultanously" class="level2">
<h2 class="anchored" data-anchor-id="processing-multiple-frames-simultanously">Processing Multiple Frames Simultanously</h2>
<p>Q: What if you want to access a column from frame <code>df</code>, when processing frame <code>df2</code>?<br>
A: Just join them.<br>
Q: What if they are not joinable?<br>
A: Use a diagonal join. Q: Can’t I just add a search-space into the lazy query? A: Ahhh! Use <code>df.with_context()</code>.</p>
<div id="199309c6" class="cell" data-execution_count="407">
<div class="sourceCode cell-code" id="cb533"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pl.Series(<span class="st">"blah"</span>, [<span class="dv">100</span>,<span class="dv">2</span>,<span class="dv">3</span>]).to_frame()</span>
<span id="cb533-2"><a href="#cb533-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-3"><a href="#cb533-3" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> (</span>
<span id="cb533-4"><a href="#cb533-4" aria-hidden="true" tabindex="-1"></a>    df.lazy()</span>
<span id="cb533-5"><a href="#cb533-5" aria-hidden="true" tabindex="-1"></a>    .with_context( <span class="co"># add colums of df2 to the search space</span></span>
<span id="cb533-6"><a href="#cb533-6" aria-hidden="true" tabindex="-1"></a>        df3.lazy()</span>
<span id="cb533-7"><a href="#cb533-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb533-8"><a href="#cb533-8" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb533-9"><a href="#cb533-9" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">'float'</span>).map_dict(remapping<span class="op">=</span>{<span class="fl">4.0</span>:<span class="va">None</span>}, default<span class="op">=</span><span class="dv">100</span>).fill_null(pl.col(<span class="st">'blah'</span>).mean()).alias(<span class="st">'float2'</span>),</span>
<span id="cb533-10"><a href="#cb533-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb533-11"><a href="#cb533-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb533-12"><a href="#cb533-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-13"><a href="#cb533-13" aria-hidden="true" tabindex="-1"></a>q.collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/2186241628.py:9: DeprecationWarning:

`map_dict` is deprecated. It has been renamed to `replace`. The default behavior has changed to keep any values not present in the mapping unchanged. Pass `default=None` to keep existing behavior.

/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/2186241628.py:9: DeprecationWarning:

`the argument remapping` for `map_dict` is deprecated. It has been renamed to `mapping`.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="398">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 5)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">integer</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">float</th>
<th data-quarto-table-cell-role="th">string</th>
<th data-quarto-table-cell-role="th">float2</th>
</tr>
<tr class="odd">
<th>i64</th>
<th>datetime[μs]</th>
<th>f64</th>
<th>str</th>
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2022-01-01 00:00:00</td>
<td>4.0</td>
<td>"a"</td>
<td>35.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2022-01-02 00:00:00</td>
<td>5.0</td>
<td>"b"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2022-01-03 00:00:00</td>
<td>6.0</td>
<td>"c"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>2022-01-04 00:00:00</td>
<td>7.0</td>
<td>"d"</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>2</td>
<td>2022-01-05 00:00:00</td>
<td>8.0</td>
<td>"d"</td>
<td>100.0</td>
</tr>
<tr class="even">
<td>3</td>
<td>2022-01-06 00:00:00</td>
<td>9.0</td>
<td>"d"</td>
<td>100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Things to note:</p>
<ul>
<li><code>with_context()</code> is a lazy operation. This is great news, since it means both frames will benefit from query planning, etc.</li>
<li><code>with_context()</code> will not copy the data, but rather, add a reference to the data.</li>
<li>Why not use <code>pl.col('blah').mean()</code> within the <code>map_dict()</code>? That is indeed more reasonable. It simply did not work.</li>
<li>Try it yourself: Can you use multiple <code>with_context()</code>?</li>
</ul>
<section id="imputation-example" class="level3">
<h3 class="anchored" data-anchor-id="imputation-example">Imputation Example</h3>
<div id="ead9dcf8" class="cell" data-execution_count="408">
<div class="sourceCode cell-code" id="cb535"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a>train_lf <span class="op">=</span> pl.LazyFrame(</span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"feature_0"</span>: [<span class="op">-</span><span class="fl">1.0</span>, <span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"feature_1"</span>: [<span class="op">-</span><span class="fl">1.0</span>, <span class="dv">0</span>, <span class="dv">1</span>]}</span>
<span id="cb535-3"><a href="#cb535-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb535-4"><a href="#cb535-4" aria-hidden="true" tabindex="-1"></a>test_lf <span class="op">=</span> pl.LazyFrame(</span>
<span id="cb535-5"><a href="#cb535-5" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"feature_0"</span>: [<span class="op">-</span><span class="fl">1.0</span>, <span class="va">None</span>, <span class="dv">1</span>], <span class="st">"feature_1"</span>: [<span class="op">-</span><span class="fl">1.0</span>, <span class="dv">0</span>, <span class="dv">1</span>]}</span>
<span id="cb535-6"><a href="#cb535-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb535-7"><a href="#cb535-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb535-8"><a href="#cb535-8" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb535-9"><a href="#cb535-9" aria-hidden="true" tabindex="-1"></a>  test_lf</span>
<span id="cb535-10"><a href="#cb535-10" aria-hidden="true" tabindex="-1"></a>  .with_context(</span>
<span id="cb535-11"><a href="#cb535-11" aria-hidden="true" tabindex="-1"></a>    train_lf</span>
<span id="cb535-12"><a href="#cb535-12" aria-hidden="true" tabindex="-1"></a>    .select(pl.<span class="bu">all</span>().suffix(<span class="st">"_train"</span>)))</span>
<span id="cb535-13"><a href="#cb535-13" aria-hidden="true" tabindex="-1"></a>    .select(</span>
<span id="cb535-14"><a href="#cb535-14" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">"feature_0"</span>)</span>
<span id="cb535-15"><a href="#cb535-15" aria-hidden="true" tabindex="-1"></a>      .fill_null(</span>
<span id="cb535-16"><a href="#cb535-16" aria-hidden="true" tabindex="-1"></a>        pl.col(<span class="st">"feature_0_train"</span>).median()</span>
<span id="cb535-17"><a href="#cb535-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb535-18"><a href="#cb535-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb535-19"><a href="#cb535-19" aria-hidden="true" tabindex="-1"></a>).collect()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/ld/j2ckdhnj5hqcx58byy0gj9th0000gn/T/ipykernel_84610/2751601251.py:12: DeprecationWarning:

`suffix` is deprecated. It has been moved to `name.suffix`.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="399">
<div>
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 1)</small>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">feature_0</th>
</tr>
<tr class="odd">
<th>f64</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-1.0</td>
</tr>
<tr class="even">
<td>0.0</td>
</tr>
<tr class="odd">
<td>1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="extensions" class="level1">
<h1>Extensions</h1>
<section id="sql" class="level2">
<h2 class="anchored" data-anchor-id="sql">SQL</h2>
</section>
<section id="plotting" class="level2">
<h2 class="anchored" data-anchor-id="plotting">Plotting</h2>
</section>
<section id="ml" class="level2">
<h2 class="anchored" data-anchor-id="ml">ML</h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>